import{_ as ce,a as pe,b as de,c as me,d as _e,N as fe,e as ve}from"./round-refresh-B7VpfLgK.js";import{u as ge,a as ye,b as J,w as be,_ as Te}from"./table-Gm6yRvUm.js";import{d as ee,M as Z,N as le,a as H,r as ae,O as he,o as C,c as A,w as l,f as n,g as L,t as G,h as o,$ as m,P as j,s as oe,B as R,Q as se,R as we,S as Ne,J as ie,z as ke,b as Se,U as K,V as Ce,W as xe}from"./index-D6W6_zXP.js";import{i as Ie,s as ne,d as Ae,a as Le}from"./activity-C6741kjc.js";import{u as re}from"./auth-DdtuPNda.js";import{u as Oe,_ as Be,b as ue}from"./form-a8uLA4Rd.js";import{d as De,s as Ue,_ as Re}from"./file-CILs5gq_.js";import{_ as te}from"./Space-zKntJrGG.js";import{_ as $e}from"./DatePicker-CeSQ1aZs.js";import{_ as Ee}from"./Grid-Cxuy6_wU.js";import{_ as Fe}from"./DataTable-BesTDHU0.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-BQ2WJ-Rm.js";const Ve=ee({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:Z({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:Z(["submitted"],["update:visible"]),setup(g,{emit:T}){const _=g,x=T,s=le(g,"visible"),{formRef:I,validate:O,restoreValidation:B}=Oe(),$=H(()=>({add:"新增活动地点",edit:"编辑活动地点"})[_.operateType]),r=ae(h());function h(){return{name:null,description:null,approvalStatus:null,approveReason:null}}const y=H(()=>{var t;return((t=_.rowData)==null?void 0:t.id)||-1}),w=H(()=>_.operateType==="edit");function E(){r.value=h(),_.operateType==="edit"&&_.rowData&&Object.assign(r.value,_.rowData)}function D(){s.value=!1}async function U(){var t;await O(),delete r.value.index,delete r.value.approverName,await Ie(r.value),(t=window.$message)==null||t.success(m("common.updateSuccess")),D(),x("submitted")}const F=`${String(localStorage.getItem("SOY_token")).trim().replace(/"/g,"")}`,c=localStorage.getItem("baseUri"),V=`${c}/upload`,N=ae([]),P=H(()=>({targetId:y.value,targetType:3,fileCategory:1})),z=async t=>{var p,b,i,k,S,Y;console.log("options: ",t);const e=await De(t.file.id),{code:a,data:u,msg:v}=e.response.data;return a===200?((b=(p=window.$message)==null?void 0:p.success)==null||b.call(p,v),!0):a!==200?((k=(i=window.$message)==null?void 0:i.error)==null||k.call(i,v),!1):((Y=(S=window.$message)==null?void 0:S.error)==null||Y.call(S,"前端删除文件错误，请联系管理员！"),!1)},M=()=>{N.value=[]},f=()=>{Ue({targetId:y.value}).then(t=>{(Array.isArray(t.data)?t.data:[]).forEach(a=>{const u={id:a.id,name:a.fileName,status:"finished",url:`${c}/${a.fileUri}`};switch(a.fileCategory){case 1:N.value.push(u);break;case 2:imageFileList2.value.push(u);break;case 3:imageFileList3.value.push(u);break;default:console.warn(`Unknown file category: ${a.fileCategory}`)}})})};function W(t,e){const a=document.createElement("a");a.href=t,a.target="_blank",a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a)}const X=t=>(W(t.url,t.name),!1);he(s,()=>{s.value&&(E(),B(),setTimeout(()=>{M(),f()},500))});const q=[{label:"待审批",value:0},{label:"审批通过",value:1},{label:"审批拒绝",value:2}];return(t,e)=>{const a=oe,u=Be,v=R,p=Re,b=se,i=ue,k=te,S=we,Y=Ne;return C(),A(Y,{show:s.value,"onUpdate:show":e[5]||(e[5]=d=>s.value=d),"display-directive":"show",width:360},{default:l(()=>[n(S,{title:$.value,"native-scrollbar":!1,closable:""},{footer:l(()=>[n(k,{size:16},{default:l(()=>[n(v,{onClick:D},{default:l(()=>[L(G(o(m)("common.cancel")),1)]),_:1}),n(v,{type:"primary",onClick:U},{default:l(()=>[L(G(o(m)("common.confirm")),1)]),_:1})]),_:1})]),default:l(()=>[n(i,{ref_key:"formRef",ref:I,model:r.value},{default:l(()=>[n(u,{label:"地点"},{default:l(()=>[n(a,{value:r.value.name,"onUpdate:value":e[0]||(e[0]=d=>r.value.name=d)},null,8,["value"])]),_:1}),n(u,{label:"描述"},{default:l(()=>[n(a,{value:r.value.description,"onUpdate:value":e[1]||(e[1]=d=>r.value.description=d)},null,8,["value"])]),_:1}),n(u,{label:"图片"},{default:l(()=>[n(p,{"file-list":N.value,"onUpdate:fileList":e[2]||(e[2]=d=>N.value=d),action:V,data:P.value,"list-type":"image-card","show-download-button":!0,max:9,name:"file",multiple:!0,accept:".jpg,.jpeg,.png",headers:{Authorization:`Bearer ${F}`},"on-remove":z,"on-download":X},{default:l(()=>[n(v,null,{default:l(()=>e[6]||(e[6]=[L("点击上传")])),_:1})]),_:1},8,["file-list","data","headers"])]),_:1}),w.value?(C(),A(u,{key:0,label:"审批状态"},{default:l(()=>[n(b,{value:r.value.approvalStatus,"onUpdate:value":e[3]||(e[3]=d=>r.value.approvalStatus=d),options:q,clearable:""},null,8,["value"])]),_:1})):j("",!0),w.value?(C(),A(u,{key:1,label:"审批原因"},{default:l(()=>[n(a,{value:r.value.approveReason,"onUpdate:value":e[4]||(e[4]=d=>r.value.approveReason=d),type:"textarea"},null,8,["value"])]),_:1})):j("",!0)]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Pe=ee({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:Z(["reset","search"],["update:model"]),setup(g,{emit:T}){const{hasAuth:_}=re(),x=T,s=le(g,"model");function I(){s.value.createTimeRange=null,s.value.createTimeStart=null,s.value.createTimeEnd=null,x("reset")}function O(){s.value.createTimeRange&&(s.value.createTimeStart=s.value.createTimeRange[0],s.value.createTimeEnd=s.value.createTimeRange[1],delete s.value.createTimeRange),x("search")}const B=[{label:"待审批",value:"0"},{label:"审批通过",value:"1"},{label:"审批拒绝",value:"2"}];return($,r)=>{const h=oe,y=ce,w=se,E=$e,D=pe,U=R,F=de,c=te,V=Ee,N=ue,P=me,z=_e,M=ie;return C(),A(M,{bordered:!1,size:"small",class:"card-wrapper"},{default:l(()=>[n(z,{"default-expanded-names":["role-search"]},{default:l(()=>[n(P,{title:o(m)("common.search"),name:"role-search"},{default:l(()=>[n(N,{model:s.value,"label-placement":"left","label-width":80},{default:l(()=>[n(V,{responsive:"screen","item-responsive":""},{default:l(()=>[n(y,{span:"24 s:12 m:6",label:"地点",path:"realName",class:"pr-24px"},{default:l(()=>[n(h,{value:s.value.name,"onUpdate:value":r[0]||(r[0]=f=>s.value.name=f)},null,8,["value"])]),_:1}),n(y,{span:"24 s:12 m:6",label:"审批状态",path:"enabled",class:"pr-24px"},{default:l(()=>[n(w,{value:s.value.approvalStatus,"onUpdate:value":r[1]||(r[1]=f=>s.value.approvalStatus=f),options:B,clearable:""},null,8,["value"])]),_:1}),n(y,{span:"24 s:12 m:6",label:"创建时间",path:"status",class:"pr-24px"},{default:l(()=>[n(E,{value:s.value.createTimeRange,"onUpdate:value":r[2]||(r[2]=f=>s.value.createTimeRange=f),type:"datetimerange",clearable:""},null,8,["value"])]),_:1}),n(y,{span:"24 s:12 m:6"},{default:l(()=>[n(c,{class:"w-full",justify:"end"},{default:l(()=>[n(U,{onClick:I},{icon:l(()=>[n(D,{class:"text-icon"})]),default:l(()=>[L(" "+G(o(m)("common.reset")),1)]),_:1}),o(_)("BUTTON_SEARCH_ACTIVITY_LOCATION")?(C(),A(U,{key:0,type:"primary",ghost:"",onClick:O},{icon:l(()=>[n(F,{class:"text-icon"})]),default:l(()=>[L(" "+G(o(m)("common.search")),1)]),_:1})):j("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Q(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!xe(g)}const tt=ee({name:"activity_activity-location",__name:"index",setup(g){const{hasAuth:T}=re(),_=ke(),{columns:x,columnChecks:s,data:I,loading:O,getData:B,getDataByPage:$,mobilePagination:r,searchParams:h,resetSearchParams:y}=ge({apiFn:ne,apiParams:{current:1,size:10,deleted:null,createTime:null,updateTime:null,id:null,name:null,description:null,approverId:null,approvalStatus:null,approveTime:null,approvalStatus:null,approverName:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:m("common.index"),width:64,align:"center"},{key:"name",title:"地点",align:"center",minWidth:120},{key:"description",title:"描述",align:"center",minWidth:120},{key:"createTime",title:"创建时间",align:"center",minWidth:120},{key:"approvalStatus",title:"审批状态",align:"center",minWidth:120,render:t=>{if(t.approvalStatus===null)return null;const e={1:"success",0:"warning",2:"error"};let a;return t.approvalStatus===0&&(a="待审批"),t.approvalStatus===1&&(a="审批通过"),t.approvalStatus===2&&(a="审批拒绝"),n(Ce,{type:e[t.approvalStatus]},Q(a)?a:{default:()=>[a]})}},{key:"approverName",title:"审批人",align:"center",minWidth:120},{key:"approveTime",title:"审批时间",align:"center",minWidth:120},{key:"approveReason",title:"审批原因",align:"center",minWidth:120},{key:"operate",title:m("common.operate"),align:"center",width:130,render:t=>{let e;return n("div",{class:"flex-center gap-8px"},[T("BUTTON_EDIT_ACTIVITY_LOCATION")?n(R,{type:"primary",ghost:!0,size:"small",onClick:()=>M(t.id)},Q(e=m("common.edit"))?e:{default:()=>[e]}):null,T("BUTTON_DELETE_ACTIVITY_LOCATION")&&n(fe,{onPositiveClick:()=>z(t.id)},{default:()=>m("common.confirmDelete"),trigger:()=>{let a;return n(R,{type:"error",ghost:!0,size:"small"},Q(a=m("common.delete"))?a:{default:()=>[a]})}})])}}]}),{drawerVisible:w,operateType:E,editingData:D,handleAdd:U,handleEdit:F,checkedRowKeys:c,onBatchDeleted:V,onDeleted:N}=ye(I,B);async function P(){console.log(c.value),await Ae(c.value),V()}async function z(t){console.log(t),await Le(t),N()}function M(t){F(t)}async function f(t,e){const a=x.value.slice(2);let u=[];t?u=(await ne({size:999999})).data.records.map(k=>a.map(S=>W(S,k))):u=I.value.map(i=>a.map(k=>W(k,i)));const v=a.map(i=>q(i)&&i.title||null);u.unshift(v);const p=J.book_new(),b=J.aoa_to_sheet(u);b["!cols"]=a.map(i=>({width:Math.round(Number(i.width)/10||20)})),J.book_append_sheet(p,b,"活动地点列表"),be(p,"活动地点数据.xlsx")}function W(t,e){if(!X(t))return null;const{key:a}=t;if(a==="operate")return null;if(a==="approvalStatus"){let u;return e.approvalStatus===0&&(u="待审批"),e.approvalStatus===1&&(u="审批通过"),e.approvalStatus===2&&(u="审批拒绝"),u}return e[a]}function X(t){return!!t.key}function q(t){return!!t.title}return(t,e)=>{const a=Te,u=ve,v=te,p=Fe,b=ie;return C(),Se("div",ze,[n(Pe,{model:o(h),"onUpdate:model":e[0]||(e[0]=i=>K(h)?h.value=i:null),onReset:o(y),onSearch:o($)},null,8,["model","onReset","onSearch"]),n(b,{title:"活动地点列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":l(()=>[n(v,{align:"end",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:l(()=>[o(T)("BUTTON_EXCEL_ACTIVITY_LOCATION")?(C(),A(o(R),{key:0,size:"small",ghost:"",type:"primary",onClick:e[1]||(e[1]=i=>f(!1))},{icon:l(()=>[n(a,{class:"text-icon"})]),default:l(()=>[e[6]||(e[6]=L(" 导出excel "))]),_:1})):j("",!0),o(T)("BUTTON_EXCEL_ACTIVITY_LOCATION_ALL")?(C(),A(o(R),{key:1,size:"small",ghost:"",type:"primary",onClick:e[2]||(e[2]=i=>f(!0))},{icon:l(()=>[n(a,{class:"text-icon"})]),default:l(()=>[e[7]||(e[7]=L(" 导出全部 "))]),_:1})):j("",!0),n(u,{columns:o(s),"onUpdate:columns":e[3]||(e[3]=i=>K(s)?s.value=i:null),"disabled-delete":o(c).length===0,loading:o(O),"show-add-button-str":"BUTTON_ADD_ACTIVITY_LOCATION","show-batch-delete-button-str":"BUTTON_BATCH_DELETE_ACTIVITY_LOCATION",onAdd:o(U),onDelete:P,onRefresh:o(B)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),_:1})]),default:l(()=>[n(p,{"checked-row-keys":o(c),"onUpdate:checkedRowKeys":e[4]||(e[4]=i=>K(c)?c.value=i:null),columns:o(x),data:o(I),size:"small","flex-height":!o(_).isMobile,"scroll-x":702,loading:o(O),remote:"","row-key":i=>i.id,pagination:o(r),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),n(Ve,{visible:o(w),"onUpdate:visible":e[5]||(e[5]=i=>K(w)?w.value=i:null),"operate-type":o(E),"row-data":o(D),onSubmitted:o($)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{tt as default};
