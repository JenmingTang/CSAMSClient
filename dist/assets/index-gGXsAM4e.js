import{_ as re,a as ue,b as ie,c as pe,d as ce,N as me,e as de}from"./round-refresh-B7VpfLgK.js";import{u as _e,a as fe,b as G,w as ve,_ as be}from"./table-Gm6yRvUm.js";import{d as Q,M as J,N as ee,a as X,r as ge,O as ye,o as y,c as T,w as t,f as e,g as D,t as j,h as n,$ as d,P as $,Q as te,s as ae,B as U,R as he,S as Ne,J as le,z as we,b as ke,U as P,V as Te,W as xe}from"./index-D6W6_zXP.js";import{s as Be,i as Se,a as Z,d as Ce,b as Ee}from"./club-9izwOJFE.js";import{u as ne}from"./auth-DdtuPNda.js";import{u as Me,_ as Ue,b as oe}from"./form-a8uLA4Rd.js";import{_ as Y}from"./Space-zKntJrGG.js";import{_ as De}from"./Grid-Cxuy6_wU.js";import{_ as Re}from"./DataTable-BesTDHU0.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-BQ2WJ-Rm.js";const Le=Q({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:J({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:J(["submitted"],["update:visible"]),setup(b,{emit:g}){const _=b,h=g,r=ee(b,"visible"),{formRef:N,validate:x,restoreValidation:B}=Me(),R=X(()=>({add:"新增社团人员",edit:"编辑社团人员"})[_.operateType]),o=ge(f());function f(){return{approvalStatus:null,approveReason:"",clubId:null}}X(()=>{var i;return((i=_.rowData)==null?void 0:i.id)||-1});const v=X(()=>_.operateType==="edit");function w(){o.value=f(),_.operateType==="edit"&&_.rowData&&Object.assign(o.value,_.rowData)}function S(){r.value=!1}async function C(){var i;await x(),delete o.value.index,delete o.value.userName,delete o.value.approverName,delete o.value.clubName,await Se(o.value),(i=window.$message)==null||i.success(d("common.updateSuccess")),S(),h("submitted")}ye(r,()=>{r.value&&(w(),B())});const E=[];Be().then(i=>{E.push(...i.data.map(p=>({label:p.name,value:p.id})))});const L=[{label:"待审批",value:0},{label:"审批通过",value:1},{label:"审批拒绝",value:2}];return(i,p)=>{const M=te,k=Ue,I=ae,c=oe,O=U,A=Y,V=he,F=Ne;return y(),T(F,{show:r.value,"onUpdate:show":p[3]||(p[3]=a=>r.value=a),"display-directive":"show",width:360},{default:t(()=>[e(V,{title:R.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[e(A,{size:16},{default:t(()=>[e(O,{onClick:S},{default:t(()=>[D(j(n(d)("common.cancel")),1)]),_:1}),e(O,{type:"primary",onClick:C},{default:t(()=>[D(j(n(d)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(c,{ref_key:"formRef",ref:N,model:o.value},{default:t(()=>[e(k,{label:"社团"},{default:t(()=>[e(M,{value:o.value.clubId,"onUpdate:value":p[0]||(p[0]=a=>o.value.clubId=a),options:E,clearable:""},null,8,["value"])]),_:1}),v.value?(y(),T(k,{key:0,label:"审批状态"},{default:t(()=>[e(M,{value:o.value.approvalStatus,"onUpdate:value":p[1]||(p[1]=a=>o.value.approvalStatus=a),options:L,clearable:""},null,8,["value"])]),_:1})):$("",!0),v.value?(y(),T(k,{key:1,label:"审批原因"},{default:t(()=>[e(I,{value:o.value.approveReason,"onUpdate:value":p[2]||(p[2]=a=>o.value.approveReason=a),type:"textarea"},null,8,["value"])]),_:1})):$("",!0)]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ie=Q({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:J(["reset","search"],["update:model"]),setup(b,{emit:g}){const{hasAuth:_}=ne(),h=g,r=ee(b,"model");function N(){h("reset")}function x(){h("search")}const B=[{label:"待审批",value:"0"},{label:"审批通过",value:"1"},{label:"审批拒绝",value:"2"}];return(R,o)=>{const f=ae,v=re,w=te,S=ue,C=U,E=ie,L=Y,i=De,p=oe,M=pe,k=ce,I=le;return y(),T(I,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(k,{"default-expanded-names":["role-search"]},{default:t(()=>[e(M,{title:n(d)("common.search"),name:"role-search"},{default:t(()=>[e(p,{model:r.value,"label-placement":"left","label-width":80},{default:t(()=>[e(i,{responsive:"screen","item-responsive":""},{default:t(()=>[e(v,{span:"24 s:12 m:6",label:"成员姓名",path:"realName",class:"pr-24px"},{default:t(()=>[e(f,{value:r.value.userName,"onUpdate:value":o[0]||(o[0]=c=>r.value.userName=c)},null,8,["value"])]),_:1}),e(v,{span:"24 s:12 m:6",label:"社团名称",path:"realName",class:"pr-24px"},{default:t(()=>[e(f,{value:r.value.clubName,"onUpdate:value":o[1]||(o[1]=c=>r.value.clubName=c)},null,8,["value"])]),_:1}),e(v,{span:"24 s:12 m:6",label:"审批人",path:"realName",class:"pr-24px"},{default:t(()=>[e(f,{value:r.value.approverName,"onUpdate:value":o[2]||(o[2]=c=>r.value.approverName=c)},null,8,["value"])]),_:1}),e(v,{span:"24 s:12 m:6",label:"审批状态",path:"enabled",class:"pr-24px"},{default:t(()=>[e(w,{value:r.value.approvalStatus,"onUpdate:value":o[3]||(o[3]=c=>r.value.approvalStatus=c),options:B,clearable:""},null,8,["value"])]),_:1}),e(v,{span:"24 s:12 m:6"},{default:t(()=>[e(L,{class:"w-full",justify:"end"},{default:t(()=>[e(C,{onClick:N},{icon:t(()=>[e(S,{class:"text-icon"})]),default:t(()=>[D(" "+j(n(d)("common.reset")),1)]),_:1}),n(_)("BUTTON_SEARCH_CLUB_MEMBER")?(y(),T(C,{key:0,type:"primary",ghost:"",onClick:x},{icon:t(()=>[e(E,{class:"text-icon"})]),default:t(()=>[D(" "+j(n(d)("common.search")),1)]),_:1})):$("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function q(b){return typeof b=="function"||Object.prototype.toString.call(b)==="[object Object]"&&!xe(b)}const Xe=Q({name:"club_club-member",__name:"index",setup(b){const{hasAuth:g}=ne(),_=we(),{columns:h,columnChecks:r,data:N,loading:x,getData:B,getDataByPage:R,mobilePagination:o,searchParams:f,resetSearchParams:v}=_e({apiFn:Z,apiParams:{current:1,size:10,createTime:null,updateTime:null,id:null,userId:null,userName:null,clubId:null,clubName:null,joinTime:null,approverId:null,approverName:null,approvalStatus:null,approveReason:null,approveTime:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:d("common.index"),width:64,align:"center"},{key:"userName",title:"姓名",align:"center",minWidth:100},{key:"clubName",title:"社团名称",align:"center",minWidth:120},{key:"joinTime",title:"加入时间",align:"center",minWidth:120},{key:"createTime",title:"创建时间",align:"center",minWidth:120},{key:"approvalStatus",title:"审批状态",align:"center",minWidth:120,render:a=>{if(a.approvalStatus===null)return null;const l={1:"success",0:"warning",2:"error"};let s;return a.approvalStatus===0&&(s="待审批"),a.approvalStatus===1&&(s="审批通过"),a.approvalStatus===2&&(s="审批拒绝"),e(Te,{type:l[a.approvalStatus]},q(s)?s:{default:()=>[s]})}},{key:"approverName",title:"审批人",align:"center",minWidth:120},{key:"approveTime",title:"审批时间",align:"center",minWidth:120},{key:"approveReason",title:"审批原因",align:"center",minWidth:120},{key:"operate",title:d("common.operate"),align:"center",width:130,render:a=>{let l;return e("div",{class:"flex-center gap-8px"},[g("BUTTON_EDIT_CLUB_MEMBER")?e(U,{type:"primary",ghost:!0,size:"small",onClick:()=>c(a.id)},q(l=d("common.edit"))?l:{default:()=>[l]}):null,g("BUTTON_DELETE_CLUB_MEMBER")&&e(me,{onPositiveClick:()=>I(a.id)},{default:()=>d("common.confirmDelete"),trigger:()=>{let s;return e(U,{type:"error",ghost:!0,size:"small"},q(s=d("common.delete"))?s:{default:()=>[s]})}})])}}]}),{drawerVisible:w,operateType:S,editingData:C,handleAdd:E,handleEdit:L,checkedRowKeys:i,onBatchDeleted:p,onDeleted:M}=fe(N,B);async function k(){console.log(i.value),await Ce(i.value),p()}async function I(a){console.log(a),await Ee(a),M()}function c(a){L(a)}async function O(a,l){const s=h.value.slice(2);let m=[];a?m=(await Z({size:999999})).data.records.map(K=>s.map(se=>A(se,K))):m=N.value.map(u=>s.map(K=>A(K,u)));const H=s.map(u=>F(u)&&u.title||null);m.unshift(H);const z=G.book_new(),W=G.aoa_to_sheet(m);W["!cols"]=s.map(u=>({width:Math.round(Number(u.width)/10||20)})),G.book_append_sheet(z,W,"社团成员列表"),ve(z,"社团成员数据.xlsx")}function A(a,l){if(!V(a))return null;const{key:s}=a;if(s==="operate")return null;if(s==="approvalStatus"){let m;return l.approvalStatus===0&&(m="待审批"),l.approvalStatus===1&&(m="审批通过"),l.approvalStatus===2&&(m="审批拒绝"),m}return l[s]}function V(a){return!!a.key}function F(a){return!!a.title}return(a,l)=>{const s=be,m=de,H=Y,z=Re,W=le;return y(),ke("div",Oe,[e(Ie,{model:n(f),"onUpdate:model":l[0]||(l[0]=u=>P(f)?f.value=u:null),onReset:n(v),onSearch:n(R)},null,8,["model","onReset","onSearch"]),e(W,{title:"社团成员列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[e(H,{align:"end",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[n(g)("BUTTON_EXCEL_CLUB_MEMBER")?(y(),T(n(U),{key:0,size:"small",ghost:"",type:"primary",onClick:l[1]||(l[1]=u=>O(!1))},{icon:t(()=>[e(s,{class:"text-icon"})]),default:t(()=>[l[6]||(l[6]=D(" 导出excel "))]),_:1})):$("",!0),n(g)("BUTTON_EXCEL_CLUB_MEMBER_ALL")?(y(),T(n(U),{key:1,size:"small",ghost:"",type:"primary",onClick:l[2]||(l[2]=u=>O(!0))},{icon:t(()=>[e(s,{class:"text-icon"})]),default:t(()=>[l[7]||(l[7]=D(" 导出全部 "))]),_:1})):$("",!0),e(m,{columns:n(r),"onUpdate:columns":l[3]||(l[3]=u=>P(r)?r.value=u:null),"disabled-delete":n(i).length===0,loading:n(x),"show-add-button-str":"BUTTON_ADD_CLUB_MEMBER","show-batch-delete-button-str":"BUTTON_BATCH_DELETE_CLUB_MEMBER",onAdd:n(E),onDelete:k,onRefresh:n(B)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),_:1})]),default:t(()=>[e(z,{"checked-row-keys":n(i),"onUpdate:checkedRowKeys":l[4]||(l[4]=u=>P(i)?i.value=u:null),columns:n(h),data:n(N),size:"small","flex-height":!n(_).isMobile,"scroll-x":702,loading:n(x),remote:"","row-key":u=>u.id,pagination:n(o),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Le,{visible:n(w),"onUpdate:visible":l[5]||(l[5]=u=>P(w)?w.value=u:null),"operate-type":n(S),"row-data":n(C),onSubmitted:n(R)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Xe as default};
