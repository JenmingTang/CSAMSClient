import{_ as ue,a as ce,b as pe,c as de,d as me,N as _e,e as fe}from"./round-refresh-B7VpfLgK.js";import{u as ve,a as he,b as G,w as be,_ as ye}from"./table-Gm6yRvUm.js";import{i as ge,s as te,a as Z,d as we,b as Ne}from"./info-CJS03HJN.js";import{d as Q,M as q,N as oe,a as X,r as V,O as xe,o as j,c as z,w as t,f as e,g as O,t as H,h as o,$ as v,Q as ae,s as ne,B as A,R as ke,S as Se,P as J,J as le,z as Te,b as Ce,U as F,W as De}from"./index-D6W6_zXP.js";import{u as se}from"./auth-DdtuPNda.js";import{u as Be,_ as Ue,b as ie}from"./form-a8uLA4Rd.js";import{_ as Y}from"./Space-zKntJrGG.js";import{_ as Ie}from"./DatePicker-CeSQ1aZs.js";import{_ as Ee}from"./Grid-Cxuy6_wU.js";import{N as Le,_ as Ae}from"./DataTable-BesTDHU0.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-BQ2WJ-Rm.js";const je=Q({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:q(["submitted"],["update:visible"]),setup(h,{emit:y}){const _=h,N=y,l=oe(h,"visible"),{formRef:x,validate:C,restoreValidation:D}=Be(),k=X(()=>({add:"新增班级",edit:"编辑班级"})[_.operateType]),r=V(b());function b(){return{majorId:null,code:"",name:"",description:""}}X(()=>{var p;return((p=_.rowData)==null?void 0:p.id)||-1}),X(()=>_.operateType==="edit");function u(){r.value=b(),_.operateType==="edit"&&_.rowData&&Object.assign(r.value,_.rowData)}function g(){l.value=!1}async function f(){var p;await C(),delete r.value.index,delete r.value.majorName,await ge(r.value),(p=window.$message)==null||p.success(v("common.updateSuccess")),g(),N("submitted")}xe(l,()=>{l.value&&(u(),D())});const S=V([]);async function B(){const p=await te();S.value=p.data.map(a=>({label:a.name,value:a.id}))}return B(),(p,a)=>{const $=ae,w=Ue,T=ne,R=ie,U=A,I=Y,E=ke,d=Se;return j(),z(d,{show:l.value,"onUpdate:show":a[4]||(a[4]=m=>l.value=m),"display-directive":"show",width:360},{default:t(()=>[e(E,{title:k.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[e(I,{size:16},{default:t(()=>[e(U,{onClick:g},{default:t(()=>[O(H(o(v)("common.cancel")),1)]),_:1}),e(U,{type:"primary",onClick:f},{default:t(()=>[O(H(o(v)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(R,{ref_key:"formRef",ref:x,model:r.value},{default:t(()=>[e(w,{label:"所属专业",path:"roleName"},{default:t(()=>[e($,{value:r.value.majorId,"onUpdate:value":a[0]||(a[0]=m=>r.value.majorId=m),filterable:"",placeholder:"所属专业",options:S.value},null,8,["value","options"])]),_:1}),e(w,{label:"班级名称",path:"roleName"},{default:t(()=>[e(T,{value:r.value.name,"onUpdate:value":a[1]||(a[1]=m=>r.value.name=m),placeholder:"班级名称"},null,8,["value"])]),_:1}),e(w,{label:"班级代码",path:"roleCode"},{default:t(()=>[e(T,{value:r.value.code,"onUpdate:value":a[2]||(a[2]=m=>r.value.code=m),placeholder:"班级代码"},null,8,["value"])]),_:1}),e(w,{label:"班级描述",path:"roleDesc"},{default:t(()=>[e(T,{value:r.value.description,"onUpdate:value":a[3]||(a[3]=m=>r.value.description=m),placeholder:"班级描述",type:"textarea"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Oe=Q({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:q(["reset","search"],["update:model"]),setup(h,{emit:y}){const{hasAuth:_}=se(),N=y,l=oe(h,"model"),x=V([118313526e4,Date.now()]);function C(){x.value=[118313526e4,Date.now()],l.value.range=null,N("reset")}function D(){N("search")}const k=V([]);async function r(){const b=await te();k.value=b.data.map(u=>({label:u.name,value:u.id}))}return r(),(b,u)=>{const g=ae,f=ue,S=ne,B=Ie,p=ce,a=A,$=pe,w=Y,T=Ee,R=ie,U=de,I=me,E=le;return j(),z(E,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(I,{"default-expanded-names":["role-search"]},{default:t(()=>[e(U,{title:o(v)("common.search"),name:"role-search"},{default:t(()=>[e(R,{model:l.value,"label-placement":"left","label-width":80},{default:t(()=>[e(T,{responsive:"screen","item-responsive":""},{default:t(()=>[e(f,{span:"24 s:12 m:6",label:"所属专业",path:"roleName",class:"pr-24px"},{default:t(()=>[e(g,{value:l.value.majorId,"onUpdate:value":u[0]||(u[0]=d=>l.value.majorId=d),filterable:"",placeholder:"所属专业",options:k.value},null,8,["value","options"])]),_:1}),e(f,{span:"24 s:12 m:6",label:"班级名称",path:"roleCode",class:"pr-24px"},{default:t(()=>[e(S,{value:l.value.name,"onUpdate:value":u[1]||(u[1]=d=>l.value.name=d),placeholder:"班级名称"},null,8,["value"])]),_:1}),e(f,{span:"24 s:12 m:6",label:"班级编码",path:"roleCode",class:"pr-24px"},{default:t(()=>[e(S,{value:l.value.code,"onUpdate:value":u[2]||(u[2]=d=>l.value.code=d),placeholder:"班级名称"},null,8,["value"])]),_:1}),e(f,{span:"24 s:12 m:6",label:"创建时间开始",path:"status",class:"pr-24px"},{default:t(()=>[e(B,{value:l.value.createTimeStart,"onUpdate:value":u[3]||(u[3]=d=>l.value.createTimeStart=d),type:"datetime",clearable:""},null,8,["value"])]),_:1}),e(f,{span:"24 s:12 m:6",label:"创建时间结束",path:"status",class:"pr-24px"},{default:t(()=>[e(B,{value:l.value.createTimeEnd,"onUpdate:value":u[4]||(u[4]=d=>l.value.createTimeEnd=d),type:"datetime",clearable:""},null,8,["value"])]),_:1}),e(f,{span:"24 s:12 m:6"},{default:t(()=>[e(w,{class:"w-full",justify:"end"},{default:t(()=>[e(a,{onClick:C},{icon:t(()=>[e(p,{class:"text-icon"})]),default:t(()=>[O(" "+H(o(v)("common.reset")),1)]),_:1}),o(_)("BUTTON_SEARCH_CLASS")?(j(),z(a,{key:0,type:"primary",ghost:"",onClick:D},{icon:t(()=>[e($,{class:"text-icon"})]),default:t(()=>[O(" "+H(o(v)("common.search")),1)]),_:1})):J("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),$e={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ee(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!De(h)}const Je=Q({name:"info_class",__name:"index",setup(h){const{hasAuth:y}=se(),_=Te(),{columns:N,columnChecks:l,data:x,loading:C,getData:D,getDataByPage:k,mobilePagination:r,searchParams:b,resetSearchParams:u}=ve({apiFn:Z,apiParams:{current:1,size:10,createTimeStart:null,createTimeEnd:null,majorId:null,code:null,name:null,description:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"ID",width:64,align:"center"},{key:"majorName",title:"所属专业",width:120,align:"center"},{key:"name",title:"班级名称",align:"center",minWidth:120},{key:"code",title:"班级编码",align:"center",minWidth:120},{key:"description",title:"班级描述",minWidth:120,render:s=>e(Le,{style:"max-width: 120px","line-clamp":2},{default:()=>[s.description]})},{key:"createTime",title:"创建时间",minWidth:120},{key:"operate",title:v("common.operate"),align:"center",width:130,render:s=>{let n;return e("div",{class:"flex-center gap-8px"},[y("BUTTON_EDIT_CLASS")?e(A,{type:"primary",ghost:!0,size:"small",onClick:()=>U(s.id)},ee(n=v("common.edit"))?n:{default:()=>[n]}):null,y("BUTTON_DELETE_CLASS")&&e(_e,{onPositiveClick:()=>R(s.id)},{default:()=>v("common.confirmDelete"),trigger:()=>{let c;return e(A,{type:"error",ghost:!0,size:"small"},ee(c=v("common.delete"))?c:{default:()=>[c]})}})])}}]}),{drawerVisible:g,operateType:f,editingData:S,handleAdd:B,handleEdit:p,checkedRowKeys:a,onBatchDeleted:$,onDeleted:w}=he(x,D);async function T(){console.log(a.value),await we(a.value),$()}async function R(s){console.log(s),await Ne(s),w()}function U(s){p(s)}async function I(s,n){const c=N.value.slice(2);let L=[];s?L=(await Z({size:999999})).data.records.map(K=>c.map(re=>E(re,K))):L=x.value.map(i=>c.map(K=>E(K,i)));const W=c.map(i=>m(i)&&i.title||null);L.unshift(W);const P=G.book_new(),M=G.aoa_to_sheet(L);M["!cols"]=c.map(i=>({width:Math.round(Number(i.width)/10||20)})),G.book_append_sheet(P,M,"班级列表"),be(P,"班级数据.xlsx")}function E(s,n){if(!d(s))return null;const{key:c}=s;return c==="operate"?null:n[c]}function d(s){return!!s.key}function m(s){return!!s.title}return(s,n)=>{const c=ye,L=fe,W=Y,P=Ae,M=le;return j(),Ce("div",$e,[e(Oe,{model:o(b),"onUpdate:model":n[0]||(n[0]=i=>F(b)?b.value=i:null),onReset:o(u),onSearch:o(k)},null,8,["model","onReset","onSearch"]),e(M,{title:"班级列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[e(W,{align:"end",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[o(y)("BUTTON_EXCEL_CLASS")?(j(),z(o(A),{key:0,size:"small",ghost:"",type:"primary",onClick:n[1]||(n[1]=i=>I(!1))},{icon:t(()=>[e(c,{class:"text-icon"})]),default:t(()=>[n[6]||(n[6]=O(" 导出excel "))]),_:1})):J("",!0),o(y)("BUTTON_EXCEL_CLASS_ALL")?(j(),z(o(A),{key:1,size:"small",ghost:"",type:"primary",onClick:n[2]||(n[2]=i=>I(!0))},{icon:t(()=>[e(c,{class:"text-icon"})]),default:t(()=>[n[7]||(n[7]=O(" 导出全部 "))]),_:1})):J("",!0),e(L,{columns:o(l),"onUpdate:columns":n[3]||(n[3]=i=>F(l)?l.value=i:null),"disabled-delete":o(a).length===0,loading:o(C),"show-add-button-str":"BUTTON_ADD_CLASS","show-batch-delete-button-str":"BUTTON_BATCH_DELETE_CLASS",onAdd:o(B),onDelete:T,onRefresh:o(D)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),_:1})]),default:t(()=>[e(P,{"checked-row-keys":o(a),"onUpdate:checkedRowKeys":n[4]||(n[4]=i=>F(a)?a.value=i:null),columns:o(N),data:o(x),size:"small","flex-height":!o(_).isMobile,"scroll-x":702,loading:o(C),remote:"","row-key":i=>i.id,pagination:o(r),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(je,{visible:o(g),"onUpdate:visible":n[5]||(n[5]=i=>F(g)?g.value=i:null),"operate-type":o(f),"row-data":o(S),onSubmitted:o(k)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{Je as default};
