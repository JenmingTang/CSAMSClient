import{_ as ue,a as pe,b as de,c as ce,d as me,N as _e,e as fe}from"./round-refresh-B7VpfLgK.js";import{u as ve,a as he,b as K,w as ye,_ as be}from"./table-Gm6yRvUm.js";import{j as ge,h as te,k as Z,l as we,m as Ne}from"./info-CJS03HJN.js";import{d as Q,M as X,N as ne,a as G,r as F,O as ke,o as E,c as L,w as t,f as e,g as A,t as V,h as n,$ as v,Q as ae,s as oe,B as R,R as xe,S as Te,P as q,J as le,z as De,b as Ce,U as J,W as Be}from"./index-D6W6_zXP.js";import{u as se}from"./auth-DdtuPNda.js";import{u as Se,_ as Ue,b as re}from"./form-a8uLA4Rd.js";import{_ as Y}from"./Space-zKntJrGG.js";import{_ as Oe}from"./DatePicker-CeSQ1aZs.js";import{_ as Ie}from"./Grid-Cxuy6_wU.js";import{N as Me,_ as Re}from"./DataTable-BesTDHU0.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-BQ2WJ-Rm.js";const Ee=Q({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:X({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:X(["submitted"],["update:visible"]),setup(h,{emit:b}){const _=h,N=b,l=ne(h,"visible"),{formRef:k,validate:C,restoreValidation:B}=Se(),x=G(()=>({add:"新增专业",edit:"编辑专业"})[_.operateType]),i=F(y());function y(){return{departmentId:null,code:"",name:"",description:""}}G(()=>{var d;return((d=_.rowData)==null?void 0:d.id)||-1}),G(()=>_.operateType==="edit");function u(){i.value=y(),_.operateType==="edit"&&_.rowData&&Object.assign(i.value,_.rowData)}function g(){l.value=!1}async function f(){var d;await C(),delete i.value.index,delete i.value.departmentName,await ge(i.value),(d=window.$message)==null||d.success(v("common.updateSuccess")),g(),N("submitted")}ke(l,()=>{l.value&&(u(),B())});const T=F([]);async function S(){const d=await te();T.value=d.data.map(a=>({label:a.name,value:a.id}))}return S(),(d,a)=>{const $=ae,w=Ue,D=oe,j=re,U=R,O=Y,I=xe,c=Te;return E(),L(c,{show:l.value,"onUpdate:show":a[4]||(a[4]=m=>l.value=m),"display-directive":"show",width:360},{default:t(()=>[e(I,{title:x.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[e(O,{size:16},{default:t(()=>[e(U,{onClick:g},{default:t(()=>[A(V(n(v)("common.cancel")),1)]),_:1}),e(U,{type:"primary",onClick:f},{default:t(()=>[A(V(n(v)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(j,{ref_key:"formRef",ref:k,model:i.value},{default:t(()=>[e(w,{label:"所属部门",path:"roleName"},{default:t(()=>[e($,{value:i.value.departmentId,"onUpdate:value":a[0]||(a[0]=m=>i.value.departmentId=m),filterable:"",placeholder:"所属部门",options:T.value},null,8,["value","options"])]),_:1}),e(w,{label:"专业名称",path:"roleName"},{default:t(()=>[e(D,{value:i.value.name,"onUpdate:value":a[1]||(a[1]=m=>i.value.name=m),placeholder:"专业名称"},null,8,["value"])]),_:1}),e(w,{label:"专业代码",path:"roleCode"},{default:t(()=>[e(D,{value:i.value.code,"onUpdate:value":a[2]||(a[2]=m=>i.value.code=m),placeholder:"专业代码"},null,8,["value"])]),_:1}),e(w,{label:"专业描述",path:"roleDesc"},{default:t(()=>[e(D,{value:i.value.description,"onUpdate:value":a[3]||(a[3]=m=>i.value.description=m),placeholder:"专业描述",type:"textarea"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ae=Q({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:X(["reset","search"],["update:model"]),setup(h,{emit:b}){const{hasAuth:_}=se(),N=b,l=ne(h,"model"),k=F([118313526e4,Date.now()]);function C(){k.value=[118313526e4,Date.now()],N("reset")}function B(){N("search")}const x=F([]);async function i(){const y=await te();x.value=y.data.map(u=>({label:u.name,value:u.id}))}return i(),(y,u)=>{const g=ae,f=ue,T=oe,S=Oe,d=pe,a=R,$=de,w=Y,D=Ie,j=re,U=ce,O=me,I=le;return E(),L(I,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(O,{"default-expanded-names":["role-search"]},{default:t(()=>[e(U,{title:n(v)("common.search"),name:"role-search"},{default:t(()=>[e(j,{model:l.value,"label-placement":"left","label-width":80},{default:t(()=>[e(D,{responsive:"screen","item-responsive":""},{default:t(()=>[e(f,{span:"24 s:12 m:6",label:"所属部门",path:"roleName",class:"pr-24px"},{default:t(()=>[e(g,{value:l.value.departmentId,"onUpdate:value":u[0]||(u[0]=c=>l.value.departmentId=c),filterable:"",placeholder:"所属部门",options:x.value},null,8,["value","options"])]),_:1}),e(f,{span:"24 s:12 m:6",label:"专业名称",path:"roleCode",class:"pr-24px"},{default:t(()=>[e(T,{value:l.value.name,"onUpdate:value":u[1]||(u[1]=c=>l.value.name=c),placeholder:"专业名称"},null,8,["value"])]),_:1}),e(f,{span:"24 s:12 m:6",label:"专业编码",path:"roleCode",class:"pr-24px"},{default:t(()=>[e(T,{value:l.value.code,"onUpdate:value":u[2]||(u[2]=c=>l.value.code=c),placeholder:"专业名称"},null,8,["value"])]),_:1}),e(f,{span:"24 s:12 m:6",label:"创建时间开始",path:"status",class:"pr-24px"},{default:t(()=>[e(S,{value:l.value.createTimeStart,"onUpdate:value":u[3]||(u[3]=c=>l.value.createTimeStart=c),type:"datetime",clearable:""},null,8,["value"])]),_:1}),e(f,{span:"24 s:12 m:6",label:"创建时间结束",path:"status",class:"pr-24px"},{default:t(()=>[e(S,{value:l.value.createTimeEnd,"onUpdate:value":u[4]||(u[4]=c=>l.value.createTimeEnd=c),type:"datetime",clearable:""},null,8,["value"])]),_:1}),e(f,{span:"24 s:12 m:6"},{default:t(()=>[e(w,{class:"w-full",justify:"end"},{default:t(()=>[e(a,{onClick:C},{icon:t(()=>[e(d,{class:"text-icon"})]),default:t(()=>[A(" "+V(n(v)("common.reset")),1)]),_:1}),n(_)("BUTTON_SEARCH_MAJOR")?(E(),L(a,{key:0,type:"primary",ghost:"",onClick:B},{icon:t(()=>[e($,{class:"text-icon"})]),default:t(()=>[A(" "+V(n(v)("common.search")),1)]),_:1})):q("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),$e={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ee(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!Be(h)}const qe=Q({name:"info_major",__name:"index",setup(h){const{hasAuth:b}=se(),_=De(),{columns:N,columnChecks:l,data:k,loading:C,getData:B,getDataByPage:x,mobilePagination:i,searchParams:y,resetSearchParams:u}=ve({apiFn:Z,apiParams:{current:1,size:10,createTimeStart:null,createTimeEnd:null,departmentId:null,code:null,name:null,description:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"id",title:"ID",width:64,align:"center"},{key:"departmentName",title:"所属部门",width:120,align:"center"},{key:"name",title:"专业名称",align:"center",minWidth:120},{key:"code",title:"专业编码",align:"center",minWidth:120},{key:"description",title:"专业描述",minWidth:120,render:s=>e(Me,{style:"max-width: 120px","line-clamp":2},{default:()=>[s.description]})},{key:"createTime",title:"创建时间",minWidth:120},{key:"operate",title:v("common.operate"),align:"center",width:130,render:s=>{let o;return e("div",{class:"flex-center gap-8px"},[b("BUTTON_EDIT_MAJOR")?e(R,{type:"primary",ghost:!0,size:"small",onClick:()=>U(s.id)},ee(o=v("common.edit"))?o:{default:()=>[o]}):null,b("BUTTON_DELETE_MAJOR")&&e(_e,{onPositiveClick:()=>j(s.id)},{default:()=>v("common.confirmDelete"),trigger:()=>{let p;return e(R,{type:"error",ghost:!0,size:"small"},ee(p=v("common.delete"))?p:{default:()=>[p]})}})])}}]}),{drawerVisible:g,operateType:f,editingData:T,handleAdd:S,handleEdit:d,checkedRowKeys:a,onBatchDeleted:$,onDeleted:w}=he(k,B);async function D(){console.log(a.value),await we(a.value),$()}async function j(s){console.log(s),await Ne(s),w()}function U(s){d(s)}async function O(s,o){const p=N.value.slice(2);let M=[];s?M=(await Z({size:999999})).data.records.map(W=>p.map(ie=>I(ie,W))):M=k.value.map(r=>p.map(W=>I(W,r)));const H=p.map(r=>m(r)&&r.title||null);M.unshift(H);const z=K.book_new(),P=K.aoa_to_sheet(M);P["!cols"]=p.map(r=>({width:Math.round(Number(r.width)/10||20)})),K.book_append_sheet(z,P,"专业列表"),ye(z,"专业数据.xlsx")}function I(s,o){if(!c(s))return null;const{key:p}=s;return p==="operate"?null:o[p]}function c(s){return!!s.key}function m(s){return!!s.title}return(s,o)=>{const p=be,M=fe,H=Y,z=Re,P=le;return E(),Ce("div",$e,[e(Ae,{model:n(y),"onUpdate:model":o[0]||(o[0]=r=>J(y)?y.value=r:null),onReset:n(u),onSearch:n(x)},null,8,["model","onReset","onSearch"]),e(P,{title:"专业列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[e(H,{align:"end",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[n(b)("BUTTON_EXCEL_MAJOR")?(E(),L(n(R),{key:0,size:"small",ghost:"",type:"primary",onClick:o[1]||(o[1]=r=>O(!1))},{icon:t(()=>[e(p,{class:"text-icon"})]),default:t(()=>[o[6]||(o[6]=A(" 导出excel "))]),_:1})):q("",!0),n(b)("BUTTON_EXCEL_MAJOR_ALL")?(E(),L(n(R),{key:1,size:"small",ghost:"",type:"primary",onClick:o[2]||(o[2]=r=>O(!0))},{icon:t(()=>[e(p,{class:"text-icon"})]),default:t(()=>[o[7]||(o[7]=A(" 导出全部 "))]),_:1})):q("",!0),e(M,{columns:n(l),"onUpdate:columns":o[3]||(o[3]=r=>J(l)?l.value=r:null),"disabled-delete":n(a).length===0,loading:n(C),"show-add-button-str":"BUTTON_ADD_MAJOR","show-batch-delete-button-str":"BUTTON_BATCH_DELETE_MAJOR",onAdd:n(S),onDelete:D,onRefresh:n(B)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),_:1})]),default:t(()=>[e(z,{"checked-row-keys":n(a),"onUpdate:checkedRowKeys":o[4]||(o[4]=r=>J(a)?a.value=r:null),columns:n(N),data:n(k),size:"small","flex-height":!n(_).isMobile,"scroll-x":702,loading:n(C),remote:"","row-key":r=>r.id,pagination:n(i),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ee,{visible:n(g),"onUpdate:visible":o[5]||(o[5]=r=>J(g)?g.value=r:null),"operate-type":n(f),"row-data":n(T),onSubmitted:n(x)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{qe as default};
