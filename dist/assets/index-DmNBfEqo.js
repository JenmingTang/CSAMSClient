import{_ as ie,a as re,b as ue,c as pe,d as ce,N as me,e as de}from"./round-refresh-B7VpfLgK.js";import{u as _e,a as ve,b as K,w as fe,_ as ye}from"./table-Gm6yRvUm.js";import{d as J,M as q,N as ee,a as G,r as be,O as ge,o as b,c as h,w as t,f as e,g as D,t as P,h as n,$ as _,P as M,Q as te,s as ae,B as I,R as he,S as Ne,J as le,z as Te,b as we,U as j,V as ke,W as xe}from"./index-D6W6_zXP.js";import{b as Se,c as Be,e as Z,f as Ce,g as Ee}from"./activity-C6741kjc.js";import{u as ne}from"./auth-DdtuPNda.js";import{u as Ie,_ as Me,b as oe}from"./form-a8uLA4Rd.js";import{_ as Q}from"./Space-zKntJrGG.js";import{_ as De}from"./DatePicker-CeSQ1aZs.js";import{_ as Re}from"./Grid-Cxuy6_wU.js";import{_ as Ae}from"./DataTable-BesTDHU0.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-BQ2WJ-Rm.js";const Ue=J({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:q(["submitted"],["update:visible"]),setup(y,{emit:g}){const v=y,N=g,i=ee(y,"visible"),{formRef:T,validate:S,restoreValidation:B}=Ie(),R=G(()=>({add:"新增活动成员",edit:"编辑活动成员"})[v.operateType]),o=be(f());function f(){return{activityId:null,approvalStatus:null,approveReason:""}}G(()=>{var u;return((u=v.rowData)==null?void 0:u.id)||-1});const m=G(()=>v.operateType==="edit");function w(){o.value=f(),v.operateType==="edit"&&v.rowData&&Object.assign(o.value,v.rowData)}function C(){i.value=!1}async function A(){var u;await S(),delete o.value.index,delete o.value.userName,delete o.value.activityName,delete o.value.approverName,await Be(o.value),(u=window.$message)==null||u.success(_("common.updateSuccess")),C(),N("submitted")}ge(i,()=>{i.value&&(w(),B())});const k=[],U=[{label:"待审批",value:0},{label:"审批通过",value:1},{label:"审批拒绝",value:2}];return Se().then(u=>{k.push(...u.data.map(p=>({label:p.title,value:p.id})))}),(u,p)=>{const E=te,x=Me,O=ae,V=oe,c=I,$=Q,W=he,F=Ne;return b(),h(F,{show:i.value,"onUpdate:show":p[3]||(p[3]=a=>i.value=a),"display-directive":"show",width:360},{default:t(()=>[e(W,{title:R.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[e($,{size:16},{default:t(()=>[e(c,{onClick:C},{default:t(()=>[D(P(n(_)("common.cancel")),1)]),_:1}),e(c,{type:"primary",onClick:A},{default:t(()=>[D(P(n(_)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(V,{ref_key:"formRef",ref:T,model:o.value},{default:t(()=>[m.value?M("",!0):(b(),h(x,{key:0,label:"所属活动"},{default:t(()=>[e(E,{value:o.value.activityId,"onUpdate:value":p[0]||(p[0]=a=>o.value.activityId=a),options:k,clearable:""},null,8,["value"])]),_:1})),m.value?(b(),h(x,{key:1,label:"审批状态"},{default:t(()=>[e(E,{value:o.value.approvalStatus,"onUpdate:value":p[1]||(p[1]=a=>o.value.approvalStatus=a),options:U,clearable:""},null,8,["value"])]),_:1})):M("",!0),m.value?(b(),h(x,{key:2,label:"审批原因"},{default:t(()=>[e(O,{value:o.value.approveReason,"onUpdate:value":p[2]||(p[2]=a=>o.value.approveReason=a),type:"textarea"},null,8,["value"])]),_:1})):M("",!0)]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Oe=J({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:q(["reset","search"],["update:model"]),setup(y,{emit:g}){const{hasAuth:v}=ne(),N=g,i=ee(y,"model");function T(){N("reset")}function S(){N("search")}const B=[{label:"待审批",value:"0"},{label:"审批通过",value:"1"},{label:"审批拒绝",value:"2"}];return(R,o)=>{const f=ae,m=ie,w=De,C=te,A=re,k=I,U=ue,u=Q,p=Re,E=oe,x=pe,O=ce,V=le;return b(),h(V,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(O,{"default-expanded-names":["role-search"]},{default:t(()=>[e(x,{title:n(_)("common.search"),name:"role-search"},{default:t(()=>[e(E,{model:i.value,"label-placement":"left","label-width":80},{default:t(()=>[e(p,{responsive:"screen","item-responsive":""},{default:t(()=>[e(m,{span:"24 s:12 m:6",label:"用户名称",path:"realName",class:"pr-24px"},{default:t(()=>[e(f,{value:i.value.userName,"onUpdate:value":o[0]||(o[0]=c=>i.value.userName=c)},null,8,["value"])]),_:1}),e(m,{span:"24 s:12 m:6",label:"所属活动",path:"realName",class:"pr-24px"},{default:t(()=>[e(f,{value:i.value.activityName,"onUpdate:value":o[1]||(o[1]=c=>i.value.activityName=c)},null,8,["value"])]),_:1}),e(m,{span:"24 s:12 m:6",label:"加入时间（前后共一小时）",path:"status",class:"pr-24px"},{default:t(()=>[e(w,{value:i.value.joinTime,"onUpdate:value":o[2]||(o[2]=c=>i.value.joinTime=c),type:"datetime",clearable:""},null,8,["value"])]),_:1}),e(m,{span:"24 s:12 m:6",label:"审批状态",path:"enabled",class:"pr-24px"},{default:t(()=>[e(C,{value:i.value.approvalStatus,"onUpdate:value":o[3]||(o[3]=c=>i.value.approvalStatus=c),options:B,clearable:""},null,8,["value"])]),_:1}),e(m,{span:"24 s:12 m:6",label:"审批人",path:"realName",class:"pr-24px"},{default:t(()=>[e(f,{value:i.value.approverName,"onUpdate:value":o[4]||(o[4]=c=>i.value.approverName=c)},null,8,["value"])]),_:1}),e(m,{span:"24 s:12 m:6"},{default:t(()=>[e(u,{class:"w-full",justify:"end"},{default:t(()=>[e(k,{onClick:T},{icon:t(()=>[e(A,{class:"text-icon"})]),default:t(()=>[D(" "+P(n(_)("common.reset")),1)]),_:1}),n(v)("BUTTON_SEARCH_ACTIVITY_MEMBER")?(b(),h(k,{key:0,type:"primary",ghost:"",onClick:S},{icon:t(()=>[e(U,{class:"text-icon"})]),default:t(()=>[D(" "+P(n(_)("common.search")),1)]),_:1})):M("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Ve={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function X(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!xe(y)}const qe=J({name:"activity_activity-member",__name:"index",setup(y){const{hasAuth:g}=ne(),v=Te(),{columns:N,columnChecks:i,data:T,loading:S,getData:B,getDataByPage:R,mobilePagination:o,searchParams:f,resetSearchParams:m}=_e({apiFn:Z,apiParams:{current:1,size:10,approvalStatus:null,approveReason:null,approverId:null,approveTime:null,createTime:null,updateTime:null,id:null,userId:null,activityId:null,joinTime:null,userName:null,activityName:null,approverName:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:_("common.index"),width:64,align:"center"},{key:"userName",title:"用户名称",align:"center",minWidth:120},{key:"activityName",title:"活动名称",align:"center",minWidth:120},{key:"joinTime",title:"加入时间",align:"center",minWidth:120},{key:"createTime",title:"创建时间",align:"center",minWidth:120},{key:"approvalStatus",title:"审批状态",align:"center",minWidth:120,render:a=>{if(a.approvalStatus===null)return null;const l={1:"success",0:"warning",2:"error"};let s;return a.approvalStatus===0&&(s="待审批"),a.approvalStatus===1&&(s="审批通过"),a.approvalStatus===2&&(s="审批拒绝"),e(ke,{type:l[a.approvalStatus]},X(s)?s:{default:()=>[s]})}},{key:"approverName",title:"审批人",align:"center",minWidth:120},{key:"approveTime",title:"审批时间",align:"center",minWidth:120},{key:"approveReason",title:"审批原因",align:"center",minWidth:120},{key:"operate",title:_("common.operate"),align:"center",width:130,render:a=>{let l;return e("div",{class:"flex-center gap-8px"},[g("BUTTON_EDIT_ACTIVITY_MEMBER")?e(I,{type:"primary",ghost:!0,size:"small",onClick:()=>V(a.id)},X(l=_("common.edit"))?l:{default:()=>[l]}):null,g("BUTTON_DELETE_ACTIVITY_MEMBER")&&e(me,{onPositiveClick:()=>O(a.id)},{default:()=>_("common.confirmDelete"),trigger:()=>{let s;return e(I,{type:"error",ghost:!0,size:"small"},X(s=_("common.delete"))?s:{default:()=>[s]})}})])}}]}),{drawerVisible:w,operateType:C,editingData:A,handleAdd:k,handleEdit:U,checkedRowKeys:u,onBatchDeleted:p,onDeleted:E}=ve(T,B);async function x(){console.log(u.value),await Ce(u.value),p()}async function O(a){console.log(a),await Ee(a),E()}function V(a){U(a)}async function c(a,l){const s=N.value.slice(2);let d=[];a?d=(await Z({size:999999})).data.records.map(H=>s.map(se=>$(se,H))):d=T.value.map(r=>s.map(H=>$(H,r)));const Y=s.map(r=>F(r)&&r.title||null);d.unshift(Y);const L=K.book_new(),z=K.aoa_to_sheet(d);z["!cols"]=s.map(r=>({width:Math.round(Number(r.width)/10||20)})),K.book_append_sheet(L,z,"活动成员列表"),fe(L,"活动成员数据.xlsx")}function $(a,l){if(!W(a))return null;const{key:s}=a;if(s==="operate")return null;if(s==="approvalStatus"){let d;return l.approvalStatus===0&&(d="待审批"),l.approvalStatus===1&&(d="审批通过"),l.approvalStatus===2&&(d="审批拒绝"),d}return l[s]}function W(a){return!!a.key}function F(a){return!!a.title}return(a,l)=>{const s=ye,d=de,Y=Q,L=Ae,z=le;return b(),we("div",Ve,[e(Oe,{model:n(f),"onUpdate:model":l[0]||(l[0]=r=>j(f)?f.value=r:null),onReset:n(m),onSearch:n(R)},null,8,["model","onReset","onSearch"]),e(z,{title:"活动成员列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[e(Y,{align:"end",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[n(g)("BUTTON_EXCEL_ACTIVITY_MEMBER")?(b(),h(n(I),{key:0,size:"small",ghost:"",type:"primary",onClick:l[1]||(l[1]=r=>c(!1))},{icon:t(()=>[e(s,{class:"text-icon"})]),default:t(()=>[l[6]||(l[6]=D(" 导出excel "))]),_:1})):M("",!0),n(g)("BUTTON_EXCEL_ACTIVITY_MEMBER_ALL")?(b(),h(n(I),{key:1,size:"small",ghost:"",type:"primary",onClick:l[2]||(l[2]=r=>c(!0))},{icon:t(()=>[e(s,{class:"text-icon"})]),default:t(()=>[l[7]||(l[7]=D(" 导出全部 "))]),_:1})):M("",!0),e(d,{columns:n(i),"onUpdate:columns":l[3]||(l[3]=r=>j(i)?i.value=r:null),"disabled-delete":n(u).length===0,loading:n(S),"show-add-button-str":"BUTTON_ADD_ACTIVITY_MEMBER","show-batch-delete-button-str":"BUTTON_BATCH_DELETE_ACTIVITY_MEMBER",onAdd:n(k),onDelete:x,onRefresh:n(B)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),_:1})]),default:t(()=>[e(L,{"checked-row-keys":n(u),"onUpdate:checkedRowKeys":l[4]||(l[4]=r=>j(u)?u.value=r:null),columns:n(N),data:n(T),size:"small","flex-height":!n(v).isMobile,"scroll-x":702,loading:n(S),remote:"","row-key":r=>r.id,pagination:n(o),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ue,{visible:n(w),"onUpdate:visible":l[5]||(l[5]=r=>j(w)?w.value=r:null),"operate-type":n(C),"row-data":n(A),onSubmitted:n(R)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{qe as default};
