import{_ as _e,a as ge,b as fe,c as ve,d as he,N as be,e as ye}from"./round-refresh-B7VpfLgK.js";import{c as T,b as ke,g as Ne,h as we}from"./auth-B8TiMeOF.js";import{r as $,a as z,$ as t,au as L,av as Ue,d as Y,M as q,N as ae,O as De,o as M,c as F,w as n,f as a,g as A,t as I,h as e,b as H,K as J,L as Q,s as te,Q as le,B as V,R as Se,S as xe,aw as X,J as ne,z as Re,p as Ce,V as Z,U as W,W as Pe}from"./index-D6W6_zXP.js";import{u as se,e as oe,a as Ge,b as Ee}from"./business-B55Z98WP.js";import{u as re,a as ue,_ as Be,b as ie}from"./form-a8uLA4Rd.js";import{a as Me,b as Te,_ as Oe}from"./DataTable-BesTDHU0.js";import{_ as pe}from"./Space-zKntJrGG.js";import{_ as $e}from"./Grid-Cxuy6_wU.js";import"./auth-DdtuPNda.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-BQ2WJ-Rm.js";function Fe(){return T.Get("/systemManage/getAllRoles")}function ze(o){return T.Get("/systemManage/getUserList",{params:o})}function Ae(o){return T.Post("/systemManage/addUser",o)}function Ie(o){return T.Post("/systemManage/updateUser",o)}function Ve(o){return T.Delete("/systemManage/deleteUser",{id:o})}function Ke(o){return T.Delete("/systemManage/batchDeleteUser",{ids:o})}function ee(o){return!!o.key}function je(o){const k="__selection__",g="__expand__",f=$((r=>{const d=[];return r.forEach(v=>{ee(v)?d.push({key:v.key,title:v.title,checked:!0}):v.type==="selection"?d.push({key:k,title:t("common.check"),checked:!0}):v.type==="expand"&&d.push({key:g,title:t("common.expandColumn"),checked:!0})}),d})(o())),C=z(()=>{const r=o(),d=new Map;return r.forEach(m=>{ee(m)?d.set(m.key,m):m.type==="selection"?d.set(k,m):m.type==="expand"&&d.set(g,m)}),f.value.filter(m=>m.checked).map(m=>d.get(m.key))});return{columnChecks:f,columns:C}}function Le(o,k){const{bool:g,setTrue:S,setFalse:f}=L(),{bool:C,setTrue:r,setFalse:d}=L(),{bool:v,setTrue:m,setFalse:E}=L(),D=$("add"),c=w=>o.value.find(h=>h.id===w)||null;function s(){D.value="add",S()}const N=$(null);function P(w){D.value="edit",N.value=Ue(c(w)),S()}const x=$([]);async function G(){var w,h;m();try{const R=x.value.map(_=>c(_)).filter(Boolean);await((w=k.batchDelete)==null?void 0:w.call(k,R)),(h=window.$message)==null||h.success(t("common.deleteSuccess")),x.value=[]}finally{E()}}async function B(w){var R,_;r();const h=c(w);if(h)try{await((R=k.delete)==null?void 0:R.call(k,h)),(_=window.$message)==null||_.success(t("common.deleteSuccess")),x.value=[]}finally{d()}}return{drawerVisible:g,openDrawer:S,closeDrawer:f,operateType:D,handleAdd:s,editingData:N,handleEdit:P,checkedRowKeys:x,deleting:C,handleDelete:B,batchDeleting:v,handleBatchDelete:G}}const We=Y({name:"UserOperateDrawer",__name:"user-operate-drawer",props:q({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:q(["submitted"],["update:visible"]),setup(o,{emit:k}){const g=o,S=k,f=ae(o,"visible"),{formRef:C,validate:r,restoreValidation:d}=re(),{defaultRequiredRule:v}=ue(),m=z(()=>({add:t("page.manage.user.addUser"),edit:t("page.manage.user.editUser")})[g.operateType]),{loading:E,reset:D,send:c,form:s,updateForm:N}=ke(_=>g.operateType==="add"?Ae(_):Ie(_),{initialForm:{userName:"",userGender:null,nickName:"",userPhone:"",userEmail:"",userRoles:[],status:null},resetAfterSubmiting:!0}),P={userName:v,status:v},{data:x,loading:G}=Ne(Fe,[f],{initialData:[],middleware(_,u){return f.value?u():void 0}}),B=z(()=>{const _=x.value.map(U=>({label:U.roleName,value:U.roleCode}));return[...s.value.userRoles.map(U=>({label:U,value:U})),..._]});function w(){g.operateType==="edit"&&g.rowData?N(g.rowData):g.operateType==="add"&&D()}function h(){f.value=!1}async function R(){var _;await r(),await c(),(_=window.$message)==null||_.success(t("common.updateSuccess")),h(),S("submitted")}return De(f,()=>{f.value&&(d(),w())}),(_,u)=>{const U=te,l=Be,i=Te,b=Me,K=le,j=ie,y=V,de=pe,ce=Se,me=xe;return M(),F(me,{show:f.value,"onUpdate:show":u[7]||(u[7]=p=>f.value=p),"display-directive":"show",width:360},{default:n(()=>[a(ce,{title:m.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[a(de,{size:16},{default:n(()=>[a(y,{onClick:h},{default:n(()=>[A(I(e(t)("common.cancel")),1)]),_:1}),a(y,{type:"primary",loading:e(E),onClick:R},{default:n(()=>[A(I(e(t)("common.confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:n(()=>[a(j,{ref_key:"formRef",ref:C,model:e(s),rules:P},{default:n(()=>[a(l,{label:e(t)("page.manage.user.userName"),path:"userName"},{default:n(()=>[a(U,{value:e(s).userName,"onUpdate:value":u[0]||(u[0]=p=>e(s).userName=p),placeholder:e(t)("page.manage.user.form.userName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userGender"),path:"userGender"},{default:n(()=>[a(b,{value:e(s).userGender,"onUpdate:value":u[1]||(u[1]=p=>e(s).userGender=p)},{default:n(()=>[(M(!0),H(Q,null,J(e(se),p=>(M(),F(i,{key:p.value,value:p.value,label:e(t)(p.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.nickName"),path:"nickName"},{default:n(()=>[a(U,{value:e(s).nickName,"onUpdate:value":u[2]||(u[2]=p=>e(s).nickName=p),placeholder:e(t)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userPhone"),path:"userPhone"},{default:n(()=>[a(U,{value:e(s).userPhone,"onUpdate:value":u[3]||(u[3]=p=>e(s).userPhone=p),placeholder:e(t)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userEmail"),path:"email"},{default:n(()=>[a(U,{value:e(s).userEmail,"onUpdate:value":u[4]||(u[4]=p=>e(s).userEmail=p),placeholder:e(t)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userStatus"),path:"status"},{default:n(()=>[a(b,{value:e(s).status,"onUpdate:value":u[5]||(u[5]=p=>e(s).status=p)},{default:n(()=>[(M(!0),H(Q,null,J(e(oe),p=>(M(),F(i,{key:p.value,value:p.value,label:e(t)(p.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(l,{label:e(t)("page.manage.user.userRole"),path:"roles"},{default:n(()=>[a(K,{value:e(s).userRoles,"onUpdate:value":u[6]||(u[6]=p=>e(s).userRoles=p),multiple:"",loading:e(G),options:B.value,placeholder:e(t)("page.manage.user.form.userRole")},null,8,["value","loading","options","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),qe=Y({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:q(["search"],["update:model"]),setup(o,{emit:k}){const g=k,{formRef:S,validate:f,restoreValidation:C}=re(),r=ae(o,"model"),d={...r.value},v=z(()=>{const{patternRules:D}=ue();return{userEmail:D.email,userPhone:D.phone}});async function m(){await C(),Object.assign(r.value,d)}async function E(){await f(),g("search")}return(D,c)=>{const s=te,N=_e,P=le,x=ge,G=V,B=fe,w=pe,h=$e,R=ie,_=ve,u=he,U=ne;return M(),F(U,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[a(u,{"default-expanded-names":["user-search"]},{default:n(()=>[a(_,{title:e(t)("common.search"),name:"user-search"},{default:n(()=>[a(R,{ref_key:"formRef",ref:S,model:r.value,rules:v.value,"label-placement":"left","label-width":80},{default:n(()=>[a(h,{responsive:"screen","item-responsive":""},{default:n(()=>[a(N,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userName"),path:"userName",class:"pr-24px"},{default:n(()=>[a(s,{value:r.value.userName,"onUpdate:value":c[0]||(c[0]=l=>r.value.userName=l),placeholder:e(t)("page.manage.user.form.userName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(N,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userGender"),path:"userGender",class:"pr-24px"},{default:n(()=>[a(P,{value:r.value.userGender,"onUpdate:value":c[1]||(c[1]=l=>r.value.userGender=l),placeholder:e(t)("page.manage.user.form.userGender"),options:e(X)(e(se)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(N,{span:"24 s:12 m:6",label:e(t)("page.manage.user.nickName"),path:"nickName",class:"pr-24px"},{default:n(()=>[a(s,{value:r.value.nickName,"onUpdate:value":c[2]||(c[2]=l=>r.value.nickName=l),placeholder:e(t)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(N,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userPhone"),path:"userPhone",class:"pr-24px"},{default:n(()=>[a(s,{value:r.value.userPhone,"onUpdate:value":c[3]||(c[3]=l=>r.value.userPhone=l),placeholder:e(t)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(N,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userEmail"),path:"userEmail",class:"pr-24px"},{default:n(()=>[a(s,{value:r.value.userEmail,"onUpdate:value":c[4]||(c[4]=l=>r.value.userEmail=l),placeholder:e(t)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(N,{span:"24 s:12 m:6",label:e(t)("page.manage.user.userStatus"),path:"userStatus",class:"pr-24px"},{default:n(()=>[a(P,{value:r.value.status,"onUpdate:value":c[5]||(c[5]=l=>r.value.status=l),placeholder:e(t)("page.manage.user.form.userStatus"),options:e(X)(e(oe)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(N,{span:"24 m:12",class:"pr-24px"},{default:n(()=>[a(w,{class:"w-full",justify:"end"},{default:n(()=>[a(G,{onClick:m},{icon:n(()=>[a(x,{class:"text-icon"})]),default:n(()=>[A(" "+I(e(t)("common.reset")),1)]),_:1}),a(G,{type:"primary",ghost:"",onClick:E},{icon:n(()=>[a(B,{class:"text-icon"})]),default:n(()=>[A(" "+I(e(t)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),He={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function O(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!Pe(o)}const oa=Y({name:"alova_user",__name:"index",setup(o){const k=Re(),g=Ce({status:null,userName:null,userGender:null,nickName:null,userPhone:null,userEmail:null}),{loading:S,data:f,refresh:C,reload:r,page:d,pageSize:v,pageCount:m,send:E,remove:D}=we((l,i)=>ze({...g,current:l,size:i}),{data:({records:l})=>l,total:({total:l})=>l,watchingStates:[g],debounce:[1e3]}),c=(l=1)=>{d.value=l,E(d.value,v.value)},{drawerVisible:s,operateType:N,editingData:P,handleAdd:x,handleEdit:G,handleDelete:B,handleBatchDelete:w,checkedRowKeys:h,deleting:R}=Le(f,{async delete(l){await Ve(l.id),D(l)},async batchDelete(l){await Ke(l.map(({id:i})=>i)),D(...l)}});function _(l){G(l)}const{columnChecks:u,columns:U}=je(()=>[{type:"selection",align:"center",width:48},{key:"userName",title:t("page.manage.user.userName"),align:"center",minWidth:100},{key:"userGender",title:t("page.manage.user.userGender"),align:"center",width:100,render:l=>{if(l.userGender===null)return null;const i={1:"primary",2:"error"},b=t(Ge[l.userGender]);return a(Z,{type:i[l.userGender]},O(b)?b:{default:()=>[b]})}},{key:"nickName",title:t("page.manage.user.nickName"),align:"center",minWidth:100},{key:"userPhone",title:t("page.manage.user.userPhone"),align:"center",width:120},{key:"userEmail",title:t("page.manage.user.userEmail"),align:"center",minWidth:200},{key:"status",title:t("page.manage.user.userStatus"),align:"center",width:100,render:l=>{if(l.status===null)return null;const i={1:"success",2:"warning"},b=t(Ee[l.status]);return a(Z,{type:i[l.status]},O(b)?b:{default:()=>[b]})}},{key:"operate",title:t("common.operate"),align:"center",width:130,render:l=>{let i;return a("div",{class:"flex-center gap-8px"},[a(V,{type:"primary",ghost:!0,size:"small",onClick:()=>_(l.id)},O(i=t("common.edit"))?i:{default:()=>[i]}),a(be,{onPositiveClick:()=>B(l.id),positiveButtonProps:{loading:R.value}},{default:()=>t("common.confirmDelete"),trigger:()=>{let b;return a(V,{type:"error",ghost:!0,size:"small"},O(b=t("common.delete"))?b:{default:()=>[b]})}})])}}]);return(l,i)=>{const b=ye,K=Oe,j=ne;return M(),H("div",He,[a(qe,{model:g,"onUpdate:model":i[0]||(i[0]=y=>g=y),onSearch:c},null,8,["model"]),a(j,{title:e(t)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[a(b,{columns:e(u),"onUpdate:columns":i[1]||(i[1]=y=>W(u)?u.value=y:null),"disabled-delete":e(h).length===0,loading:e(S),onAdd:e(x),onDelete:e(w),onRefresh:e(C)},null,8,["columns","disabled-delete","loading","onAdd","onDelete","onRefresh"])]),default:n(()=>[a(K,{"checked-row-keys":e(h),"onUpdate:checkedRowKeys":i[2]||(i[2]=y=>W(h)?h.value=y:null),columns:e(U),data:e(f),size:"small","flex-height":!e(k).isMobile,"scroll-x":962,loading:e(S),remote:"","row-key":y=>y.id,pagination:{page:e(d),pageSize:e(v),showSizePicker:!0,pageCount:e(m),pageSizes:[10,15,20,25,30],onUpdatePage(y){d.value=y},onUpdatePageSize(y){v.value=y}},class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(We,{visible:e(s),"onUpdate:visible":i[3]||(i[3]=y=>W(s)?s.value=y:null),"operate-type":e(N),"row-data":e(P),onSubmitted:e(r)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{oa as default};
