import{_ as se,a as re,b as ie,c as ue,d as ce,N as pe,e as me}from"./round-refresh-B7VpfLgK.js";import{u as de,a as _e,b as j,w as fe,_ as ve}from"./table-Gm6yRvUm.js";import{c as he,e as ge,f as ye,g as we,h as be}from"./info-CJS03HJN.js";import{d as G,M as W,N as Q,a as H,r as Y,O as Te,o as B,c as O,w as t,f as e,g as S,t as z,h as n,$ as d,s as Z,B as C,R as Ne,S as xe,P as K,J as ee,z as De,b as ke,U as L,W as Ee}from"./index-D6W6_zXP.js";import{u as te}from"./auth-DdtuPNda.js";import{u as Ce,_ as Be,b as ne}from"./form-a8uLA4Rd.js";import{_ as X}from"./Space-zKntJrGG.js";import{_ as Se}from"./DatePicker-CeSQ1aZs.js";import{_ as Ue}from"./Grid-Cxuy6_wU.js";import{N as Re,_ as Ae}from"./DataTable-BesTDHU0.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-BQ2WJ-Rm.js";const Pe=G({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:W({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:W(["submitted"],["update:visible"]),setup(v,{emit:w}){const _=v,b=w,l=Q(v,"visible"),{formRef:T,validate:x,restoreValidation:D}=Ce(),U=H(()=>({add:"新增部门",edit:"编辑部门"})[_.operateType]),a=Y(h());function h(){return{code:"",name:"",description:""}}H(()=>{var u;return((u=_.rowData)==null?void 0:u.id)||-1}),H(()=>_.operateType==="edit");function g(){a.value=h(),_.operateType==="edit"&&_.rowData&&Object.assign(a.value,_.rowData)}function y(){l.value=!1}async function R(){var u;await x(),delete a.value.index,await he(a.value),(u=window.$message)==null||u.success(d("common.updateSuccess")),y(),b("submitted")}return Te(l,()=>{l.value&&(g(),D())}),(u,c)=>{const N=Z,p=Be,A=ne,k=C,P=X,M=Ne,m=xe;return B(),O(m,{show:l.value,"onUpdate:show":c[3]||(c[3]=f=>l.value=f),"display-directive":"show",width:360},{default:t(()=>[e(M,{title:U.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[e(P,{size:16},{default:t(()=>[e(k,{onClick:y},{default:t(()=>[S(z(n(d)("common.cancel")),1)]),_:1}),e(k,{type:"primary",onClick:R},{default:t(()=>[S(z(n(d)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(A,{ref_key:"formRef",ref:T,model:a.value},{default:t(()=>[e(p,{label:"部门名称",path:"roleName"},{default:t(()=>[e(N,{value:a.value.name,"onUpdate:value":c[0]||(c[0]=f=>a.value.name=f),placeholder:"部门名称"},null,8,["value"])]),_:1}),e(p,{label:"部门代码",path:"roleCode"},{default:t(()=>[e(N,{value:a.value.code,"onUpdate:value":c[1]||(c[1]=f=>a.value.code=f),placeholder:"部门代码"},null,8,["value"])]),_:1}),e(p,{label:"部门描述",path:"roleDesc"},{default:t(()=>[e(N,{value:a.value.description,"onUpdate:value":c[2]||(c[2]=f=>a.value.description=f),placeholder:"部门描述",type:"textarea"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Me=G({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:W(["reset","search"],["update:model"]),setup(v,{emit:w}){const{hasAuth:_}=te(),b=w,l=Q(v,"model"),T=Y([118313526e4,Date.now()]);function x(){T.value=[118313526e4,Date.now()],b("reset")}function D(){b("search")}return(U,a)=>{const h=Z,g=se,y=Se,R=re,u=C,c=ie,N=X,p=Ue,A=ne,k=ue,P=ce,M=ee;return B(),O(M,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(P,{"default-expanded-names":["role-search"]},{default:t(()=>[e(k,{title:n(d)("common.search"),name:"role-search"},{default:t(()=>[e(A,{model:l.value,"label-placement":"left","label-width":80},{default:t(()=>[e(p,{responsive:"screen","item-responsive":""},{default:t(()=>[e(g,{span:"24 s:12 m:6",label:"部门名称",path:"roleName",class:"pr-24px"},{default:t(()=>[e(h,{value:l.value.name,"onUpdate:value":a[0]||(a[0]=m=>l.value.name=m),placeholder:"部门名称"},null,8,["value"])]),_:1}),e(g,{span:"24 s:12 m:6",label:"部门编码",path:"roleCode",class:"pr-24px"},{default:t(()=>[e(h,{value:l.value.code,"onUpdate:value":a[1]||(a[1]=m=>l.value.code=m),placeholder:"部门编码"},null,8,["value"])]),_:1}),e(g,{span:"24 s:12 m:6",label:"创建时间开始",path:"status",class:"pr-24px"},{default:t(()=>[e(y,{value:l.value.createTimeStart,"onUpdate:value":a[2]||(a[2]=m=>l.value.createTimeStart=m),type:"datetime",clearable:""},null,8,["value"])]),_:1}),e(g,{span:"24 s:12 m:6",label:"创建时间结束",path:"status",class:"pr-24px"},{default:t(()=>[e(y,{value:l.value.createTimeEnd,"onUpdate:value":a[3]||(a[3]=m=>l.value.createTimeEnd=m),type:"datetime",clearable:""},null,8,["value"])]),_:1}),e(g,{span:"24 s:12 m:6"},{default:t(()=>[e(N,{class:"w-full",justify:"end"},{default:t(()=>[e(u,{onClick:x},{icon:t(()=>[e(R,{class:"text-icon"})]),default:t(()=>[S(" "+z(n(d)("common.reset")),1)]),_:1}),n(_)("BUTTON_SEARCH_DEPARTMENT")?(B(),O(u,{key:0,type:"primary",ghost:"",onClick:D},{icon:t(()=>[e(c,{class:"text-icon"})]),default:t(()=>[S(" "+z(n(d)("common.search")),1)]),_:1})):K("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Oe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function J(v){return typeof v=="function"||Object.prototype.toString.call(v)==="[object Object]"&&!Ee(v)}const qe=G({name:"info_department",__name:"index",setup(v){const{hasAuth:w}=te(),_=De(),{columns:b,columnChecks:l,data:T,loading:x,getData:D,getDataByPage:U,mobilePagination:a,searchParams:h,resetSearchParams:g}=de({apiFn:ge,apiParams:{current:1,size:10,createTimeStart:null,createTimeEnd:null,code:null,name:null,description:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:d("common.index"),width:64,align:"center"},{key:"name",title:"部门名称",align:"center",minWidth:120},{key:"code",title:"部门编码",align:"center",minWidth:120},{key:"description",title:"部门描述",minWidth:120,render:s=>e(Re,{style:"max-width: 120px","line-clamp":2},{default:()=>[s.description]})},{key:"createTime",title:"创建时间",align:"center",minWidth:120},{key:"operate",title:d("common.operate"),align:"center",width:130,render:s=>{let o;return e("div",{class:"flex-center gap-8px"},[w("BUTTON_EDIT_DEPARTMENT")?e(C,{type:"primary",ghost:!0,size:"small",onClick:()=>m(s.id)},J(o=d("common.edit"))?o:{default:()=>[o]}):null,w("BUTTON_DELETE_DEPARTMENT")&&e(pe,{onPositiveClick:()=>M(s.id)},{default:()=>d("common.confirmDelete"),trigger:()=>{let i;return e(C,{type:"error",ghost:!0,size:"small"},J(i=d("common.delete"))?i:{default:()=>[i]})}})])}}]}),{drawerVisible:y,operateType:R,editingData:u,handleAdd:c,handleEdit:N,checkedRowKeys:p,onBatchDeleted:A,onDeleted:k}=_e(T,D);async function P(){console.log(p.value),await ye(p.value),A()}async function M(s){console.log(s),await we(s),k()}function m(s){N(s)}async function f(s,o){const i=b.value.slice(2);let E=[];s?E=(await be()).data.map(V=>i.map(le=>q(le,V))):E=T.value.map(r=>i.map(V=>q(V,r)));const F=i.map(r=>ae(r)&&r.title||null);E.unshift(F);const I=j.book_new(),$=j.aoa_to_sheet(E);$["!cols"]=i.map(r=>({width:Math.round(Number(r.width)/10||20)})),j.book_append_sheet(I,$,"部门列表"),fe(I,"部门数据.xlsx")}function q(s,o){if(!oe(s))return null;const{key:i}=s;return i==="operate"?null:o[i]}function oe(s){return!!s.key}function ae(s){return!!s.title}return(s,o)=>{const i=ve,E=me,F=X,I=Ae,$=ee;return B(),ke("div",Oe,[e(Me,{model:n(h),"onUpdate:model":o[0]||(o[0]=r=>L(h)?h.value=r:null),onReset:n(g),onSearch:n(U)},null,8,["model","onReset","onSearch"]),e($,{title:"部门列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[e(F,{align:"end",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[n(w)("BUTTON_EXCEL_DEPARTMENT")?(B(),O(n(C),{key:0,size:"small",ghost:"",type:"primary",onClick:o[1]||(o[1]=r=>f(!1))},{icon:t(()=>[e(i,{class:"text-icon"})]),default:t(()=>[o[6]||(o[6]=S(" 导出excel "))]),_:1})):K("",!0),n(w)("BUTTON_EXCEL_DEPARTMENT_ALL")?(B(),O(n(C),{key:1,size:"small",ghost:"",type:"primary",onClick:o[2]||(o[2]=r=>f(!0))},{icon:t(()=>[e(i,{class:"text-icon"})]),default:t(()=>[o[7]||(o[7]=S(" 导出全部 "))]),_:1})):K("",!0),e(E,{columns:n(l),"onUpdate:columns":o[3]||(o[3]=r=>L(l)?l.value=r:null),"disabled-delete":n(p).length===0,loading:n(x),"show-add-button-str":"BUTTON_ADD_DEPARTMENT","show-batch-delete-button-str":"BUTTON_BATCH_DELETE_DEPARTMENT",onAdd:n(c),onDelete:P,onRefresh:n(D)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),_:1})]),default:t(()=>[e(I,{"checked-row-keys":n(p),"onUpdate:checkedRowKeys":o[4]||(o[4]=r=>L(p)?p.value=r:null),columns:n(b),data:n(T),size:"small","flex-height":!n(_).isMobile,"scroll-x":702,loading:n(x),remote:"","row-key":r=>r.id,pagination:n(a),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Pe,{visible:n(y),"onUpdate:visible":o[5]||(o[5]=r=>L(y)?y.value=r:null),"operate-type":n(R),"row-data":n(u),onSubmitted:n(U)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{qe as default};
