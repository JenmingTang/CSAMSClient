import{_ as ie,a as ce,b as pe,c as de,d as me,N as _e,e as fe}from"./round-refresh-B7VpfLgK.js";import{u as ge,a as ve,b as q,w as be,_ as he}from"./table-Gm6yRvUm.js";import{j as ye,i as we,h as Ne,k as ke,s as Te,l as Ue,m as xe,a as Re}from"./sys-W0-bi7XJ.js";import{d as Q,M as X,N as ee,a as H,$ as l,r as $,O as Se,o as B,c as F,w as n,f as t,g as A,t as K,h as a,b as te,K as De,L as Be,Q as ae,B as I,R as Ee,S as Ce,P as J,s as Le,J as ne,z as Oe,U as G,V as $e,W as Ie}from"./index-D6W6_zXP.js";import{b as Ae,a as Me}from"./business-B55Z98WP.js";import{u as le}from"./auth-DdtuPNda.js";import{u as oe,a as se,_ as Pe,b as re}from"./form-a8uLA4Rd.js";import{a as ze,b as je,_ as Fe}from"./DataTable-BesTDHU0.js";import{_ as Y}from"./Space-zKntJrGG.js";import{_ as Ve}from"./DatePicker-CeSQ1aZs.js";import{_ as Ge}from"./Grid-Cxuy6_wU.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-BQ2WJ-Rm.js";const He=Q({name:"UserOperateDrawer",__name:"user-operate-drawer",props:X({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:X(["submitted"],["update:visible"]),setup(y,{emit:w}){const v=y,k=w,_=ee(y,"visible"),{formRef:T,validate:M,restoreValidation:u}=oe(),{defaultRequiredRule:U}=se(),P=H(()=>({add:l("page.manage.user.addUser"),edit:l("page.manage.user.editUser")})[v.operateType]),m=$(E());function E(){return{enabled:null}}const x={userName:U,status:U};$([]);function R(){m.value=E(),v.operateType==="edit"&&v.rowData&&Object.assign(m.value,v.rowData)}function c(){_.value=!1}const C=H(()=>{var d;return((d=v.rowData)==null?void 0:d.id)||-1});H(()=>v.operateType==="edit");const p=$([]);async function b(){var d;await ye(C.value,p.value),await we(m.value),(d=window.$message)==null||d.success(l("common.updateSuccess")),c(),k("submitted")}const L=[{label:"启用",value:1},{label:"禁用",value:0}],S=$([]),O=async()=>{S.value=[],p.value=[];const{data:d,code:f,msg:D}=await Ne(),N=await ke(C.value);d.forEach(g=>{S.value.push({label:g.description,value:g.id})}),N.data.forEach(g=>{p.value.push(g)})};return Se(_,()=>{_.value&&(R(),u(),O())}),(d,f)=>{const D=je,N=ze,g=Pe,z=ae,o=re,e=I,s=Y,h=Ee,j=Ce;return B(),F(j,{show:_.value,"onUpdate:show":f[2]||(f[2]=i=>_.value=i),"display-directive":"show",width:360},{default:n(()=>[t(h,{title:P.value,"native-scrollbar":!1,closable:""},{footer:n(()=>[t(s,{size:16},{default:n(()=>[t(e,{onClick:c},{default:n(()=>[A(K(a(l)("common.cancel")),1)]),_:1}),t(e,{type:"primary",onClick:b},{default:n(()=>[A(K(a(l)("common.confirm")),1)]),_:1})]),_:1})]),default:n(()=>[t(o,{ref_key:"formRef",ref:T,model:m.value,rules:x},{default:n(()=>[t(g,{label:a(l)("page.manage.user.userStatus"),path:"status"},{default:n(()=>[t(N,{value:m.value.enabled,"onUpdate:value":f[0]||(f[0]=i=>m.value.enabled=i)},{default:n(()=>[(B(),te(Be,null,De(L,i=>t(D,{key:i.value,value:i.value,label:a(l)(i.label)},null,8,["value","label"])),64))]),_:1},8,["value"])]),_:1},8,["label"]),t(g,{label:a(l)("page.manage.user.userRole"),path:"roles"},{default:n(()=>[t(z,{value:p.value,"onUpdate:value":f[1]||(f[1]=i=>p.value=i),multiple:"",options:S.value,placeholder:a(l)("page.manage.user.form.userRole")},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Ke=Q({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:X(["reset","search"],["update:model"]),setup(y,{emit:w}){const{hasAuth:v}=le(),k=w,{formRef:_,validate:T,restoreValidation:M}=oe(),u=ee(y,"model"),U=H(()=>{const{patternRules:R}=se();return{userEmail:R.email,userPhone:R.phone}}),P=$([118313526e4,Date.now()]);async function m(){P.value=[118313526e4,Date.now()],await M(),k("reset")}async function E(){await T(),k("search")}const x=[{label:"启用",value:1},{label:"禁用",value:0},{label:"未选中",value:2,disabled:!0}];return(R,c)=>{const C=Le,p=ie,b=ae,L=Ve,S=ce,O=I,d=pe,f=Y,D=Ge,N=re,g=de,z=me,o=ne;return B(),F(o,{bordered:!1,size:"small",class:"card-wrapper"},{default:n(()=>[t(z,null,{default:n(()=>[t(g,{title:a(l)("common.search"),name:"user-search"},{default:n(()=>[t(N,{ref_key:"formRef",ref:_,model:u.value,rules:U.value,"label-placement":"left","label-width":80},{default:n(()=>[t(D,{responsive:"screen","item-responsive":""},{default:n(()=>[t(p,{span:"24 s:12 m:6",label:a(l)("page.manage.user.userName"),path:"username",class:"pr-24px"},{default:n(()=>[t(C,{value:u.value.username,"onUpdate:value":c[0]||(c[0]=e=>u.value.username=e),placeholder:a(l)("page.manage.user.form.userName")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(p,{span:"24 s:12 m:6",label:a(l)("page.manage.user.userStatus"),path:"enabled",class:"pr-24px"},{default:n(()=>[t(b,{value:u.value.enabled,"onUpdate:value":c[1]||(c[1]=e=>u.value.enabled=e),placeholder:a(l)("page.manage.user.form.userStatus"),options:x,clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(p,{span:"24 s:12 m:6",label:"创建时间开始",path:"status",class:"pr-24px"},{default:n(()=>[t(L,{value:u.value.createTimeStart,"onUpdate:value":c[2]||(c[2]=e=>u.value.createTimeStart=e),type:"datetime",clearable:""},null,8,["value"])]),_:1}),t(p,{span:"24 s:12 m:6",label:"创建时间结束",path:"status",class:"pr-24px"},{default:n(()=>[t(L,{value:u.value.createTimeEnd,"onUpdate:value":c[3]||(c[3]=e=>u.value.createTimeEnd=e),type:"datetime",clearable:""},null,8,["value"])]),_:1}),t(p,{span:"24 m:12",class:"pr-24px"},{default:n(()=>[t(f,{class:"w-full",justify:"end"},{default:n(()=>[t(O,{onClick:m},{icon:n(()=>[t(S,{class:"text-icon"})]),default:n(()=>[A(" "+K(a(l)("common.reset")),1)]),_:1}),a(v)("BUTTON_SEARCH_USER")?(B(),F(O,{key:0,type:"primary",ghost:"",onClick:E},{icon:n(()=>[t(d,{class:"text-icon"})]),default:n(()=>[A(" "+K(a(l)("common.search")),1)]),_:1})):J("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),We={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function Z(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!Ie(y)}const rt=Q({name:"manage_user",__name:"index",setup(y){const{hasAuth:w}=le(),v=Oe();$(!1);const{columns:k,columnChecks:_,data:T,getData:M,getDataByPage:u,loading:U,mobilePagination:P,searchParams:m,resetSearchParams:E}=ge({apiFn:Te,showTotal:!0,apiParams:{current:1,size:10,username:null,realName:null,college:null,major:null,userClass:null,phone:null,email:null,avatarUrl:null,enabled:null,createTime:null,updateTime:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:l("common.index"),align:"center",width:64},{key:"id",title:"ID",align:"center",width:64},{key:"username",title:l("page.manage.user.userName"),align:"center",minWidth:100},{key:"enabled",title:l("page.manage.user.userStatus"),align:"center",width:100,render:o=>o.enabled===null?null:t($e,{type:{1:"success",0:"warning"}[o.enabled]},{default:()=>[o.enabled===1?"启用":"禁用"]})},{key:"createTime",title:"创建时间",align:"center",minWidth:120},{key:"operate",title:l("common.operate"),align:"center",width:130,render:o=>{let e;return t("div",{class:"flex-center gap-8px"},[w("BUTTON_EDIT_USER")?t(I,{type:"primary",ghost:!0,size:"small",onClick:()=>f(o.id)},Z(e=l("common.edit"))?e:{default:()=>[e]}):null,w("BUTTON_DELETE_USER")&&t(_e,{onPositiveClick:()=>d(o.id)},{default:()=>l("common.confirmDelete"),trigger:()=>{let s;return t(I,{type:"error",ghost:!0,size:"small"},Z(s=l("common.delete"))?s:{default:()=>[s]})}})])}}]}),{drawerVisible:x,operateType:R,editingData:c,handleAdd:C,handleEdit:p,checkedRowKeys:b,onBatchDeleted:L,onDeleted:S}=ve(T,M);async function O(){console.log(b.value),await Ue(b.value),L()}async function d(o){console.log(o),await xe(o),S()}function f(o){p(o)}async function D(o,e){const s=k.value.slice(2);let h=[];o?h=(await Re()).data.map(W=>s.map(ue=>N(ue,W))):h=T.value.map(r=>s.map(W=>N(W,r)));const j=s.map(r=>z(r)&&r.title||null);h.unshift(j);const i=q.book_new(),V=q.aoa_to_sheet(h);V["!cols"]=s.map(r=>({width:Math.round(Number(r.width)/10||20)})),q.book_append_sheet(i,V,"用户列表"),be(i,"用户数据.xlsx")}function N(o,e){if(!g(o))return null;const{key:s}=o;return s==="operate"?null:s==="enabled"?e.enabled===1?"启用":"禁用":s==="userRoles"?e.userRoles.map(h=>h).join(","):s==="status"?e.status&&l(Ae[e.status])||null:s==="userGender"?e.userGender&&l(Me[e.userGender])||null:e[s]}function g(o){return!!o.key}function z(o){return!!o.title}return(o,e)=>{const s=he,h=fe,j=Y,i=Fe,V=ne;return B(),te("div",We,[t(Ke,{model:a(m),"onUpdate:model":e[0]||(e[0]=r=>G(m)?m.value=r:null),onReset:a(E),onSearch:a(u)},null,8,["model","onReset","onSearch"]),t(V,{title:a(l)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":n(()=>[t(j,{align:"end",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:n(()=>[a(w)("BUTTON_EXCEL_USER")?(B(),F(a(I),{key:0,size:"small",ghost:"",type:"primary",onClick:e[1]||(e[1]=r=>D(!1))},{icon:n(()=>[t(s,{class:"text-icon"})]),default:n(()=>[e[6]||(e[6]=A(" 导出excel "))]),_:1})):J("",!0),a(w)("BUTTON_EXCEL_USER_ALL")?(B(),F(a(I),{key:1,size:"small",ghost:"",type:"primary",onClick:e[2]||(e[2]=r=>D(!0))},{icon:n(()=>[t(s,{class:"text-icon"})]),default:n(()=>[e[7]||(e[7]=A(" 导出全部 "))]),_:1})):J("",!0),t(h,{columns:a(_),"onUpdate:columns":e[3]||(e[3]=r=>G(_)?_.value=r:null),"disabled-delete":a(b).length===0,loading:a(U),"show-add-button-str":"BUTTON_ADD_USER","show-batch-delete-button-str":"BUTTON_BATCH_DELETE_USER",onAdd:a(C),onDelete:O,onRefresh:a(M)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),_:1})]),default:n(()=>[t(i,{"checked-row-keys":a(b),"onUpdate:checkedRowKeys":e[4]||(e[4]=r=>G(b)?b.value=r:null),columns:a(k),data:a(T),size:"small","flex-height":!a(v).isMobile,"scroll-x":962,loading:a(U),remote:"","row-key":r=>r.id,pagination:a(P),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(He,{visible:a(x),"onUpdate:visible":e[5]||(e[5]=r=>G(x)?x.value=r:null),"operate-type":a(R),"row-data":a(c),onSubmitted:a(u)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{rt as default};
