import{_ as Vt}from"./web-site-link.vue_vue_type_script_setup_true_lang-C0lz5MG1.js";import{G as M,c as $,a as Ve,S as xt,T as de,b as Kt,I as Ze,C as Bt,L as Ut,i as $t,B as qt,d as Zt,e as Qt,P as Jt,f as ei,v as Re,g as ti,h as ii,D as Xe,j as wt,k as ni}from"./index-Jz1qfeca.js";import{i as N}from"./linear-scale-1S1endck.js";import{d as si,A as ai,bD as Pe,O as ri,i as li,ay as oi,o as di,c as hi,w as Ge,f as je,e as kt,J as ci}from"./index-D6W6_zXP.js";import{_ as ui}from"./Space-zKntJrGG.js";import"./get-CQkwdf_k.js";import"./isSymbol-BLe3SAcv.js";import"./index-BSN0U_uv.js";import"./get-slot-Bk_rJcZu.js";var I;(function(n){n.default="default",n.grabing="grabing",n.scrolling="scrolling"})(I||(I={}));var Y;(function(n){n.FinishToStart="finish_to_start",n.StartToStart="start_to_start",n.FinishToFinish="finish_to_finish",n.StartToFinish="start_to_finish"})(Y||(Y={}));var L;(function(n){n.Tasks_Separate="tasks_separate",n.Sub_Tasks_Inline="sub_tasks_inline",n.Sub_Tasks_Separate="sub_tasks_separate",n.Sub_Tasks_Arrange="sub_tasks_arrange",n.Sub_Tasks_Compact="sub_tasks_compact"})(L||(L={}));const z={SCROLL:"scroll",CHANGE_DATE_RANGE:"change_date_range",CLICK_TASK_BAR:"click_task_bar",CONTEXTMENU_TASK_BAR:"contextmenu_task_bar",MOUSEENTER_TASK_BAR:"mouseenter_task_bar",MOUSELEAVE_TASK_BAR:"mouseleave_task_bar",CREATE_TASK_SCHEDULE:"create_task_schedule",CREATE_DEPENDENCY_LINK:"create_dependency_link",DELETE_DEPENDENCY_LINK:"delete_dependency_link",CLICK_DEPENDENCY_LINK_POINT:"click_dependency_link_point",CONTEXTMENU_DEPENDENCY_LINK:"contextmenu_dependency_link"};class pi{constructor(e){var t;this._scene=e,this.scrollLeft=0,this.scrollTop=0,this.x=0,this.y=e._gantt.getAllHeaderRowsHeight(),this.width=e.ganttGroup.attribute.width,this.height=e.ganttGroup.attribute.height-e.timelineHeader.group.attribute.height,this.rowHeight=e._gantt.parsedOptions.rowHeight,this.rowCount=e._gantt.itemCount,this.allGridWidth=e._gantt.getAllDateColsWidth(),this.allGridHeight=e._gantt.getAllTaskBarsHeight(),this.group=new M({x:this.x,y:this.y,width:this.width,height:this.height,clip:!0,fill:(t=e._gantt.parsedOptions.grid)===null||t===void 0?void 0:t.backgroundColor}),this.group.name="grid-container",e.ganttGroup.addChild(this.group),this.createVerticalBackgroundRects(),this.createHorizontalBackgroundRects(),this.createVerticalLines(),this.createHorizontalLines(),this.createTimeLineHeaderBottomLine()}createTimeLineHeaderBottomLine(){var e,t,i,s,a,r;const l=this._scene._gantt.parsedOptions,o=(t=(e=l.horizontalSplitLine)===null||e===void 0?void 0:e.lineWidth)!==null&&t!==void 0?t:(i=l.timelineHeaderHorizontalLineStyle)===null||i===void 0?void 0:i.lineWidth,h=(1&o?-.5:0)+o/2,d=$({pickable:!1,stroke:(a=(s=l.horizontalSplitLine)===null||s===void 0?void 0:s.lineColor)!==null&&a!==void 0?a:(r=l.timelineHeaderHorizontalLineStyle)===null||r===void 0?void 0:r.lineColor,lineWidth:o+(1&o?1:0),points:[{x:0,y:h},{x:this._scene._gantt.getAllDateColsWidth(),y:h}]});d.name="timeLine-header-bottom-line",this.group.addChild(d)}createVerticalLines(){const e=this._scene._gantt.parsedOptions.grid;if(e.verticalLine){this.verticalLineGroup=new M({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.verticalLineGroup.name="grid-vertical",this.group.appendChild(this.verticalLineGroup);const t=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0].timelineDates,i=this._scene._gantt.parsedOptions.timelineColWidth;if(typeof e.verticalLine=="function")for(let s=0;s<(t==null?void 0:t.length)-1;s++){const a=e.verticalLine({index:s,dateIndex:t[s].dateIndex,date:t[s].endDate,ganttInstance:this._scene._gantt}),r=Math.ceil(i*(s+1))+(1&a.lineWidth?.5:0),l=$({pickable:!1,stroke:a.lineColor,lineWidth:a.lineWidth,points:[{x:r,y:0},{x:r,y:this.allGridHeight}]});this.verticalLineGroup.appendChild(l)}else{const s=e.verticalLine;for(let a=0;a<(t==null?void 0:t.length)-1;a++){const r=Math.ceil(i*(a+1))+(1&s.lineWidth?.5:0),l=$({pickable:!1,stroke:s.lineColor,lineWidth:s.lineWidth,points:[{x:r,y:0},{x:r,y:this.allGridHeight}]});this.verticalLineGroup.appendChild(l)}}}}createHorizontalLines(){const e=this._scene._gantt.parsedOptions.grid;if(e.horizontalLine)if(this.horizontalLineGroup=new M({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.horizontalLineGroup.name="grid-horizontal",this.group.appendChild(this.horizontalLineGroup),typeof e.horizontalLine=="function"){let t=.5;for(let i=0;i<this.rowCount-1;i++){const s=e.horizontalLine({index:i,ganttInstance:this._scene._gantt});t+=this._scene._gantt.getRowHeightByIndex(i);const a=$({pickable:!1,stroke:s.lineColor,lineWidth:s.lineWidth,points:[{x:0,y:t},{x:this.allGridWidth,y:t}]});this.horizontalLineGroup.appendChild(a)}}else{const t=e.horizontalLine;let i=0;1&t.lineWidth&&(i+=.5);for(let s=0;s<this.rowCount-1;s++){i+=this._scene._gantt.getRowHeightByIndex(s);const a=$({pickable:!1,stroke:t.lineColor,lineWidth:t.lineWidth,points:[{x:0,y:i},{x:this.allGridWidth,y:i}]});this.horizontalLineGroup.appendChild(a)}}}createVerticalBackgroundRects(){const e=this._scene._gantt.parsedOptions.grid.verticalBackgroundColor,t=this._scene._gantt.parsedOptions.grid.weekendBackgroundColor;if(e||t){this.verticalBackgroundRectsGroup=new M({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.verticalBackgroundRectsGroup.name="grid-vertical-background",this.group.appendChild(this.verticalBackgroundRectsGroup);const{timelineDates:i,unit:s,step:a}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],r=this._scene._gantt.parsedOptions.timelineColWidth;if(e||t)for(let l=0;l<=(i==null?void 0:i.length)-1;l++){let o;if(!t||s!=="day"||a!==1||i[l].startDate.getDay()!==0&&i[l].startDate.getDay()!==6?typeof e=="function"?o=e({index:l,dateIndex:i[l].dateIndex,date:i[l].endDate,ganttInstance:this._scene._gantt}):e&&(o=e[l%e.length]):o=t,o){const h=Math.ceil(r*l),d=Ve({pickable:!1,fill:o,x:h,y:0,width:r,height:this.allGridHeight});this.verticalBackgroundRectsGroup.appendChild(d)}}}}createHorizontalBackgroundRects(){const e=this._scene._gantt.parsedOptions.grid.horizontalBackgroundColor;if(e){this.horizontalBackgroundRectsGroup=new M({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.horizontalBackgroundRectsGroup.name="grid-horizontal-background",this.group.appendChild(this.horizontalBackgroundRectsGroup);let t=0;for(let i=0;i<=this.rowCount-1;i++){let s;s=typeof e=="function"?e({index:i,ganttInstance:this._scene._gantt}):e[i%e.length];const a=Ve({pickable:!1,fill:s,x:0,y:t,width:this.allGridWidth,height:this._scene._gantt.getRowHeightByIndex(i)});this.horizontalBackgroundRectsGroup.appendChild(a),t+=this._scene._gantt.getRowHeightByIndex(i)}}}refresh(){this.width=this._scene.ganttGroup.attribute.width,this.height=this._scene.ganttGroup.attribute.height-this._scene.timelineHeader.group.attribute.height,this.group.setAttributes({width:this.width,height:this.height,y:this._scene._gantt.getAllHeaderRowsHeight()}),this.rowCount=this._scene._gantt.itemCount,this.allGridWidth=this._scene._gantt.getAllDateColsWidth(),this.allGridHeight=this._scene._gantt.getAllTaskBarsHeight(),this.group.removeAllChild(),this.createVerticalBackgroundRects(),this.createHorizontalBackgroundRects(),this.createVerticalLines(),this.createHorizontalLines(),this.createTimeLineHeaderBottomLine()}setX(e){var t,i,s,a;(t=this.verticalLineGroup)===null||t===void 0||t.setAttribute("x",e),(i=this.horizontalLineGroup)===null||i===void 0||i.setAttribute("x",e),(s=this.verticalBackgroundRectsGroup)===null||s===void 0||s.setAttribute("x",e),(a=this.horizontalBackgroundRectsGroup)===null||a===void 0||a.setAttribute("x",e)}setY(e){var t,i,s,a;(t=this.verticalLineGroup)===null||t===void 0||t.setAttribute("y",e),(i=this.horizontalLineGroup)===null||i===void 0||i.setAttribute("y",e),(s=this.verticalBackgroundRectsGroup)===null||s===void 0||s.setAttribute("y",e),(a=this.horizontalBackgroundRectsGroup)===null||a===void 0||a.setAttribute("y",e)}resize(){this.width=this._scene.ganttGroup.attribute.width,this.height=this._scene.ganttGroup.attribute.height-this._scene.timelineHeader.group.attribute.height,this.group.setAttribute("width",this.width),this.group.setAttribute("height",this.height)}}class F{static get mode(){return F._mode||(F._mode=gi()),F._mode}static set mode(e){F._mode=e}static RegisterCreateCanvas(e){F.CreateCanvas=e}static RegisterLoadImage(e){F.LoadImage=e}static GetCreateCanvasFunc(){return F.CreateCanvas?F.CreateCanvas:F.mode==="worker"?(e=200,t=200)=>new OffscreenCanvas(e,t):void 0}static RegisterRequestAnimationFrame(e){F.RequestAnimationFrame=e()}static GetRequestAnimationFrame(){if(F.RequestAnimationFrame)return F.RequestAnimationFrame}static RegisterCancelAnimationFrame(e){F.CancelAnimationFrame=e()}static GetCancelAnimationFrame(){if(F.CancelAnimationFrame)return F.CancelAnimationFrame}}function gi(){let n="browser";try{window.type==="node"?n="node":typeof window>"u"||window.performance?typeof window>"u"&&(n="node"):n="miniApp"}catch{n="node"}return n}F.dpr=0;class fi{constructor(e){this._gantt=e,this.createScrollBar(e.tableNoFrameWidth,e.tableNoFrameHeight-e.getAllHeaderRowsHeight())}createScrollBar(e,t){var i,s;const a=this._gantt.parsedOptions.scrollStyle.scrollRailColor,r=this._gantt.parsedOptions.scrollStyle.scrollSliderColor,l=this._gantt.parsedOptions.scrollStyle.scrollSliderCornerRadius,o=this._gantt.parsedOptions.scrollStyle.width;let h;h=N(l)?{cornerRadius:l,fill:r}:{fill:r},(i=this._gantt.parsedOptions.scrollStyle)===null||i===void 0||i.visible,(s=this._gantt.parsedOptions.scrollStyle)===null||s===void 0||s.hoverOn,this.hScrollBar=new xt({direction:"horizontal",x:2*-e,y:2*-t,width:e,height:o,padding:0,railStyle:{fill:a},sliderStyle:h,range:[0,.1],visible:!1}),this.hScrollBar.render(),this.hScrollBar.hideAll(),this.vScrollBar=new xt({direction:"vertical",x:2*-e,y:2*-t,width:o,height:t,padding:0,railStyle:{fill:a},sliderStyle:h,range:[0,.1],visible:!1}),this.vScrollBar.render(),this.vScrollBar.hideAll()}refresh(){}hideVerticalScrollBar(){const e=this._gantt.parsedOptions.scrollStyle.visible;e!=="focus"&&e!=="scrolling"||(this.vScrollBar.setAttribute("visible",!1),this.vScrollBar.hideAll(),this._gantt.scenegraph.updateNextFrame())}showVerticalScrollBar(e){const t=this._gantt.parsedOptions.scrollStyle.visible;t!=="focus"&&t!=="scrolling"||(this.vScrollBar.setAttribute("visible",!0),this.vScrollBar.showAll(),this._gantt.scenegraph.updateNextFrame(),e&&(clearTimeout(this._clearVerticalScrollBar),this._clearVerticalScrollBar=setTimeout(()=>{this.hideVerticalScrollBar()},1e3)))}hideHorizontalScrollBar(){const e=this._gantt.parsedOptions.scrollStyle.visible;e!=="focus"&&e!=="scrolling"||(this.hScrollBar.setAttribute("visible",!1),this.hScrollBar.hideAll(),this._gantt.scenegraph.updateNextFrame())}showHorizontalScrollBar(e){const t=this._gantt.parsedOptions.scrollStyle.visible;t!=="focus"&&t!=="scrolling"||(this.hScrollBar.setAttribute("visible",!0),this.hScrollBar.showAll(),this._gantt.scenegraph.updateNextFrame(),e&&(clearTimeout(this._clearHorizontalScrollBar),this._clearHorizontalScrollBar=setTimeout(()=>{this.hideHorizontalScrollBar()},1e3)))}updateVerticalScrollBarPos(e){const t=this.vScrollBar.attribute.range,i=t[1]-t[0],s=e*(1-i);this.vScrollBar.setAttribute("range",[s,s+i]);const a=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:a.x1,y:a.y1}}updateHorizontalScrollBarPos(e){const t=this.hScrollBar.attribute.range,i=t[1]-t[0],s=e*(1-i);this.hScrollBar.setAttribute("range",[s,s+i]);const a=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:a.x1,y:a.y1}}updateScrollBar(){const e=this._gantt.stateManager.scroll.horizontalBarPos,t=this._gantt.stateManager.scroll.verticalBarPos,i=this._gantt.parsedOptions.scrollStyle,s=i==null?void 0:i.width,a=i==null?void 0:i.visible,r=Math.ceil(this._gantt.scenegraph.ganttGroup.attribute.width),l=Math.ceil(this._gantt.scenegraph.ganttGroup.attribute.height),o=this._gantt.getAllRowsHeight(),h=this._gantt.getAllDateColsWidth(),d=this._gantt.getAllHeaderRowsHeight();if(h>r){const c=Math.min(l,o),p=Math.max(.05,r/h),u=i.hoverOn;let g=0;g=i.barToSide?this._gantt.tableNoFrameHeight-(u?s:-this._gantt.scenegraph.ganttGroup.attribute.y)+this._gantt.tableY:c-(u?s:-this._gantt.scenegraph.ganttGroup.attribute.y)+this._gantt.tableY,this.hScrollBar.setAttributes({x:this._gantt.scenegraph.ganttGroup.attribute.x,y:g,width:r,range:[0,p],visible:a==="always"});const f=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:f.x1,y:f.y1},a==="always"&&this.hScrollBar.showAll()}else this.hScrollBar.setAttributes({x:2*-this._gantt.tableNoFrameWidth,y:2*-this._gantt.tableNoFrameHeight,width:0,visible:!1});if(o>l){const c=Math.min(r,h)+this._gantt.scenegraph.ganttGroup.attribute.x,p=Math.max(.05,(l-d)/(o-d));let u=0;const g=this._gantt.parsedOptions.scrollStyle.hoverOn;u=this._gantt.parsedOptions.scrollStyle.barToSide?this._gantt.tableNoFrameWidth-(g?s:-this._gantt.scenegraph.ganttGroup.attribute.x):c-(g?s:-this._gantt.scenegraph.ganttGroup.attribute.x),this.vScrollBar.setAttributes({x:u,y:d+(g?0:this._gantt.scenegraph.ganttGroup.attribute.y)+this._gantt.tableY,height:l-d,range:[0,p],visible:a==="always"});const f=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:f.x1,y:f.y1},a==="always"&&this.vScrollBar.showAll()}else this.vScrollBar.setAttributes({x:2*-this._gantt.tableNoFrameWidth,y:2*-this._gantt.tableNoFrameHeight,height:0,visible:!1});this._gantt.stateManager.setScrollLeft(e),this._gantt.stateManager.setScrollTop(t)}}function Ot(n,e){let t=null;return function(...i){t||(n.apply(this,i),t=setTimeout(()=>{t=null},e))}}function ie(n,e){const t=n.getFullYear().toString(),i=(n.getMonth()+1).toString().padStart(2,"0"),s=n.getDate().toString().padStart(2,"0");if((e=(e=(e=e.replace("yyyy",t)).replace("mm",i)).replace("dd",s)).length>10){const a=n.getHours().toString().padStart(2,"0"),r=n.getMinutes().toString().padStart(2,"0"),l=n.getSeconds().toString().padStart(2,"0");e=(e=(e=e.replace("hh",a)).replace("mm",r)).replace("ss",l)}return e}function _i(n,e){const t=e.indexOf("yyyy"),i=e.indexOf("mm"),s=e.indexOf("dd"),a=i<t?i<s?0:1:i<s?1:2,r=s<t?s<i?0:1:s<i?1:2,l=parseInt(n[t<i?t<s?0:1:i<s?1:2],10),o=parseInt(n[a],10)-1,h=parseInt(n[r],10);if(isNaN(l)||l<1||isNaN(o)||o<0||o>11)return!1;const d=[31,mi(l)?29:28,31,30,31,30,31,31,30,31,30,31];return!(isNaN(h)||h<1||h>d[o])}function bi(n,e){if(e.includes("hh")||e.includes("mm")||e.includes("ss")){const t=e.indexOf("hh")>-1?e.indexOf("hh"):e.indexOf("HH"),i=parseInt(n[t],10),s=parseInt(n[t+1],10),a=n.length>t+2?parseInt(n[t+2],10):0;if(isNaN(i)||i<0||i>23||isNaN(s)||s<0||s>59||isNaN(a)||a<0||a>59)return!1}return!0}function mi(n){return n%4==0&&n%100!=0||n%400==0}function Ue(n){const e=["yyyy-mm-dd","dd-mm-yyyy","mm/dd/yyyy","yyyy/mm/dd","dd/mm/yyyy","yyyy.mm.dd","mm.dd.yyyy","dd.mm.yyyy"],t=["hh:mm:ss","hh:mm"],i=(n=n.trim()).split(" "),s=i[0],a=i[1];let r,l;if(s)for(let o=0;o<e.length;o++){const h=e[o],d=s.split(St(h)),c=_i(d,h);if(d.length===3&&c){r=h;break}}if(r&&a)for(let o=0;o<t.length;o++){const h=t[o],d=a.split(St(h)),c=h.split(St(h));if(bi(d,h)&&d.length===c.length){l=h;break}}return s&&a&&r&&l?r+" "+l:s&&!a?r:"yyyy-mm-dd hh:mm:ss"}function St(n){const e=n.match(/[^\w]/g);if(e){const t=e.map(i=>"\\"+i).join("|");return new RegExp(t,"g")}return/[^\w]/}function yi(n,e){return n.replace(/\{([^}]+)\}/g,(t,i)=>{const s=i.split(".");let a=e;for(const r of s){if(!a.hasOwnProperty(r)){a=t;break}a=a[r]}return a})}function Je(n){return Array.isArray(n)?n.length===3?[n[0],n[1],n[2],n[1]]:n.length===2?[n[0],n[1],n[0],n[1]]:n.length===1?[n[0],n[0],n[0],n[0]]:[n[0],n[1],n[2],n[3]]:[n,n,n,n]}function ki(n){const e=new Date(n.getFullYear(),0,1);return Math.ceil(((n.getTime()+1-e.getTime())/864e5+1)/7)}function Si(n,e="long"){const t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=new Date(n);return e==="short"?t[i.getDay()].substr(0,3):e==="long"?t[i.getDay()]:'Invalid format specified. Please use "short" or "long".'}function Li(n,e){const t=Object.getOwnPropertyDescriptor(n,e);return!!t&&(!!t.set||t.writable===!0)}function j(n,e=!1){let t;if(n){if(t=new Date(n),typeof n=="string"){if(n.length>10)return e&&t.setHours(0,0,0,0),t;t.setHours(0,0,0,0)}}else t=new Date;return e&&t.setHours(0,0,0,0),t}function vi(n,e=!1){let t;if(n){if(t=new Date(n),typeof n=="string"){if(n.length>10)return e&&t.setMinutes(59,59,999),t;t.setMinutes(59,59,999)}}else t=new Date;return e&&t.setMinutes(59,59,999),t}function Ti(n,e=!1){let t;if(n){if(t=new Date(n),typeof n=="string"){if(n.length>10)return e&&t.setSeconds(59,999),t;t.setSeconds(59,999)}}else t=new Date;return e&&t.setSeconds(59,999),t}function Mt(n,e=!1){let t;if(n){if(t=new Date(n),typeof n=="string"){if(n.length>10)return e&&t.setMilliseconds(999),t;t.setMilliseconds(999)}}else t=new Date;return e&&t.setMilliseconds(999),t}function he(n,e=!1){let t;if(n){if(t=new Date(n),typeof n=="string"){if(n.length>10)return e&&t.setHours(23,59,59,999),t;t.setHours(23,59,59,999)}}else t=new Date;return e&&t.setHours(23,59,59,999),t}function Ke(n,e,t,i){let s=new Date(e);switch(t){case"second":s.setMilliseconds(999);break;case"minute":s.setSeconds(59,999);break;case"hour":s.setMinutes(59,59,999);break;case"day":s.setHours(23,59,59,999);break;case"week":const l=6-s.getDay();s.setDate(s.getDate()+l),s.setHours(23,59,59,999);break;case"month":const o=new Date(s.getFullYear(),s.getMonth()+1,0).getDate();s.setDate(o),s.setHours(23,59,59,999);break;case"quarter":const h=s.getMonth(),d=h-h%3+2,c=new Date(s.getFullYear(),d+1,0).getDate();s.setMonth(d,c),s.setHours(23,59,59,999);break;case"year":s.setMonth(11,31),s.setHours(23,59,59,999);break;default:throw new Error("Invalid time scale")}const a=R(s,n,t,i,1),r=Math.ceil(a);if(r>a){const l=(r-a)*i,o=1e3,h=60*o,d=60*h,c=24*d,p=7*c;switch(new Date(s.getTime()+1),t){case"second":s.setTime(s.getTime()+l*o);break;case"minute":s.setTime(s.getTime()+l*h);break;case"hour":s.setTime(s.getTime()+l*d);break;case"day":s.setTime(s.getTime()+l*c);break;case"week":s.setTime(s.getTime()+l*p);break;case"month":s=new Date(s.getFullYear(),s.getMonth()+1+Math.round(l),0),s.setHours(23,59,59,999);break;case"quarter":const u=s.getMonth(),g=u-u%3+2;s=new Date(s.getFullYear(),g+Math.round(3*l)+1,0),s.setHours(23,59,59,999);break;case"year":s.setFullYear(s.getFullYear()+Math.floor(l)),s.setHours(23,59,59,999);break;default:throw new Error("Invalid time scale")}}return s}function ze(n,e,t="monday"){const i=new Date(n);switch(e){case"second":i.setMilliseconds(0);break;case"minute":i.setSeconds(0,0);break;case"hour":i.setMinutes(0,0,0);break;case"day":i.setHours(0,0,0,0);break;case"week":const s=i.getDay();let a=s;a=t==="monday"?s===0?-6:1-s:-s,i.setDate(i.getDate()+a),i.setHours(0,0,0,0);break;case"month":i.setDate(1),i.setHours(0,0,0,0);break;case"quarter":const r=i.getMonth(),l=r-r%3;i.setMonth(l,1),i.setHours(0,0,0,0);break;case"year":i.setMonth(0,1),i.setHours(0,0,0,0);break;default:throw new Error("Invalid time scale")}return i}function R(n,e,t,i,s=0){let a;const r=new Date(n.getTime()+s);switch(t){case"second":a=(r.getTime()-e.getTime())/1e3;break;case"minute":a=(r.getTime()-e.getTime())/6e4;break;case"hour":a=(r.getTime()-e.getTime())/36e5;break;case"day":a=(r.getTime()-e.getTime())/864e5;break;case"week":a=(r.getTime()-e.getTime())/6048e5;break;case"month":a=12*(r.getFullYear()-e.getFullYear())+(r.getMonth()-e.getMonth()),a+=(r.getDate()-e.getDate())/new Date(r.getFullYear(),r.getMonth()+1,0).getDate();break;case"quarter":a=4*(r.getFullYear()-e.getFullYear())+Math.floor(r.getMonth()/3)-Math.floor(e.getMonth()/3),a+=(r.getDate()-e.getDate())/(3*new Date(r.getFullYear(),r.getMonth()+1,0).getDate());break;case"year":a=r.getFullYear()-e.getFullYear(),a+=(r.getMonth()-e.getMonth())/12;break;default:throw new Error("Invalid time scale")}return a/i}function xi(n,e,t,i=!0){let{deltaX:s,deltaY:a}=n;n.shiftKey&&n.deltaY&&(s=a,a=0);const[r,l]=Bi(s,a,{horizontal:1,vertical:1});r&&(e.setScrollLeft(e.scroll.horizontalBarPos+r),t.scenegraph.scrollbarComponent.showHorizontalScrollBar(!0)),l&&(e.setScrollTop(e.scroll.verticalBarPos+l),t.scenegraph.scrollbarComponent.showVerticalScrollBar(!0)),i&&e.resetInteractionState(),n.cancelable&&(e._gantt.parsedOptions.overscrollBehavior==="none"||Math.abs(a)>=Math.abs(s)&&a!==0&&wi(a,e)||Math.abs(a)<=Math.abs(s)&&s!==0&&Oi(s,e))&&n.preventDefault()}function Bi(n,e,t){var i,s;const a=Math.abs(n/e),r=a<=.5?0:n,l=a>2?0:e;return[Math.ceil(r*((i=t.horizontal)!==null&&i!==void 0?i:0)),Math.ceil(l*((s=t.vertical)!==null&&s!==void 0?s:0))]}function wi(n,e){return e._gantt.getAllRowsHeight()-e._gantt.scenegraph.height!=0&&!Ci(n,e)&&!Di(n,e)}function Oi(n,e){return e._gantt.getAllDateColsWidth()-e._gantt.scenegraph.width!=0&&!Hi(n,e)&&!Ai(n,e)}function Ci(n,e){return e._gantt.getAllRowsHeight()-e._gantt.scenegraph.height!==0&&n<=0&&e.scroll.verticalBarPos<1}function Di(n,e){const t=e._gantt.getAllRowsHeight()-e._gantt.scenegraph.height;return t!==0&&n>=0&&Math.abs(e.scroll.verticalBarPos-t)<1}function Hi(n,e){return e._gantt.getAllDateColsWidth()-e._gantt.scenegraph.width!==0&&n<=0&&e.scroll.horizontalBarPos<1}function Ai(n,e){const t=e._gantt.getAllDateColsWidth()-e._gantt.scenegraph.width;return t!==0&&n>=0&&Math.abs(e.scroll.horizontalBarPos-t)<1}function Mi(n){const e=n._gantt,t=e.stateManager,i=e.scenegraph;i.scrollbarComponent.vScrollBar.addEventListener("pointerover",r=>{i.scrollbarComponent.showVerticalScrollBar()}),i.scrollbarComponent.hScrollBar.addEventListener("pointerover",r=>{i.scrollbarComponent.showHorizontalScrollBar()}),i.scrollbarComponent.vScrollBar.addEventListener("pointerout",r=>{t.interactionState!==I.scrolling&&i.scrollbarComponent.hideVerticalScrollBar()}),i.scrollbarComponent.hScrollBar.addEventListener("pointerout",r=>{t.interactionState!==I.scrolling&&i.scrollbarComponent.hideHorizontalScrollBar()}),i.scrollbarComponent.vScrollBar.addEventListener("pointermove",r=>{r.stopPropagation()}),i.scrollbarComponent.vScrollBar.addEventListener("scrollDown",r=>{i._gantt.eventManager.isDown=!0}),i.scrollbarComponent.vScrollBar.addEventListener("pointerup",()=>{i._gantt.eventManager.isDraging=!1,t.interactionState===I.scrolling&&t.updateInteractionState(I.default)}),i.scrollbarComponent.vScrollBar.addEventListener("pointerupoutside",()=>{t.interactionState===I.scrolling&&t.updateInteractionState(I.default)}),i.scrollbarComponent.vScrollBar.addEventListener("scrollUp",r=>{i._gantt.eventManager.isDraging=!1}),i.scrollbarComponent.hScrollBar.addEventListener("pointermove",r=>{r.stopPropagation()}),i.scrollbarComponent.hScrollBar.addEventListener("pointerdown",r=>{r.stopPropagation()}),i.scrollbarComponent.hScrollBar.addEventListener("scrollDown",r=>{i._gantt.eventManager.isDown=!0,t.interactionState!==I.scrolling&&t.updateInteractionState(I.scrolling)}),i.scrollbarComponent.hScrollBar.addEventListener("pointerup",()=>{t.interactionState===I.scrolling&&t.updateInteractionState(I.default)}),i.scrollbarComponent.hScrollBar.addEventListener("pointerupoutside",()=>{t.interactionState===I.scrolling&&t.updateInteractionState(I.default)}),i.scrollbarComponent.hScrollBar.addEventListener("scrollUp",r=>{i._gantt.eventManager.isDraging=!1});const s=Ot(t.updateVerticalScrollBar,20),a=Ot(t.updateHorizontalScrollBar,20);i.scrollbarComponent.vScrollBar.addEventListener("scrollDrag",r=>{i._gantt.eventManager.isDown&&(i._gantt.eventManager.isDraging=!0),t.interactionState!==I.scrolling&&t.updateInteractionState(I.scrolling);const l=r.detail.value[0]/(1-r.detail.value[1]+r.detail.value[0]);s(l,r)}),i.scrollbarComponent.hScrollBar.addEventListener("scrollDrag",r=>{i._gantt.eventManager.isDown&&(i._gantt.eventManager.isDraging=!0),t.fastScrolling=!0,t.interactionState!==I.scrolling&&t.updateInteractionState(I.scrolling);const l=r.detail.value[0]/(1-r.detail.value[1]+r.detail.value[0]);a(l)})}const Wi=typeof window>"u"||window.window===void 0;function Fe(n,e){const t=n+e.stateManager.scroll.horizontalBarPos,i=e.getDateColWidth(0);return Math.floor((t-i)/e.parsedOptions.timelineColWidth)+1}function vt(n){var e,t,i,s,a;return n?n===!0?[{date:j().toLocaleDateString(),scrollToMarkLine:!0,position:"left",style:{lineColor:"red",lineWidth:1}}]:Array.isArray(n)?n.map((r,l)=>{var o,h,d,c;return{date:r.date,scrollToMarkLine:r.scrollToMarkLine,position:(o=r.position)!==null&&o!==void 0?o:"left",style:{lineColor:((h=r.style)===null||h===void 0?void 0:h.lineColor)||"red",lineWidth:((d=r.style)===null||d===void 0?void 0:d.lineWidth)||1,lineDash:(c=r.style)===null||c===void 0?void 0:c.lineDash}}}):[{date:n.date,scrollToMarkLine:(e=n.scrollToMarkLine)===null||e===void 0||e,position:(t=n.position)!==null&&t!==void 0?t:"left",style:{lineColor:((i=n.style)===null||i===void 0?void 0:i.lineColor)||"red",lineWidth:((s=n.style)===null||s===void 0?void 0:s.lineWidth)||1,lineDash:(a=n.style)===null||a===void 0?void 0:a.lineDash}}]:[]}function zi(n){var e;return n!=null&&n.hoverOn||n!=null&&n.horizontalVisible&&(n==null?void 0:n.horizontalVisible)==="none"||!(n!=null&&n.horizontalVisible)&&(n==null?void 0:n.visible)==="none"?0:(e=n==null?void 0:n.width)!==null&&e!==void 0?e:7}function Ii(n){var e;return n!=null&&n.hoverOn||n!=null&&n.verticalVisible&&(n==null?void 0:n.verticalVisible)==="none"||!(n!=null&&n.verticalVisible)&&(n==null?void 0:n.visible)==="none"?0:(e=n==null?void 0:n.width)!==null&&e!==void 0?e:7}function Ct(n){var e,t,i,s,a,r,l,o,h,d,c,p,u,g,f,_,T,m,b,x,k,y,B,C,O,w,v,H,P,G,W,E,U,K,X,q,se,ae,re,le,ee,Z,ce,ue,pe,ge,fe,_e,be,me,ye,ke,Se,Le,ve,Te,xe,Be,we,Oe,Ce,De,He,Ae,Me,We,D,Ne,A,V,oe,Q,Ie,tt,it,nt,st,at,rt,lt,ot,dt,ht,ct,ut,pt,gt,ft,_t,bt,mt;const S=n.options;n.parsedOptions.tasksShowMode=(e=S==null?void 0:S.tasksShowMode)!==null&&e!==void 0?e:L.Tasks_Separate,n.parsedOptions.pixelRatio=(t=S==null?void 0:S.pixelRatio)!==null&&t!==void 0?t:1,n.parsedOptions.rowHeight=(i=S==null?void 0:S.rowHeight)!==null&&i!==void 0?i:40,n.parsedOptions.timelineColWidth=(a=(s=S==null?void 0:S.timelineHeader)===null||s===void 0?void 0:s.colWidth)!==null&&a!==void 0?a:60,n.parsedOptions.startDateField=(l=(r=S.taskBar)===null||r===void 0?void 0:r.startDateField)!==null&&l!==void 0?l:"startDate",n.parsedOptions.endDateField=(h=(o=S.taskBar)===null||o===void 0?void 0:o.endDateField)!==null&&h!==void 0?h:"endDate",n.parsedOptions.progressField=(c=(d=S.taskBar)===null||d===void 0?void 0:d.progressField)!==null&&c!==void 0?c:"progress";const{unit:yt,startOfWeek:Tt,step:Xt}=n.parsedOptions.reverseSortedTimelineScales[0];n.parsedOptions.minDate=S!=null&&S.minDate?ze(new Date(S.minDate),yt,Tt):void 0,n.parsedOptions.maxDate=S!=null&&S.maxDate?Ke(n.parsedOptions.minDate,new Date(S.maxDate),yt,Xt):void 0,n.parsedOptions._minDateTime=(p=n.parsedOptions.minDate)===null||p===void 0?void 0:p.getTime(),n.parsedOptions._maxDateTime=(u=n.parsedOptions.maxDate)===null||u===void 0?void 0:u.getTime(),n.parsedOptions.overscrollBehavior=(g=S==null?void 0:S.overscrollBehavior)!==null&&g!==void 0?g:"auto",n.parsedOptions.underlayBackgroundColor=(f=S==null?void 0:S.underlayBackgroundColor)!==null&&f!==void 0?f:"#FFF",n.parsedOptions.scrollStyle=Object.assign({},{scrollRailColor:"rgba(100, 100, 100, 0.2)",scrollSliderColor:"rgba(100, 100, 100, 0.5)",scrollSliderCornerRadius:4,width:10,visible:"always",hoverOn:!0,barToSide:!1},S==null?void 0:S.scrollStyle),n.parsedOptions.timelineHeaderHorizontalLineStyle=(_=S==null?void 0:S.timelineHeader)===null||_===void 0?void 0:_.horizontalLine,n.parsedOptions.timelineHeaderVerticalLineStyle=(T=S==null?void 0:S.timelineHeader)===null||T===void 0?void 0:T.verticalLine,n.parsedOptions.timelineHeaderBackgroundColor=(m=S==null?void 0:S.timelineHeader)===null||m===void 0?void 0:m.backgroundColor,n.parsedOptions.timeLineHeaderRowHeights=[],n.parsedOptions.timelineHeaderStyles=[];for(let te=0;(b=te<n.parsedOptions.sortedTimelineScales.length)!==null&&b!==void 0&&b;te++){const Yt=n.parsedOptions.sortedTimelineScales[te].style;n.parsedOptions.timelineHeaderStyles.push(Object.assign({fontSize:20,fontWeight:"bold",textAlign:"center",textBaseline:"middle",color:"#000",backgroundColor:"#fff"},Yt)),n.parsedOptions.timeLineHeaderRowHeights.push((k=(x=n.parsedOptions.sortedTimelineScales[te].rowHeight)!==null&&x!==void 0?x:S==null?void 0:S.headerRowHeight)!==null&&k!==void 0?k:40)}n.parsedOptions.grid=Object.assign({},S==null?void 0:S.grid),n.parsedOptions.taskBarStyle=Object.assign({},{barColor:"blue",completedBarColor:"gray",width:3*n.parsedOptions.rowHeight/4,cornerRadius:3,borderWidth:0,fontFamily:"Arial",fontSize:14},(y=S==null?void 0:S.taskBar)===null||y===void 0?void 0:y.barStyle),n.parsedOptions.taskBarMilestoneStyle=Object.assign({width:n.parsedOptions.taskBarStyle.width,borderColor:n.parsedOptions.taskBarStyle.borderColor,borderLineWidth:(B=n.parsedOptions.taskBarStyle.borderLineWidth)!==null&&B!==void 0?B:1,fillColor:n.parsedOptions.taskBarStyle.barColor,cornerRadius:0},(C=S==null?void 0:S.taskBar)===null||C===void 0?void 0:C.milestoneStyle),n.parsedOptions.taskBarMilestoneHypotenuse=n.parsedOptions.taskBarMilestoneStyle.width*Math.sqrt(2),n.parsedOptions.dateFormat=S==null?void 0:S.dateFormat,n.parsedOptions.taskBarHoverStyle=Object.assign({barOverlayColor:"rgba(99, 144, 0, 0.4)"},(O=S==null?void 0:S.taskBar)===null||O===void 0?void 0:O.hoverBarStyle),n.parsedOptions.taskBarSelectable=(v=(w=S==null?void 0:S.taskBar)===null||w===void 0?void 0:w.selectable)===null||v===void 0||v,n.parsedOptions.taskBarSelectedStyle=Object.assign({shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:n.parsedOptions.taskBarStyle.barColor,borderColor:n.parsedOptions.taskBarStyle.barColor,borderLineWidth:1},(H=S==null?void 0:S.taskBar)===null||H===void 0?void 0:H.selectedBarStyle),n.parsedOptions.taskBarLabelText=(G=(P=S==null?void 0:S.taskBar)===null||P===void 0?void 0:P.labelText)!==null&&G!==void 0?G:"",n.parsedOptions.taskBarMoveable=(E=(W=S==null?void 0:S.taskBar)===null||W===void 0?void 0:W.moveable)===null||E===void 0||E,n.parsedOptions.moveTaskBarToExtendDateRange=(K=(U=S==null?void 0:S.taskBar)===null||U===void 0?void 0:U.moveToExtendDateRange)===null||K===void 0||K,n.parsedOptions.taskBarResizable=(q=(X=S==null?void 0:S.taskBar)===null||X===void 0?void 0:X.resizable)===null||q===void 0||q,n.parsedOptions.taskBarDragOrder=(ae=(se=S==null?void 0:S.taskBar)===null||se===void 0?void 0:se.dragOrder)===null||ae===void 0||ae,n.parsedOptions.taskBarLabelStyle={fontFamily:(ee=(le=(re=S==null?void 0:S.taskBar)===null||re===void 0?void 0:re.labelTextStyle)===null||le===void 0?void 0:le.fontFamily)!==null&&ee!==void 0?ee:"Arial",fontSize:(ue=(ce=(Z=S==null?void 0:S.taskBar)===null||Z===void 0?void 0:Z.labelTextStyle)===null||ce===void 0?void 0:ce.fontSize)!==null&&ue!==void 0?ue:20,color:(fe=(ge=(pe=S==null?void 0:S.taskBar)===null||pe===void 0?void 0:pe.labelTextStyle)===null||ge===void 0?void 0:ge.color)!==null&&fe!==void 0?fe:"#F01",textAlign:(me=(be=(_e=S==null?void 0:S.taskBar)===null||_e===void 0?void 0:_e.labelTextStyle)===null||be===void 0?void 0:be.textAlign)!==null&&me!==void 0?me:"left",textBaseline:(Se=(ke=(ye=S==null?void 0:S.taskBar)===null||ye===void 0?void 0:ye.labelTextStyle)===null||ke===void 0?void 0:ke.textBaseline)!==null&&Se!==void 0?Se:"middle",padding:(Te=(ve=(Le=S==null?void 0:S.taskBar)===null||Le===void 0?void 0:Le.labelTextStyle)===null||ve===void 0?void 0:ve.padding)!==null&&Te!==void 0?Te:[0,0,0,10],textOverflow:(Be=(xe=S==null?void 0:S.taskBar)===null||xe===void 0?void 0:xe.labelTextStyle)===null||Be===void 0?void 0:Be.textOverflow},n.parsedOptions.taskBarCustomLayout=(we=S==null?void 0:S.taskBar)===null||we===void 0?void 0:we.customLayout,n.parsedOptions.taskBarCreatable=(Ce=(Oe=S==null?void 0:S.taskBar)===null||Oe===void 0?void 0:Oe.scheduleCreatable)!==null&&Ce!==void 0?Ce:!(n.parsedOptions.tasksShowMode!==L.Sub_Tasks_Separate&&n.parsedOptions.tasksShowMode!==L.Tasks_Separate),n.parsedOptions.taskBarCreationButtonStyle=Object.assign({lineColor:"rgb(99, 144, 0)",lineWidth:1,lineDash:[5,5],cornerRadius:4,backgroundColor:"#FFF"},(He=(De=S==null?void 0:S.taskBar)===null||De===void 0?void 0:De.scheduleCreation)===null||He===void 0?void 0:He.buttonStyle),n.parsedOptions.taskBarCreationCustomLayout=(Me=(Ae=S==null?void 0:S.taskBar)===null||Ae===void 0?void 0:Ae.scheduleCreation)===null||Me===void 0?void 0:Me.customLayout,n.parsedOptions.outerFrameStyle=Object.assign({borderColor:"#e1e4e8",borderLineWidth:1,cornerRadius:4},(We=S.frame)===null||We===void 0?void 0:We.outerFrameStyle),n.parsedOptions.markLine=vt(S==null?void 0:S.markLine),(Ne=(D=n.parsedOptions.markLine)===null||D===void 0?void 0:D.length)!==null&&Ne!==void 0&&Ne&&(!((A=n.parsedOptions.markLine)===null||A===void 0)&&A.every(te=>te.scrollToMarkLine===void 0)&&(n.parsedOptions.markLine[0].scrollToMarkLine=!0),!((V=n.parsedOptions.markLine)===null||V===void 0)&&V.find(te=>te.scrollToMarkLine)&&(n.parsedOptions.scrollToMarkLineDate=ze(new Date((oe=n.parsedOptions.markLine)===null||oe===void 0?void 0:oe.find(te=>te.scrollToMarkLine).date),yt,Tt))),n.parsedOptions.verticalSplitLineHighlight=(Q=S.frame)===null||Q===void 0?void 0:Q.verticalSplitLineHighlight,n.parsedOptions.verticalSplitLine=Object.assign({lineColor:(Ie=n.parsedOptions.outerFrameStyle)===null||Ie===void 0?void 0:Ie.borderColor,lineWidth:(tt=n.parsedOptions.outerFrameStyle)===null||tt===void 0?void 0:tt.borderLineWidth},(it=S.frame)===null||it===void 0?void 0:it.verticalSplitLine),n.parsedOptions.horizontalSplitLine=(nt=S.frame)===null||nt===void 0?void 0:nt.horizontalSplitLine,n.parsedOptions.verticalSplitLineMoveable=(st=S.frame)===null||st===void 0?void 0:st.verticalSplitLineMoveable,n.parsedOptions.taskKeyField=(at=S.taskKeyField)!==null&&at!==void 0?at:"id",n.parsedOptions.dependencyLinks=(lt=(rt=S.dependency)===null||rt===void 0?void 0:rt.links)!==null&&lt!==void 0?lt:[],n.parsedOptions.dependencyLinkCreatable=(dt=(ot=S.dependency)===null||ot===void 0?void 0:ot.linkCreatable)!==null&&dt!==void 0&&dt,n.parsedOptions.dependencyLinkSelectable=(ct=(ht=S.dependency)===null||ht===void 0?void 0:ht.linkSelectable)===null||ct===void 0||ct,n.parsedOptions.dependencyLinkDeletable=(pt=(ut=S.dependency)===null||ut===void 0?void 0:ut.linkDeletable)!==null&&pt!==void 0&&pt,n.parsedOptions.dependencyLinkLineStyle=Object.assign({lineColor:"red",lineWidth:1},(gt=S.dependency)===null||gt===void 0?void 0:gt.linkLineStyle),n.parsedOptions.dependencyLinkSelectedLineStyle=Object.assign({shadowBlur:4,shadowOffset:0,shadowColor:n.parsedOptions.dependencyLinkLineStyle.lineColor,lineColor:n.parsedOptions.dependencyLinkLineStyle.lineColor,lineWidth:n.parsedOptions.dependencyLinkLineStyle.lineWidth},(ft=S==null?void 0:S.dependency)===null||ft===void 0?void 0:ft.linkSelectedLineStyle),n.parsedOptions.dependencyLinkLineCreatePointStyle=Object.assign({strokeColor:"red",fillColor:"white",radius:5,strokeWidth:1},(_t=S==null?void 0:S.dependency)===null||_t===void 0?void 0:_t.linkCreatePointStyle),n.parsedOptions.dependencyLinkLineCreatingPointStyle=Object.assign({strokeColor:"red",fillColor:"red",radius:5,strokeWidth:1},(bt=S==null?void 0:S.dependency)===null||bt===void 0?void 0:bt.linkCreatingPointStyle),n.parsedOptions.dependencyLinkLineCreatingStyle=Object.assign({lineColor:"red",lineWidth:1,lineDash:[5,5]},(mt=S==null?void 0:S.dependency)===null||mt===void 0?void 0:mt.linkCreatingLineStyle),n.parsedOptions.eventOptions=S==null?void 0:S.eventOptions,n.parsedOptions.keyboardOptions=S==null?void 0:S.keyboardOptions}function Pi(n){var e,t,i,s,a;const r=n.options,{unit:l,startOfWeek:o,step:h}=n.parsedOptions.reverseSortedTimelineScales[0];n.parsedOptions.minDate=ze(new Date(n.parsedOptions.minDate),l,o),n.parsedOptions.maxDate=Ke(n.parsedOptions.minDate,new Date(n.parsedOptions.maxDate),l,h),n.parsedOptions._minDateTime=(e=n.parsedOptions.minDate)===null||e===void 0?void 0:e.getTime(),n.parsedOptions._maxDateTime=(t=n.parsedOptions.maxDate)===null||t===void 0?void 0:t.getTime(),n.parsedOptions.timeLineHeaderRowHeights=[],n.parsedOptions.timelineHeaderStyles=[];for(let d=0;(i=d<n.parsedOptions.sortedTimelineScales.length)!==null&&i!==void 0&&i;d++){const c=n.parsedOptions.sortedTimelineScales[d].style;n.parsedOptions.timelineHeaderStyles.push(Object.assign({fontSize:20,fontWeight:"bold",textAlign:"center",textBaseline:"middle",color:"#000",backgroundColor:"#fff"},c)),n.parsedOptions.timeLineHeaderRowHeights.push((a=(s=n.parsedOptions.sortedTimelineScales[d].rowHeight)!==null&&s!==void 0?s:r==null?void 0:r.headerRowHeight)!==null&&a!==void 0?a:40)}}function Ei(n,e,t){var i;const{unit:s,step:a,format:r}=t,l=[];for(;n<e;)if(s==="day"){const o=n.getFullYear(),h=n.getMonth(),d=n.getDate(),c=he(new Date(o,h,d+a-1),!0);c.getTime()>e.getTime()&&c.setTime(e.getTime());const p=n,u=(r==null?void 0:r({dateIndex:d,startDate:p,endDate:c}))||d.toString(),g={days:Math.abs(c.getTime()-n.getTime()+1)/864e5,startDate:p,endDate:c,step:a,unit:"day",title:u,dateIndex:d};l.push(g),n=new Date(o,h,d+a)}else if(s==="month"){const o=n.getFullYear(),h=n.getMonth(),d=he(new Date(o,h+a,0),!0);d.getTime()>e.getTime()&&d.setTime(e.getTime());const c=n,p=(r==null?void 0:r({dateIndex:h+1,startDate:c,endDate:d}))||(h+1).toString(),u={days:Math.abs(d.getTime()-n.getTime()+1)/864e5,startDate:c,step:a,unit:"month",endDate:d,title:p,dateIndex:h+1};l.push(u),n=new Date(o,h+a,1)}else if(s==="quarter"){const o=n.getFullYear(),h=Math.floor(n.getMonth()/3),d=he(new Date(o,3*(h+a),0),!0);d.getTime()>e.getTime()&&d.setTime(e.getTime());const c=n,p=(r==null?void 0:r({dateIndex:h+1,startDate:c,endDate:d}))||(h+1).toString(),u={days:Math.abs(d.getTime()-n.getTime()+1)/864e5,startDate:c,step:a,unit:"quarter",endDate:d,title:p,dateIndex:h+1};l.push(u),n=new Date(o,3*(h+a),1)}else if(s==="year"){const o=n.getFullYear(),h=he(new Date(o+a-1,11,31),!0);h.getTime()>e.getTime()&&h.setTime(e.getTime());const d=n,c=(r==null?void 0:r({dateIndex:o,startDate:d,endDate:h}))||o.toString(),p={days:Math.abs(h.getTime()-n.getTime()+1)/864e5,startDate:d,endDate:h,step:a,unit:"year",title:c,dateIndex:o};l.push(p),n=new Date(o+a,0,1)}else if(s==="week"){const o=(i=t.startOfWeek)!==null&&i!==void 0?i:"monday";let h=n.getDay();o==="monday"&&(h=h===0?6:h-1);const d=j(n),c=he(n.getTime()+24*(7*a-h)*60*60*1e3-1,!0);c>e&&c.setTime(e.getTime());const p=ki(d),u=(r==null?void 0:r({dateIndex:p,startDate:d,endDate:c}))||p.toString(),g={days:(c.getTime()-d.getTime()+1)/864e5,startDate:d,endDate:c,step:a,unit:"week",title:u,dateIndex:p};l.push(g),n.setTime(j(n.getTime()+24*(7*a-h)*60*60*1e3,!0).getTime())}else if(s==="hour"){const o=n.getFullYear(),h=n.getMonth(),d=n.getDate(),c=n.getHours(),p=vi(new Date(o,h,d,c+a-1),!0);p.getTime()>e.getTime()&&p.setTime(e.getTime());const u=n,g=(r==null?void 0:r({dateIndex:c,startDate:u,endDate:p}))||c.toString(),f={days:Math.abs(p.getTime()-n.getTime()+1)/864e5,startDate:u,endDate:p,step:a,unit:"hour",title:g,dateIndex:n.getHours()};l.push(f),n=new Date(o,h,d,c+a)}else if(s==="minute"){const o=n.getFullYear(),h=n.getMonth(),d=n.getDate(),c=n.getHours(),p=n.getMinutes(),u=Ti(new Date(o,h,d,c,p+a-1),!0);u.getTime()>e.getTime()&&u.setTime(e.getTime());const g=n,f=(r==null?void 0:r({dateIndex:p,startDate:g,endDate:u}))||p.toString(),_={days:Math.abs(u.getTime()-n.getTime()+1)/864e5,startDate:g,endDate:u,step:a,unit:"minute",title:f,dateIndex:n.getMinutes()};l.push(_),n=new Date(o,h,d,c,p+a)}else if(s==="second"){const o=n.getFullYear(),h=n.getMonth(),d=n.getDate(),c=n.getHours(),p=n.getMinutes(),u=n.getSeconds(),g=Mt(new Date(o,h,d,c,p,u+a-1),!0);g.getTime()>e.getTime()&&g.setTime(e.getTime());const f=n,_=(r==null?void 0:r({dateIndex:u,startDate:f,endDate:g}))||u.toString(),T={days:Math.abs(g.getTime()-n.getTime()+1)/864e5,startDate:f,endDate:g,step:a,unit:"second",title:_,dateIndex:n.getSeconds()};l.push(T),n=new Date(o,h,d,c,p,u+a)}return l}function et(n,e,t,i,s){var a,r,l,o,h,d,c,p,u;let g=(a=n[3])!==null&&a!==void 0?a:10;e==="right"||e==="end"?g=i-0-((r=n[1])!==null&&r!==void 0?r:10):e==="center"&&(g=0+(i-0+((l=n[3])!==null&&l!==void 0?l:10)-((o=n[1])!==null&&o!==void 0?o:10))/2);let f=0+((h=n[0])!==null&&h!==void 0?h:10);return t==="bottom"||t==="alphabetic"||t==="ideographic"?f=s-0-((d=n[2])!==null&&d!==void 0?d:10):t==="middle"&&(f=0+(s-0-((c=n[0])!==null&&c!==void 0?c:10)-((p=n[2])!==null&&p!==void 0?p:10))/2+((u=n[0])!==null&&u!==void 0?u:10)),{x:g,y:f}}function Ri(n){return typeof n=="string"&&(n=n.replace("%",""),n=parseFloat(n)),n<=1&&(n*=100),Math.round(n)}function Fi(n){var e,t;if(n.taskListTableInstance){n.verticalSplitResizeLine=document.createElement("div"),n.verticalSplitResizeLine.style.position="absolute",n.verticalSplitResizeLine.style.top=n.tableY+"px",n.verticalSplitResizeLine.style.left=(n.taskTableWidth?n.taskTableWidth-7+n.parsedOptions.verticalSplitLine.lineWidth/2:0)+"px",n.verticalSplitResizeLine.style.width="14px",n.verticalSplitResizeLine.style.height=n.drawHeight+"px",n.verticalSplitResizeLine.style.backgroundColor="rgba(0,0,0,0)",n.verticalSplitResizeLine.style.zIndex="100",n.parsedOptions.verticalSplitLineMoveable&&(n.verticalSplitResizeLine.style.cursor="col-resize"),n.verticalSplitResizeLine.style.userSelect="none",n.verticalSplitResizeLine.style.opacity="1";const i=document.createElement("div");if(i.style.position="absolute",i.style.top="0px",i.style.left=(14-n.parsedOptions.verticalSplitLine.lineWidth)/2+"px",i.style.width=n.parsedOptions.verticalSplitLine.lineWidth+"px",i.style.height="100%",i.style.backgroundColor=n.parsedOptions.verticalSplitLine.lineColor,i.style.zIndex="100",i.style.userSelect="none",i.style.pointerEvents="none",i.style.transition="background-color 0.3s",n.verticalSplitResizeLine.appendChild(i),n.parsedOptions.verticalSplitLineHighlight){const s=document.createElement("div");s.style.position="absolute",s.style.top="0px",s.style.left=((e=14-n.parsedOptions.verticalSplitLineHighlight.lineWidth)!==null&&e!==void 0?e:2)/2+"px",s.style.width=((t=n.parsedOptions.verticalSplitLineHighlight.lineWidth)!==null&&t!==void 0?t:2)+"px",s.style.height="100%",s.style.backgroundColor=n.parsedOptions.verticalSplitLineHighlight.lineColor,s.style.zIndex="100",s.style.cursor="col-resize",s.style.userSelect="none",s.style.pointerEvents="none",s.style.opacity="0",s.style.transition="background-color 0.3s",n.verticalSplitResizeLine.appendChild(s)}n.container.appendChild(n.verticalSplitResizeLine)}}function qe(n){var e,t;if(n.verticalSplitResizeLine){n.verticalSplitResizeLine.style.position="absolute",n.verticalSplitResizeLine.style.top=n.tableY+"px",n.verticalSplitResizeLine.style.left=n.taskTableWidth?n.taskTableWidth-7+n.parsedOptions.verticalSplitLine.lineWidth/2+"px":"0px",n.verticalSplitResizeLine.style.width="14px",n.verticalSplitResizeLine.style.height=n.drawHeight+"px",n.verticalSplitResizeLine.style.backgroundColor="rgba(0,0,0,0)",n.verticalSplitResizeLine.style.zIndex="100",n.parsedOptions.verticalSplitLineMoveable&&(n.verticalSplitResizeLine.style.cursor="col-resize"),n.verticalSplitResizeLine.style.userSelect="none",n.verticalSplitResizeLine.style.opacity="1";const i=n.verticalSplitResizeLine.childNodes[0];if(i.style.position="absolute",i.style.top="0px",i.style.left=(14-n.parsedOptions.verticalSplitLine.lineWidth)/2+"px",i.style.width=n.parsedOptions.verticalSplitLine.lineWidth+"px",i.style.height="100%",i.style.backgroundColor=n.parsedOptions.verticalSplitLine.lineColor,i.style.zIndex="100",i.style.userSelect="none",i.style.pointerEvents="none",i.style.transition="background-color 0.3s",n.verticalSplitResizeLine.childNodes[1]){const s=n.verticalSplitResizeLine.childNodes[1];s.style.position="absolute",s.style.top="0px",s.style.left=((e=14-n.parsedOptions.verticalSplitLineHighlight.lineWidth)!==null&&e!==void 0?e:2)/2+"px",s.style.width=((t=n.parsedOptions.verticalSplitLineHighlight.lineWidth)!==null&&t!==void 0?t:2)+"px",s.style.height="100%",s.style.backgroundColor=n.parsedOptions.verticalSplitLineHighlight.lineColor,s.style.zIndex="100",s.style.cursor="col-resize",s.style.userSelect="none",s.style.pointerEvents="none",s.style.opacity="0",s.style.transition="background-color 0.3s"}}}function ne(n,e,t,i="children"){var s;for(let a=0;a<n.length;a++){if(Array.isArray(t)&&t.length===1&&n[a][e]===t[0]||n[a][e]===t)return{record:n[a],index:[a]};if(!((s=n[a][i])===null||s===void 0)&&s.length){if(Array.isArray(t)&&t[0]===n[a][e]){const r=ne(n[a][i],e,t.slice(1));if(r)return r.index.unshift(a),r}else if(!Array.isArray(t)){const r=ne(n[a][i],e,t);if(r)return r.index.unshift(a),r}}}}function Wt(n,e="children"){var t;for(let i=0;i<n.length;i++)!((t=n[i][e])===null||t===void 0)&&t.length?Wt(n[i][e],e):(delete n[i].vtable_gantt_linkedTo,delete n[i].vtable_gantt_linkedFrom)}function zt(n,e="children"){var t;for(let i=0;i<n.length;i++)!((t=n[i][e])===null||t===void 0)&&t.length?zt(n[i][e],e):delete n[i].vtable_gantt_showIndex}function J(n,e){let t,i;if(e.taskListTableInstance){const s=e.taskListTableInstance.getTargetRowAt(n+e.headerHeight);if(s){const{row:a}=s;t=a-e.taskListTableInstance.columnHeaderLevelCount;const r=e.getRowsHeightByIndex(0,t-1);e.parsedOptions.tasksShowMode!==L.Sub_Tasks_Inline&&e.parsedOptions.tasksShowMode!==L.Sub_Tasks_Arrange&&e.parsedOptions.tasksShowMode!==L.Sub_Tasks_Compact&&e.parsedOptions.tasksShowMode!==L.Sub_Tasks_Separate||(i=Math.floor((n-r)/e.parsedOptions.rowHeight))}}else t=Math.floor(n/e.parsedOptions.rowHeight);return{task_index:t,sub_task_index:i}}function It(n,e){var t;if(!e.children||e.children.length===1)return((t=e.children)===null||t===void 0?void 0:t.length)===1?e.children[0].vtable_gantt_showIndex=0:e.vtable_gantt_showIndex=0,1;const i=e.children.slice().sort((a,r)=>{const{startDate:l}=Ye(n,a),{startDate:o}=Ye(n,r);return l.getTime()-o.getTime()}),s=[];for(let a=0;a<=i.length-1;a++){const r=i[a],{startDate:l,endDate:o}=Ye(n,r);let h=!1;for(let d=0;d<s.length;d++)if(l.getTime()>s[d]){s[d]=o.getTime(),h=!0,r.vtable_gantt_showIndex=d;break}h||(s.push(o.getTime()),r.vtable_gantt_showIndex=s.length-1)}return s.length}function Ni(n,e,t,i){return t.some(s=>{const{startDate:a,endDate:r}=Ye(i,s);return n<=r&&a<=e})}function Pt(n,e){var t;if(!e.children||e.children.length===1)return((t=e.children)===null||t===void 0?void 0:t.length)===1?e.children[0].vtable_gantt_showIndex=0:e.vtable_gantt_showIndex=0,1;const i=[];for(let s=0;s<=e.children.length-1;s++){const a=e.children[s],{startDate:r,endDate:l}=Ye(n,a);let o=!1;for(let h=0;h<i.length;h++)if(!Ni(r,l,e.children.filter(d=>d!==a&&d.vtable_gantt_showIndex===h),n)){i[h]=l.getTime(),o=!0,a.vtable_gantt_showIndex=h;break}o||(i.push(l.getTime()),a.vtable_gantt_showIndex=i.length-1)}return i.length}function Ye(n,e){const{timeScaleIncludeHour:t,startDateField:i,endDateField:s}=n.parsedOptions,a=e[i],r=e[s];return t?{startDate:j(a),endDate:he(r)}:{startDate:j(a,!0),endDate:he(r,!0)}}function Gi(n){var e,t,i,s,a,r;const l=n.options,{unit:o,startOfWeek:h}=n.parsedOptions.reverseSortedTimelineScales[0];n.parsedOptions.markLine=vt(l==null?void 0:l.markLine),(t=(e=n.parsedOptions.markLine)===null||e===void 0?void 0:e.length)!==null&&t!==void 0&&t&&(!((i=n.parsedOptions.markLine)===null||i===void 0)&&i.every(d=>d.scrollToMarkLine===void 0)&&(n.parsedOptions.markLine[0].scrollToMarkLine=!0),!((s=n.parsedOptions.markLine)===null||s===void 0)&&s.find(d=>d.scrollToMarkLine)&&(n.parsedOptions.scrollToMarkLineDate=ze(new Date((a=n.parsedOptions.markLine)===null||a===void 0?void 0:a.find(d=>d.scrollToMarkLine).date),o,h))),n.parsedOptions.dependencyLinks=(r=l.dependency)===null||r===void 0?void 0:r.links}function ji(n){var e,t;const i=n.options,{unit:s,startOfWeek:a,step:r}=n.parsedOptions.reverseSortedTimelineScales[0];n.parsedOptions.minDate=i!=null&&i.minDate?ze(new Date(i.minDate),s,a):void 0,n.parsedOptions.maxDate=i!=null&&i.maxDate?Ke(n.parsedOptions.minDate,new Date(i.maxDate),s,r):void 0,n.parsedOptions._minDateTime=(e=n.parsedOptions.minDate)===null||e===void 0?void 0:e.getTime(),n.parsedOptions._maxDateTime=(t=n.parsedOptions.maxDate)===null||t===void 0?void 0:t.getTime()}function Xi(n){const e=n.options;n.parsedOptions.markLine=vt(e==null?void 0:e.markLine)}function Yi(n,e,t){const i=J(e-t.headerHeight+t.stateManager.scrollTop,t),s=t.getRecordByIndex(i.task_index),a=Fe(n,t),r=t.getDateRangeByIndex(a);if(s!=null&&s.children){const l=J(e-t.headerHeight+t.stateManager.scrollTop,t);for(let o=0;o<s.children.length;o++){const{startDate:h,endDate:d,taskDays:c,progress:p,taskRecord:u}=t.getTaskInfoByTaskListIndex(l.task_index,o);if(((t.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact||t.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange)&&u.vtable_gantt_showIndex===l.sub_task_index||t.parsedOptions.tasksShowMode===L.Sub_Tasks_Inline)&&r.startDate.getTime()>=h.getTime()&&r.endDate.getTime()<=d.getTime())return{startDate:h,endDate:d,taskDays:c,progress:p,taskRecord:u}}}}class Vi{constructor(e){this._scene=e,this.initNodes()}initNodes(){var e,t,i,s,a,r,l,o,h;const{_scene:d}=this,c=new M({x:0,y:0,width:d._gantt.getAllDateColsWidth(),height:d._gantt.getAllHeaderRowsHeight(),clip:!0,pickable:!1});this.group=c,c.name="date-header-container",d.ganttGroup.addChild(this.group);const{unit:p,step:u}=d._gantt.parsedOptions.reverseSortedTimelineScales[0];let g=0;for(let f=0;f<d._gantt.timeLineHeaderLevel;f++){const _=new M({x:0,y:g,width:d._gantt.getAllDateColsWidth(),height:d._gantt.parsedOptions.timeLineHeaderRowHeights[f],clip:!1});g+=_.attribute.height,_.name="row-header",c.addChild(_);const{timelineDates:T,customLayout:m}=d._gantt.parsedOptions.sortedTimelineScales[f];for(let b=0;b<(T==null?void 0:T.length);b++){const{days:x,endDate:k,startDate:y,title:B,dateIndex:C,unit:O}=T[b],w=Math.ceil(R(y,d._gantt.parsedOptions.minDate,p,u)*d._gantt.parsedOptions.timelineColWidth),v=Math.ceil(R(k,d._gantt.parsedOptions.minDate,p,u,1)*d._gantt.parsedOptions.timelineColWidth)-w,H=new M({x:w,y:0,width:v,height:_.attribute.height,clip:!1,fill:d._gantt.parsedOptions.timelineHeaderBackgroundColor});let P;H.name="date-header-cell";let G=!0;const W=_.attribute.height;if(m){let E;typeof m=="function"?E=m({width:v,height:W,index:b,startDate:y,endDate:k,days:x,dateIndex:C,title:B,ganttInstance:this._scene._gantt}):E=m,E&&(P=E.rootContainer,G=(e=E.renderDefaultText)!==null&&e!==void 0&&e,P.name="task-bar-custom-render"),P&&H.appendChild(P)}if(G){const{padding:E,textAlign:U,textBaseline:K,textOverflow:X,fontSize:q,fontWeight:se,color:ae,strokeColor:re,textStick:le}=d._gantt.parsedOptions.timelineHeaderStyles[f],ee=et(Je(E),U,K,v,W),Z=new de({x:ee.x,y:ee.y,maxLineWidth:v,heightLimit:W,pickable:!0,text:B.toLocaleString(),fontSize:q,fontWeight:se,fill:ae,stroke:re,lineWidth:2,textAlign:U,textBaseline:K,ellipsis:X==="clip"?"":X==="ellipsis"?"...":N(X)?X:void 0});Z.attribute.textStick=le,H.appendChild(Z),Z.name="date-header-cell-text"}if(_.addChild(H),b>0){const E=$({pickable:!1,stroke:(t=d._gantt.parsedOptions.timelineHeaderVerticalLineStyle)===null||t===void 0?void 0:t.lineColor,lineWidth:(i=d._gantt.parsedOptions.timelineHeaderVerticalLineStyle)===null||i===void 0?void 0:i.lineWidth,points:[{x:1&((s=d._gantt.parsedOptions.timelineHeaderVerticalLineStyle)===null||s===void 0?void 0:s.lineWidth)?.5:0,y:0},{x:1&((a=d._gantt.parsedOptions.timelineHeaderVerticalLineStyle)===null||a===void 0?void 0:a.lineWidth)?.5:0,y:_.attribute.height}]});H.appendChild(E)}}if(f>0){const b=$({pickable:!1,stroke:(r=d._gantt.parsedOptions.timelineHeaderHorizontalLineStyle)===null||r===void 0?void 0:r.lineColor,lineWidth:(l=d._gantt.parsedOptions.timelineHeaderHorizontalLineStyle)===null||l===void 0?void 0:l.lineWidth,points:[{x:0,y:1&((o=d._gantt.parsedOptions.timelineHeaderHorizontalLineStyle)===null||o===void 0?void 0:o.lineWidth)?.5:0},{x:d._gantt.getAllDateColsWidth(),y:1&((h=d._gantt.parsedOptions.timelineHeaderHorizontalLineStyle)===null||h===void 0?void 0:h.lineWidth)?.5:0}]});_.addChild(b)}}}setX(e){this.group.setAttribute("x",e)}setY(e){this.group.setAttribute("y",e)}resize(){var e,t,i,s;this.group.setAttribute("width",(t=(e=this.group.attribute)===null||e===void 0?void 0:e.width)!==null&&t!==void 0?t:0),this.group.setAttribute("height",(s=(i=this.group.attribute)===null||i===void 0?void 0:i.height)!==null&&s!==void 0?s:0)}refresh(){var e;(e=this.group)===null||e===void 0||e.parent.removeChild(this.group),this.initNodes()}}class Ki extends M{constructor(e){super(e)}}const Dt=`<svg width="100" height="200" xmlns="http://www.w3.org/2000/svg">
  <line x1="30" y1="10" x2="30" y2="190" stroke="black" stroke-width="4"/>
  <line x1="70" y1="10" x2="70" y2="190" stroke="black" stroke-width="4"/>
</svg>`,Et=10;class Ui{constructor(e){this.selectedBorders=[],this._scene=e,this.width=e._gantt.tableNoFrameWidth,this.height=e._gantt.gridHeight,this.group=new M({x:0,y:e._gantt.getAllHeaderRowsHeight(),width:this.width,height:this.height,pickable:!1,clip:!0}),this.group.name="task-bar-container",e.ganttGroup.addChild(this.group),this.initBars(),this.initHoverBarIcons()}initBars(){var e,t;this.barContainer=new M({x:0,y:0,width:this._scene._gantt.getAllDateColsWidth(),height:this._scene._gantt.getAllTaskBarsHeight(),pickable:!1,clip:!0}),this.group.appendChild(this.barContainer);for(let i=0;i<this._scene._gantt.itemCount;i++)if(this._scene._gantt.parsedOptions.tasksShowMode!==L.Sub_Tasks_Inline&&this._scene._gantt.parsedOptions.tasksShowMode!==L.Sub_Tasks_Separate&&this._scene._gantt.parsedOptions.tasksShowMode!==L.Sub_Tasks_Arrange&&this._scene._gantt.parsedOptions.tasksShowMode!==L.Sub_Tasks_Compact){const s=this.initBar(i);s&&this.barContainer.appendChild(s)}else{const s=this._scene._gantt.getRecordByIndex(i);if(((e=s.children)===null||e===void 0?void 0:e.length)>0)for(let a=0;a<((t=s.children)===null||t===void 0?void 0:t.length);a++){const r=this.initBar(i,a,s.children.length);r&&this.barContainer.appendChild(r)}else{const a=this.initBar(i);a&&this.barContainer.appendChild(a)}}}initBar(e,t,i){var s,a,r;const l=this._scene._gantt.parsedOptions.taskBarCustomLayout,{startDate:o,endDate:h,taskDays:d,progress:c,taskRecord:p}=this._scene._gantt.getTaskInfoByTaskListIndex(e,t),u=p.type==="milestone";if(u&&!o||!u&&(d<=0||!o||!h||o.getTime()>h.getTime()))return null;const{unit:g,step:f}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],_=R(h,o,g,f,1)*this._scene._gantt.parsedOptions.timelineColWidth,T=this._scene._gantt.parsedOptions.taskBarStyle.width,m=(j(this._scene._gantt.parsedOptions.minDate),this._scene._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Separate||(this._scene._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange?Pt(this._scene._gantt,this._scene._gantt.records[e]):this._scene._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact&&It(this._scene._gantt,this._scene._gantt.records[e])),this._scene._gantt.parsedOptions.rowHeight),b=this._scene._gantt.parsedOptions.taskBarMilestoneStyle.width,x=R(o,this._scene._gantt.parsedOptions.minDate,g,f)*this._scene._gantt.parsedOptions.timelineColWidth-(u?b/2:0),k=this._scene._gantt.getRowsHeightByIndex(0,e-1)+(this._scene._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Separate?(t??0)*m:this._scene._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact?p.vtable_gantt_showIndex*m:0)+(m-(u?b:T))/2,y=new Ki({x,y:k,width:u?b:_,height:u?b:T,cornerRadius:u?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.cornerRadius:this._scene._gantt.parsedOptions.taskBarStyle.cornerRadius,lineWidth:u?2*this._scene._gantt.parsedOptions.taskBarMilestoneStyle.borderLineWidth:2*((s=this._scene._gantt.parsedOptions.taskBarStyle.borderLineWidth)!==null&&s!==void 0?s:this._scene._gantt.parsedOptions.taskBarStyle.borderWidth),stroke:u?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.borderColor:this._scene._gantt.parsedOptions.taskBarStyle.borderColor,angle:u?.25*Math.PI:0,anchor:u?[x+b/2,k+b/2]:void 0});y.name="task-bar",y.task_index=e,y.sub_task_index=t,y.record=p;const B=new M({x:0,y:0,width:y.attribute.width,height:y.attribute.height,cornerRadius:u?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.cornerRadius:this._scene._gantt.parsedOptions.taskBarStyle.cornerRadius,clip:!0});let C;B.name="task-bar-group",y.appendChild(B),y.clipGroupBox=B;let O=!0,w=!0;if(l){let v;typeof l=="function"?v=l({width:_,height:T,index:e,startDate:o,endDate:h,taskDays:d,progress:c,taskRecord:p,ganttInstance:this._scene._gantt}):v=l,v&&(C=v.rootContainer,O=(a=v.renderDefaultBar)!==null&&a!==void 0&&a,w=(r=v.renderDefaultText)!==null&&r!==void 0&&r,C&&(C.name="task-bar-custom-render"))}if(O){const v=Ve({x:0,y:0,width:y.attribute.width,height:y.attribute.height,fill:u?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.fillColor:this._scene._gantt.parsedOptions.taskBarStyle.barColor,pickable:!1});if(v.name="task-bar-rect",B.appendChild(v),y.barRect=v,p.type!=="milestone"){const H=Ve({x:0,y:0,width:_*c/100,height:T,fill:this._scene._gantt.parsedOptions.taskBarStyle.completedBarColor,pickable:!1});H.name="task-bar-progress-rect",B.appendChild(H),y.progressRect=H}}if(C&&B.appendChild(C),w&&p.type!=="milestone"){const{textAlign:v,textBaseline:H,fontSize:P,fontFamily:G,textOverflow:W,color:E,padding:U}=this._scene._gantt.parsedOptions.taskBarLabelStyle,K=et(Je(U),v,H,_,T),X=Kt({x:K.x,y:K.y,fontSize:P,fill:E,fontFamily:G,text:yi(this._scene._gantt.parsedOptions.taskBarLabelText,p),maxLineWidth:_-10,textBaseline:H,textAlign:v,ellipsis:W==="clip"?"":W==="ellipsis"?"...":N(W)?W:void 0,poptip:{position:"bottom",dx:(_-10)/4}});B.appendChild(X),y.textLabel=X}return y}updateTaskBarNode(e,t){const i=this.getTaskBarNodeByIndex(e,t);i&&this.barContainer.removeChild(i);const s=this.initBar(e,t);s&&this.barContainer.insertInto(s,e)}initHoverBarIcons(){var e,t;const i=new M({x:0,y:0,width:100,height:100,clip:!0,pickable:!1,cornerRadius:(t=(e=this._scene._gantt.parsedOptions.taskBarHoverStyle.cornerRadius)!==null&&e!==void 0?e:this._scene._gantt.parsedOptions.taskBarStyle.cornerRadius)!==null&&t!==void 0?t:0,fill:this._scene._gantt.parsedOptions.taskBarHoverStyle.barOverlayColor,visibleAll:!1});if(this.hoverBarGroup=i,i.name="task-bar-hover-shadow",this._scene._gantt.parsedOptions.taskBarResizable){const s=new Ze({x:0,y:0,width:10,height:20,image:Dt,pickable:!0,cursor:"col-resize"});s.name="task-bar-hover-shadow-left-icon",this.hoverBarLeftIcon=s,i.appendChild(s);const a=new Ze({x:0,y:0,width:10,height:20,image:Dt,pickable:!0,cursor:"col-resize"});a.name="task-bar-hover-shadow-right-icon",this.hoverBarRightIcon=a,i.appendChild(a)}}setX(e){this.barContainer.setAttribute("x",e)}setY(e){this.barContainer.setAttribute("y",e)}refresh(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttributes({height:this.height,width:this.width,y:this._scene._gantt.getAllHeaderRowsHeight()});const e=this.barContainer.attribute.x,t=this.barContainer.attribute.y;this.barContainer.removeAllChild(),this.group.removeChild(this.barContainer),this.initBars(),this.setX(e),this.setY(t)}resize(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttribute("width",this.width),this.group.setAttribute("height",this.height)}showHoverBar(e,t,i,s,a){var r,l,o,h;const{startDate:d,endDate:c,taskRecord:p}=this._scene._gantt.getTaskInfoByTaskListIndex(a.task_index,a.sub_task_index);if(a&&a.name==="task-bar"&&a.appendChild(this.hoverBarGroup),this.hoverBarGroup.setAttribute("x",0),this.hoverBarGroup.setAttribute("y",0),this.hoverBarGroup.setAttribute("width",i),this.hoverBarGroup.setAttribute("height",s),this.hoverBarGroup.setAttribute("visibleAll",!0),p.type==="milestone")this.hoverBarGroup.setAttribute("cornerRadius",a.attribute.cornerRadius);else{const f=(l=(r=this._scene._gantt.parsedOptions.taskBarHoverStyle.cornerRadius)!==null&&r!==void 0?r:this._scene._gantt.parsedOptions.taskBarStyle.cornerRadius)!==null&&l!==void 0?l:0;this.hoverBarGroup.setAttribute("cornerRadius",f)}(o=this.hoverBarLeftIcon)===null||o===void 0||o.setAttribute("visible",!1),(h=this.hoverBarRightIcon)===null||h===void 0||h.setAttribute("visible",!1);let u=!0,g=!0;if(p.type==="milestone")u=!1,g=!1;else if(typeof this._scene._gantt.parsedOptions.taskBarResizable=="function"){const f={index:a.task_index,startDate:d,endDate:c,taskRecord:p,ganttInstance:this._scene._gantt},_=this._scene._gantt.parsedOptions.taskBarResizable(f);Array.isArray(_)?[u,g]=_:(u=_,g=_)}else Array.isArray(this._scene._gantt.parsedOptions.taskBarResizable)?[u,g]=this._scene._gantt.parsedOptions.taskBarResizable:(u=this._scene._gantt.parsedOptions.taskBarResizable,g=this._scene._gantt.parsedOptions.taskBarResizable);u&&this.hoverBarLeftIcon.setAttribute("visible",!0),g&&this.hoverBarRightIcon.setAttribute("visible",!0),this.hoverBarLeftIcon&&(this.hoverBarLeftIcon.setAttribute("x",0),this.hoverBarLeftIcon.setAttribute("y",Math.ceil(s/10)),this.hoverBarLeftIcon.setAttribute("width",10),this.hoverBarLeftIcon.setAttribute("height",s-2*Math.ceil(s/10)),this.hoverBarRightIcon.setAttribute("x",i-10),this.hoverBarRightIcon.setAttribute("y",Math.ceil(s/10)),this.hoverBarRightIcon.setAttribute("width",10),this.hoverBarRightIcon.setAttribute("height",s-2*Math.ceil(s/10)))}hideHoverBar(){this.hoverBarGroup.setAttribute("visibleAll",!1)}createSelectedBorder(e,t,i,s,a,r=!1){const l=a.record,o=new M({x:e,y:t,width:i,height:s,pickable:!1,attachedToTaskBarNode:a,zIndex:1e4});o.name="task-bar-select-border",this.barContainer.appendChild(o),this.selectedBorders.push(o);const h=new M({x:0,y:0,width:i,height:s,lineWidth:this._scene._gantt.parsedOptions.taskBarSelectedStyle.borderLineWidth,pickable:!1,cornerRadius:a.attribute.cornerRadius,fill:!1,stroke:this._scene._gantt.parsedOptions.taskBarSelectedStyle.borderColor,shadowColor:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowColor,shadowOffsetX:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowOffsetX,shadowOffsetY:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowOffsetY,shadowBlur:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowBlur,angle:a.attribute.angle,anchor:[i/2,s/2]});if(o.appendChild(h),r){const d=l.type==="milestone"?15:10,c=new M({x:-d,y:0,width:10,height:s,pickable:!0}),p=new Bt({x:5,y:s/2,radius:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.radius,fill:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.fillColor,stroke:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeColor,lineWidth:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeWidth,pickable:!1});c.appendChild(p),c.name="task-bar-link-point-left",o.appendChild(c);const u=new M({x:i+(d-10),y:0,width:10,height:s,pickable:!0}),g=new Bt({x:5,y:s/2,radius:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.radius,fill:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.fillColor,stroke:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeColor,lineWidth:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeWidth,pickable:!1,pickStrokeBuffer:10});u.appendChild(g),u.name="task-bar-link-point-right",o.appendChild(u)}}removeSelectedBorder(){this.selectedBorders.forEach(e=>{e.delete()}),this.selectedBorders=[]}removeSecondSelectedBorder(){this.selectedBorders.length===2&&this.selectedBorders.pop().delete()}updateCreatingDependencyLine(e,t,i,s){this.creatingDependencyLine&&(this.creatingDependencyLine.delete(),this.creatingDependencyLine=void 0);const a=new Ut({points:[{x:e,y:t},{x:i,y:s}],stroke:this._scene._gantt.parsedOptions.dependencyLinkLineCreatingStyle.lineColor,lineWidth:this._scene._gantt.parsedOptions.dependencyLinkLineCreatingStyle.lineWidth,lineDash:this._scene._gantt.parsedOptions.dependencyLinkLineCreatingStyle.lineDash,pickable:!1});this.creatingDependencyLine=a,this.selectedBorders[0].appendChild(a)}getTaskBarNodeByIndex(e,t){let i=this.barContainer.firstChild;if(!i)return null;for(let s=0;s<this.barContainer.childrenCount;s++){if(i.task_index===e&&(!N(t)||N(t)&&i.sub_task_index===t))return i;i=i._next}return null}}class $i{constructor(e){this.markLineContainerWidth=20,this._scene=e,this.height=Math.min(e._gantt.tableNoFrameHeight,e._gantt.drawHeight)-e._gantt.getAllHeaderRowsHeight(),this.group=new M({x:0,y:e._gantt.getAllHeaderRowsHeight(),width:e._gantt.tableNoFrameWidth,height:this.height,pickable:!1,clip:!0}),this.group.name="mark-line-container",e.ganttGroup.addChild(this.group),this.markLIneContainer=new M({x:0,y:0,width:this._scene._gantt.getAllDateColsWidth(),height:this.height,pickable:!1,clip:!0}),this.group.appendChild(this.markLIneContainer),this.initMarkLines()}initMarkLines(){this._scene._gantt.parsedOptions.markLine.forEach(e=>{const t=e.style,i=this._scene._gantt.parsedOptions.timeScaleIncludeHour?j(e.date):j(e.date,!0),s=this._scene._gantt.parsedOptions.minDate,{unit:a,step:r}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],l=R(i,s,a,r),o=this._scene._gantt.parsedOptions.timelineColWidth*(Math.floor(l)+(e.position==="right"?1:e.position==="middle"?.5:0)),h=new M({pickable:!1,x:o-this.markLineContainerWidth/2,y:0,width:this.markLineContainerWidth,height:this.height});h.name="mark-line",this.markLIneContainer.appendChild(h);const d=$({pickable:!1,stroke:t.lineColor,lineWidth:t.lineWidth,lineDash:t.lineDash,points:[{x:this.markLineContainerWidth/2,y:0},{x:this.markLineContainerWidth/2,y:this.height}]});h.appendChild(d)})}refresh(){this.height=Math.min(this._scene._gantt.tableNoFrameHeight,this._scene._gantt.drawHeight)-this._scene._gantt.getAllHeaderRowsHeight(),this.markLIneContainer.removeAllChild(),this.group.setAttribute("height",this.height),this.markLIneContainer.setAttribute("height",this.height),this.initMarkLines()}setX(e){this.markLIneContainer.setAttribute("x",e)}}class qi{constructor(e){this._scene=e,this.createFrameBorder()}createFrameBorder(){var e,t,i,s,a,r;const l=this._scene.ganttGroup,o=this._scene._gantt.parsedOptions.outerFrameStyle;if(!o)return;const{cornerRadius:h,borderColor:d,borderLineWidth:c,borderLineDash:p}=o,u={},g={pickable:!1};if(c&&(g.stroke=!0,g.fill=!1,g.stroke=d,g.lineWidth=c,p&&(g.lineDash=p),g.lineCap="butt"),h&&(this._scene._gantt.taskListTableInstance?(g.cornerRadius=[0,(e=this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius)!==null&&e!==void 0?e:0,(t=this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius)!==null&&t!==void 0?t:0,0],u.cornerRadius=[0,(i=this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius)!==null&&i!==void 0?i:0,(s=this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius)!==null&&s!==void 0?s:0,0]):(g.cornerRadius=(a=this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius)!==null&&a!==void 0?a:0,u.cornerRadius=(r=this._scene._gantt.parsedOptions.outerFrameStyle.cornerRadius)!==null&&r!==void 0?r:0)),l.setAttributes(u),g.stroke){g.x=this._scene._gantt.taskListTableInstance?-c/2:c/2,g.y=c/2,g.pickable=!1,g.width=l.attribute.width+c+(this._scene._gantt.taskListTableInstance?this._scene._gantt.parsedOptions.verticalSplitLine.lineWidth:0),g.height=l.attribute.height+c/2+c/2;const f=Ve(g);f.name="border-rect",l.parent.insertAfter(f,l),l.border=f,this.border=f}}refresh(){this.border&&this.border.parent&&this.border.parent.removeChild(this.border),this.createFrameBorder()}resize(){var e;const{cornerRadius:t,borderColor:i,borderLineWidth:s,borderLineDash:a}=this._scene._gantt.parsedOptions.outerFrameStyle;(e=this.border)===null||e===void 0||e.setAttributes({width:this._scene.ganttGroup.attribute.width+s+(this._scene._gantt.taskListTableInstance?this._scene._gantt.parsedOptions.verticalSplitLine.lineWidth:0),height:this._scene._gantt.drawHeight+s})}}var Zi=function(n,e,t,i){var s,a=arguments.length,r=a<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(n,e,t,i);else for(var l=n.length-1;l>=0;l--)(s=n[l])&&(r=(a<3?s(r):a>3?s(e,t,r):s(e,t))||r);return a>3&&r&&Object.defineProperty(e,t,r),r};let Qe=class{constructor(){this.time=qt.beforeFillStroke,this.useStyle=!0,this.order=0,this.supportedAppName="vtable"}drawShape(n,e,t,i,s,a,r,l,o,h,d,c,p){n.name==="date-header-cell"&&n.forEachChildren(u=>{var g;if(u.name==="date-header-cell-text"&&u.attribute.textStick===!0){const f=u;f.setAttribute("dx",0);const _=f.globalAABBBounds,T=f.stage.globalAABBBounds,m=f.parent.globalAABBBounds,b=T.intersect(m);T.intersect(m)&&(_.width()>=b.width()&&f.attribute.last_dx?f.setAttribute("dx",(g=f.attribute.last_dx)!==null&&g!==void 0?g:0):T.x1>=_.x1?(f.setAttribute("dx",T.x1-_.x1),f.setAttribute("last_dx",T.x1-_.x1)):T.x2<=_.x2&&(f.setAttribute("dx",T.x2-_.x2),f.setAttribute("last_dx",T.x1-_.x1)))}})}};Qe=Zi([$t()],Qe);const Qi=new Zt((n,e,t,i)=>{n(Qe).toSelf().inSingletonScope(),n(Qt).toService(Qe)});class Ji{constructor(e){this._scene=e,this.createAddButton()}createAddButton(){var e;this._scene._gantt.parsedOptions.taskBarCreationCustomLayout?this.group=new M({x:0,y:0,width:100,height:100}):(this.group=new M({x:0,y:0,width:100,height:100,lineDash:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineDash,cursor:"pointer",lineWidth:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineWidth,stroke:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineColor,cornerRadius:(e=this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.cornerRadius)!==null&&e!==void 0?e:0,fill:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.backgroundColor}),this.lineVertical=$({pickable:!1,stroke:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineColor,lineWidth:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineWidth,points:[{x:50,y:0},{x:50,y:100}]}),this.group.appendChild(this.lineVertical),this.lineHorizontal=$({pickable:!1,stroke:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineColor,lineWidth:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineWidth,points:[{x:0,y:50},{x:100,y:50}]}),this.group.appendChild(this.lineHorizontal)),this.group.name="task-creation-button",this._scene.taskBar.group.addChild(this.group)}show(e,t,i,s){if(this._scene._gantt.parsedOptions.taskBarCreationCustomLayout)this.group.appendChild(this._scene._gantt.parsedOptions.taskBarCreationCustomLayout({width:i,height:s,ganttInstance:this._scene._gantt}).rootContainer);else{const a=Math.min(i,s)/6;this.lineHorizontal.setAttribute("points",[{x:(i-4*a)/2,y:s/2},{x:(i-4*a)/2+4*a,y:s/2}]),this.lineVertical.setAttribute("points",[{x:i/2,y:(s-4*a)/2},{x:i/2,y:(s-4*a)/2+4*a}])}this.group.setAttribute("x",e),this.group.setAttribute("y",t),this.group.setAttribute("width",i),this.group.setAttribute("height",s),this.group.setAttribute("visibleAll",!0)}hide(){this.group.setAttribute("visibleAll",!1),this._scene._gantt.parsedOptions.taskBarCreationCustomLayout&&this.group.removeAllChild()}}class en{constructor(e){this._scene=e,this.width=e._gantt.tableNoFrameWidth,this.height=e._gantt.gridHeight,this.group=new M({x:0,y:e._gantt.getAllHeaderRowsHeight(),width:this.width,height:this.height,pickable:!1,clip:!0}),this.group.name="dependency-link-container",e.ganttGroup.addChild(this.group),this.initLinkLines()}initLinkLines(){var e,t,i;if(Wt(this._scene._gantt.records),this.linkLinesContainer=new M({x:0,y:0,width:this._scene._gantt.getAllDateColsWidth(),height:this._scene._gantt.getAllTaskBarsHeight(),pickable:!1,clip:!0}),this.group.appendChild(this.linkLinesContainer),(e=this._scene._gantt.records)===null||e===void 0?void 0:e.length)for(let s=0;(i=s<((t=this._scene._gantt.parsedOptions.dependencyLinks)===null||t===void 0?void 0:t.length))!==null&&i!==void 0&&i;s++)this.initLinkLine(s)}initLinkLine(e){var t,i;const{taskKeyField:s,dependencyLinks:a}=this._scene._gantt.parsedOptions,r=a[e],{linkedToTaskKey:l,linkedFromTaskKey:o,type:h}=r,d=ne(this._scene._gantt.records,s,l),c=ne(this._scene._gantt.records,s,o);if(!d||!c)return;let p,u,g,f,_,T,m,b;if(d.record.vtable_gantt_linkedTo||(d.record.vtable_gantt_linkedTo=[]),d.record.vtable_gantt_linkedTo.push(r),c.record.vtable_gantt_linkedFrom||(c.record.vtable_gantt_linkedFrom=[]),c.record.vtable_gantt_linkedFrom.push(r),this._scene._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Inline?(b=c.index[0],m=d.index[0],{startDate:p,endDate:u,taskDays:g}=this._scene._gantt.getTaskInfoByTaskListIndex(d.index[0],d.index[1]),{startDate:f,endDate:_,taskDays:T}=this._scene._gantt.getTaskInfoByTaskListIndex(c.index[0],c.index[1])):this._scene._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Separate||this._scene._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact?(b=this._scene._gantt.getRowsHeightByIndex(0,c.index[0]-1)/this._scene._gantt.parsedOptions.rowHeight+(this._scene._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact?c.record.vtable_gantt_showIndex:(t=c.index[1])!==null&&t!==void 0?t:0),m=this._scene._gantt.getRowsHeightByIndex(0,d.index[0]-1)/this._scene._gantt.parsedOptions.rowHeight+(this._scene._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact?d.record.vtable_gantt_showIndex:(i=d.index[1])!==null&&i!==void 0?i:0),{startDate:p,endDate:u,taskDays:g}=this._scene._gantt.getTaskInfoByTaskListIndex(d.index[0],d.index[1]),{startDate:f,endDate:_,taskDays:T}=this._scene._gantt.getTaskInfoByTaskListIndex(c.index[0],c.index[1])):(b=this._scene._gantt.getTaskShowIndexByRecordIndex(c.index),m=this._scene._gantt.getTaskShowIndexByRecordIndex(d.index),{startDate:p,endDate:u,taskDays:g}=this._scene._gantt.getTaskInfoByTaskListIndex(m),{startDate:f,endDate:_,taskDays:T}=this._scene._gantt.getTaskInfoByTaskListIndex(b)),!T||!g)return;j(this._scene._gantt.parsedOptions.minDate);const{arrowPoints:x,linePoints:k}=tn(h,f,_,b,T,c.record.type==="milestone",p,u,m,g,d.record.type==="milestone",this._scene._gantt),y=this._scene._gantt.parsedOptions.dependencyLinkLineStyle,B=$({pickable:!0,stroke:y.lineColor,lineWidth:y.lineWidth,lineDash:y.lineDash,points:k,pickStrokeBuffer:3,vtable_link:r});this.linkLinesContainer.appendChild(B),r.vtable_gantt_linkLineNode=B;const C=new Jt({fill:y.lineColor,points:x});this.linkLinesContainer.appendChild(C),r.vtable_gantt_linkArrowNode=C}setX(e){this.linkLinesContainer.setAttribute("x",e)}setY(e){this.linkLinesContainer.setAttribute("y",e)}refresh(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttributes({height:this.height,width:this.width,y:this._scene._gantt.getAllHeaderRowsHeight()});const e=this.linkLinesContainer.attribute.x,t=this.linkLinesContainer.attribute.y;this.linkLinesContainer.removeAllChild(),this.group.removeChild(this.linkLinesContainer),this.initLinkLines(),this.setX(e),this.setY(t)}resize(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttribute("width",this.width),this.group.setAttribute("height",this.height)}createSelectedLinkLine(e){const t=e.vtable_gantt_linkLineNode,i=e.vtable_gantt_linkArrowNode,s=t.clone(),a=i.clone();s.setAttribute("stroke",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.lineColor),s.setAttribute("lineWidth",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.lineWidth),s.setAttribute("shadowColor",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowColor),s.setAttribute("shadowOffsetX",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowOffset),s.setAttribute("shadowOffsetY",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowOffset),s.setAttribute("shadowBlur",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowBlur),this.linkLinesContainer.appendChild(s),a.setAttribute("fill",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.lineColor),this.linkLinesContainer.appendChild(a),this.selectedEffectNodes=[s,a]}removeSelectedLinkLine(){var e;(e=this.selectedEffectNodes)===null||e===void 0||e.forEach(t=>{t.delete()}),this.selectedEffectNodes=[]}deleteLink(e){const t=e.vtable_gantt_linkLineNode,i=e.vtable_gantt_linkArrowNode;t.delete(),i.delete()}}function tn(n,e,t,i,s,a,r,l,o,h,d,c){const{unit:p,step:u}=c.parsedOptions.reverseSortedTimelineScales[0],{minDate:g,rowHeight:f,timelineColWidth:_}=c.parsedOptions,T=c.parsedOptions.taskBarMilestoneHypotenuse;let m=[],b=[];if(n===Y.FinishToStart){let x=R(t,g,p,u,1)*_;a&&(x=R(e,g,p,u,1)*_+T/2);let k=R(r,g,p,u)*_;d&&(k-=T/2),m=[{x,y:f*(i+.5)},{x:x+20,y:f*(i+.5)},{x:x+20,y:f*(i+(i>o?0:1))},{x:k-20,y:f*(i+(i>o?0:1))},{x:k-20,y:f*(o+.5)},{x:k,y:f*(o+.5)}],x+20<=k-20&&m.splice(2,3,{x:x+20,y:f*(o+.5)});const y=m[m.length-1];b=[{x:y.x,y:y.y},{x:y.x-10,y:y.y-5},{x:y.x-10,y:y.y+5},{x:y.x,y:y.y}]}else if(n===Y.StartToFinish){let x=R(e,g,p,u)*_;a&&(x-=T/2);let k=R(l,g,p,u,1)*_;d&&(k=R(r,g,p,u,1)*_+T/2),m=[{x,y:f*(i+.5)},{x:x-20,y:f*(i+.5)},{x:x-20,y:f*(i+(i>o?0:1))},{x:k+20,y:f*(i+(i>o?0:1))},{x:k+20,y:f*(o+.5)},{x:k,y:f*(o+.5)}],x-20>=k+20&&m.splice(2,3,{x:x-20,y:f*(o+.5)});const y=m[m.length-1];b=[{x:y.x,y:y.y},{x:y.x+10,y:y.y-5},{x:y.x+10,y:y.y+5},{x:y.x,y:y.y}]}else if(n===Y.StartToStart){let x=R(e,g,p,u)*_;a&&(x-=T/2);let k=R(r,g,p,u)*_;d&&(k-=T/2),m=[{x,y:f*(i+.5)},{x:(i===o?x:Math.min(x,k))-20,y:f*(i+.5)},{x:(i===o?x:Math.min(x,k))-20,y:f*(o+(i===o?1:.5))},{x:k-20,y:f*(o+(i===o?1:.5))},{x:(i===o?k:Math.min(x,k))-20,y:f*(o+.5)},{x:k,y:f*(o+.5)}];const y=m[m.length-1];b=[{x:y.x,y:y.y},{x:y.x-10,y:y.y-5},{x:y.x-10,y:y.y+5},{x:y.x,y:y.y}]}else if(n===Y.FinishToFinish){let x=R(t,g,p,u,1)*_;a&&(x=R(e,g,p,u,1)*_+T/2);let k=R(l,g,p,u,1)*_;d&&(k=R(r,g,p,u,1)*_+T/2),m=[{x,y:f*(i+.5)},{x:(i===o?x:Math.max(x,k))+20,y:f*(i+.5)},{x:(i===o?x:Math.max(x,k))+20,y:f*(o+(i===o?1:.5))},{x:k+20,y:f*(o+(i===o?1:.5))},{x:k+20,y:f*(o+.5)},{x:k,y:f*(o+.5)}];const y=m[m.length-1];b=[{x:y.x,y:y.y},{x:y.x+10,y:y.y-5},{x:y.x+10,y:y.y+5},{x:y.x,y:y.y}]}return{linePoints:m,arrowPoints:b}}function Ht(n,e,t,i,s,a,r,l,o,h,d,c,p,u,g,f){const{unit:_,step:T}=f.parsedOptions.reverseSortedTimelineScales[0],{minDate:m,rowHeight:b,timelineColWidth:x}=f.parsedOptions,k=f.parsedOptions.taskBarMilestoneHypotenuse,y=f.parsedOptions.taskBarMilestoneStyle.width;let B=[],C=[];if(n===Y.FinishToStart){let O=r?r.attribute.x+r.attribute.width:R(t,m,_,T,1)*x;a&&(O=r?r.attribute.x+r.attribute.width+(k-y)/2:R(e,m,_,T,1)*x+k/2);let w=u?u.attribute.x:R(o,m,_,T)*x;p&&(w-=(k-y)/2),B=[{x:O,y:b*(i+.5)+l},{x:O+20,y:b*(i+.5)+l},{x:O+20,y:b*(i+(i>d?0:1))+l},{x:w-20,y:b*(i+(i>d?0:1))+l},{x:w-20,y:b*(d+.5)+g},{x:w,y:b*(d+.5)+g}],O+20<=w-20&&B.splice(2,3,{x:O+20,y:b*(d+.5)+g});const v=B[B.length-1];C=[{x:v.x,y:v.y},{x:v.x-10,y:v.y-5},{x:v.x-10,y:v.y+5},{x:v.x,y:v.y}]}else if(n===Y.StartToFinish){let O=r?r.attribute.x:R(e,m,_,T)*x;a&&(O-=(k-y)/2);let w=u?u.attribute.x+u.attribute.width:R(h,m,_,T,1)*x;p&&(w=u?u.attribute.x+u.attribute.width+(k-y)/2:R(o,m,_,T,1)*x+k/2),B=[{x:O,y:b*(i+.5)+l},{x:O-20,y:b*(i+.5)+l},{x:O-20,y:b*(i+(i>d?0:1))+l},{x:w+20,y:b*(i+(i>d?0:1))+l},{x:w+20,y:b*(d+.5)+g},{x:w,y:b*(d+.5)+g}],O-20>=w+20&&B.splice(2,3,{x:O-20,y:b*(d+.5)+g});const v=B[B.length-1];C=[{x:v.x,y:v.y},{x:v.x+10,y:v.y-5},{x:v.x+10,y:v.y+5},{x:v.x,y:v.y}]}else if(n===Y.StartToStart){let O=r?r.attribute.x:R(e,m,_,T)*x;a&&(O-=(k-y)/2);let w=u?u.attribute.x:R(o,m,_,T)*x;p&&(w-=(k-y)/2),B=[{x:O,y:b*(i+.5)+l},{x:(i===d?O:Math.min(O,w))-20,y:b*(i+.5)+l},{x:(i===d?O:Math.min(O,w))-20,y:b*(d+(i===d?1:.5))+g},{x:w-20,y:b*(d+(i===d?1:.5))+g},{x:(i===d?w:Math.min(O,w))-20,y:b*(d+.5)+g},{x:w,y:b*(d+.5)+g}];const v=B[B.length-1];C=[{x:v.x,y:v.y},{x:v.x-10,y:v.y-5},{x:v.x-10,y:v.y+5},{x:v.x,y:v.y}]}else if(n===Y.FinishToFinish){let O=r?r.attribute.x+r.attribute.width:R(t,m,_,T,1)*x;a&&(O=r?r.attribute.x+r.attribute.width+(k-y)/2:R(e,m,_,T,1)*x+k/2);let w=u?u.attribute.x+u.attribute.width:R(h,m,_,T,1)*x;p&&(w=u?u.attribute.x+u.attribute.width+(k-y)/2:R(o,m,_,T,1)*x+k/2),B=[{x:O,y:b*(i+.5)+l},{x:(i===d?O:Math.max(O,w))+20,y:b*(i+.5)+l},{x:(i===d?O:Math.max(O,w))+20,y:b*(d+(i===d?1:.5))+g},{x:w+20,y:b*(d+(i===d?1:.5))+g},{x:w+20,y:b*(d+.5)+g},{x:w,y:b*(d+.5)+g}];const v=B[B.length-1];C=[{x:v.x,y:v.y},{x:v.x+10,y:v.y-5},{x:v.x+10,y:v.y+5},{x:v.x,y:v.y}]}return{linePoints:B,arrowPoints:C}}class nn{constructor(e){this._scene=e,this.dragLineContainer=new M({x:0,y:0,width:e._gantt.tableNoFrameWidth,height:Math.min(e._gantt.tableNoFrameHeight,e._gantt.drawHeight),pickable:!1,clip:!0,visible:!1}),this.dragLineContainer.name="drag-order-line-container",e.ganttGroup.addChild(this.dragLineContainer),this.initDragLine()}initDragLine(){if(this._scene._gantt.taskListTableInstance){const e=this._scene._gantt.taskListTableInstance.theme.dragHeaderSplitLine,t=$({pickable:!1,stroke:e.lineColor,lineWidth:e.lineWidth,points:[]});this.dragLine=t,this.dragLineContainer.appendChild(t)}}showDragLine(e){this.dragLineContainer.showAll(),this.dragLine.setAttribute("points",[{x:0,y:e},{x:this._scene._gantt.tableNoFrameWidth,y:e}])}hideDragLine(){this.dragLineContainer.hideAll()}}ei.load(Qi);class sn{constructor(e){let t,i;this._gantt=e,this.tableGroupWidth=e.tableNoFrameWidth,this.tableGroupHeight=Math.min(e.tableNoFrameHeight,e.drawHeight),F.mode==="node"||(Re.setEnv("browser"),t=e.canvas.width,i=e.canvas.height),this.stage=ti({canvas:e.canvas,width:t,height:i,disableDirtyBounds:!1,background:e.parsedOptions.underlayBackgroundColor,enableLayout:!0,autoRender:!1,context:{appName:"vtable"},pluginList:["poptipForText"]}),this.stage.gantt=this._gantt,this.stage.table=this._gantt,this.stage.defaultLayer.setTheme({group:{boundsPadding:0,strokeBoundsBuffer:0,lineJoin:"round"},text:{ignoreBuf:!0}}),this.initSceneGraph()}initSceneGraph(){this.ganttGroup=new M({x:this._gantt.tableX,y:this._gantt.tableY,width:this.tableGroupWidth,height:this.tableGroupHeight,clip:!0,pickable:!1}),this.stage.defaultLayer.add(this.ganttGroup),this.ganttGroup.name="table",this.timelineHeader=new Vi(this),this.grid=new pi(this),this.dependencyLink=new en(this),this.taskBar=new Ui(this),this.markLine=new $i(this),this.frameBorder=new qi(this),this.scrollbarComponent=new fi(this._gantt),this.stage.defaultLayer.addChild(this.scrollbarComponent.hScrollBar),this.stage.defaultLayer.addChild(this.scrollbarComponent.vScrollBar),this.dragOrderLine=new nn(this)}updateSceneGraph(){const e=this._gantt;let t,i;this.tableGroupWidth=e.tableNoFrameWidth,this.tableGroupHeight=Math.min(e.tableNoFrameHeight,e.drawHeight),F.mode==="node"||(Re.setEnv("browser"),t=e.canvas.width,i=e.canvas.height),this.stage.resize(t,i),this.refreshAll()}afterCreateSceneGraph(){this.scrollbarComponent.updateScrollBar(),Mi(this._gantt.eventManager)}refreshAll(){this.tableGroupHeight=Math.min(this._gantt.tableNoFrameHeight,this._gantt.drawHeight),this.tableGroupWidth=this._gantt.tableNoFrameWidth,this.ganttGroup.setAttribute("height",this.tableGroupHeight),this.ganttGroup.setAttribute("width",this.tableGroupWidth),this.timelineHeader.refresh(),this.grid.refresh(),this.taskBar.refresh(),this.dependencyLink.refresh(),this.markLine.refresh(),this.dependencyLink.refresh(),this.frameBorder.refresh(),this.scrollbarComponent.updateScrollBar(),this.updateNextFrame()}refreshTaskBars(){this.dependencyLink.refresh(),this.taskBar.refresh(),this.updateNextFrame()}refreshTaskBarsAndGrid(){this._gantt.verticalSplitResizeLine.style.height=this._gantt.drawHeight+"px",this.tableGroupHeight=Math.min(this._gantt.tableNoFrameHeight,this._gantt.drawHeight),this.ganttGroup.setAttribute("height",this.tableGroupHeight),this.grid.refresh(),this.taskBar.refresh(),this.dependencyLink.refresh(),this.markLine.refresh(),this.frameBorder.resize(),this.scrollbarComponent.updateScrollBar(),this.updateNextFrame()}updateTableSize(){this.tableGroupHeight=Math.min(this._gantt.tableNoFrameHeight,this._gantt.drawHeight),this.tableGroupWidth=this._gantt.tableNoFrameWidth,this.ganttGroup.setAttributes({x:this._gantt.tableX,y:this._gantt.tableY,width:this._gantt.tableNoFrameWidth,height:this.tableGroupHeight}),this.grid.resize(),this.taskBar.resize(),this.markLine.refresh(),this.frameBorder.resize()}updateStageBackground(){this.stage.background=this._gantt.parsedOptions.underlayBackgroundColor,this.updateNextFrame()}renderSceneGraph(){this.stage.render()}updateNextFrame(){this.stage.renderNextFrame()}get width(){var e,t;return(t=(e=this.ganttGroup.attribute)===null||e===void 0?void 0:e.width)!==null&&t!==void 0?t:0}get height(){var e,t;return(t=(e=this.ganttGroup.attribute)===null||e===void 0?void 0:e.height)!==null&&t!==void 0?t:0}get x(){var e,t;return(t=(e=this.ganttGroup.attribute)===null||e===void 0?void 0:e.x)!==null&&t!==void 0?t:0}get y(){var e,t;return(t=(e=this.ganttGroup.attribute)===null||e===void 0?void 0:e.y)!==null&&t!==void 0?t:0}setX(e,t=!1){this.timelineHeader.setX(e),this.grid.setX(e),this.taskBar.setX(e),this.dependencyLink.setX(e),this.markLine.setX(e),this.updateNextFrame()}setY(e,t=!1){this.grid.setY(e),this.taskBar.setY(e),this.dependencyLink.setY(e),this.updateNextFrame()}setPixelRatio(e){this.stage.disableDirtyBounds(),this.stage.window.setDpr(e),this.stage.render(),this.stage.enableDirtyBounds()}resize(){this.updateTableSize(),this.scrollbarComponent.updateScrollBar(),this.updateNextFrame()}release(){this.stage.release()}showTaskCreationButton(e,t,i){this.taskCreationButton||(this.taskCreationButton=new Ji(this._gantt.scenegraph)),this.taskCreationButton.show(e,t,this._gantt.getDateColWidth(i),this._gantt.parsedOptions.rowHeight),this.updateNextFrame()}hideTaskCreationButton(){this.taskCreationButton&&(this.taskCreationButton.hide(),this.updateNextFrame())}refreshRecordLinkNodes(e,t,i,s=0){const a=this._gantt,r=a.getRecordByIndex(e,t),l=r.vtable_gantt_linkedTo,o=r.vtable_gantt_linkedFrom;for(let h=0;h<(l==null?void 0:l.length);h++){const d=l[h],c=d.vtable_gantt_linkLineNode,p=d.vtable_gantt_linkArrowNode,{linkedToTaskKey:u,linkedFromTaskKey:g,type:f}=d,{taskKeyField:_,minDate:T}=a.parsedOptions,m=ne(a.records,_,g),b=ne(a.records,_,u);let x,k,y,B,C,O,w,v,H;if(a.parsedOptions.tasksShowMode===L.Sub_Tasks_Inline){const W=J(i.attribute.y+s,a);v=m.index[0],w=a.getRowsHeightByIndex(0,W.task_index-1)/a.parsedOptions.rowHeight,{startDate:x,endDate:k,taskDays:y}=a.getTaskInfoByTaskListIndex(b.index[0],b.index[1]),{startDate:B,endDate:C,taskDays:O}=a.getTaskInfoByTaskListIndex(m.index[0],m.index[1]);const E=a.parsedOptions.taskBarStyle.width;H=i.attribute.y+E/2-(w+.5)*a.parsedOptions.rowHeight}else if(a.parsedOptions.tasksShowMode===L.Sub_Tasks_Separate||a.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||a.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact){const W=J(i.attribute.y+s,a);v=a.getRowsHeightByIndex(0,m.index[0]-1)/a.parsedOptions.rowHeight+(a.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||a.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact?m.record.vtable_gantt_showIndex:m.index[1]),w=a.getRowsHeightByIndex(0,W.task_index-1)/a.parsedOptions.rowHeight+(a.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||a.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact?b.record.vtable_gantt_showIndex:W.sub_task_index),{startDate:x,endDate:k,taskDays:y}=a.getTaskInfoByTaskListIndex(b.index[0],b.index[1]),{startDate:B,endDate:C,taskDays:O}=a.getTaskInfoByTaskListIndex(m.index[0],m.index[1]);const E=a.parsedOptions.taskBarStyle.width;H=i.attribute.y+E/2-(w+.5)*a.parsedOptions.rowHeight}else{if(v=a.getTaskShowIndexByRecordIndex(m.index),w=a.getTaskShowIndexByRecordIndex(b.index),v===-1||w===-1)continue;({startDate:x,endDate:k,taskDays:y}=a.getTaskInfoByTaskListIndex(w)),{startDate:B,endDate:C,taskDays:O}=a.getTaskInfoByTaskListIndex(v)}if(!(B&&C&&x&&k&&c&&p))return;const{linePoints:P,arrowPoints:G}=Ht(f,B,C,v,O,m.record.type==="milestone",null,0,x,k,w,y,b.record.type==="milestone",i,H??0,this._gantt);c.setAttribute("points",P),p.setAttribute("points",G)}for(let h=0;h<(o==null?void 0:o.length);h++){const d=o[h],c=d.vtable_gantt_linkLineNode,p=d.vtable_gantt_linkArrowNode,{linkedToTaskKey:u,linkedFromTaskKey:g,type:f}=d,{taskKeyField:_,minDate:T}=a.parsedOptions,m=ne(a.records,_,u),b=ne(a.records,_,g);let x,k,y,B,C,O,w,v,H;if(a.parsedOptions.tasksShowMode===L.Sub_Tasks_Inline){const W=J(i.attribute.y+s,a);v=a.getRowsHeightByIndex(0,W.task_index-1)/a.parsedOptions.rowHeight,w=m.index[0],{startDate:x,endDate:k,taskDays:y}=a.getTaskInfoByTaskListIndex(m.index[0],m.index[1]),{startDate:B,endDate:C,taskDays:O}=a.getTaskInfoByTaskListIndex(b.index[0],b.index[1]);const E=a.parsedOptions.taskBarStyle.width;H=i.attribute.y+E/2-(v+.5)*a.parsedOptions.rowHeight}else if(a.parsedOptions.tasksShowMode===L.Sub_Tasks_Separate||a.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||a.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact){const W=J(i.attribute.y+s,a);v=a.getRowsHeightByIndex(0,W.task_index-1)/a.parsedOptions.rowHeight+(a.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||a.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact?b.record.vtable_gantt_showIndex:W.sub_task_index),w=a.getRowsHeightByIndex(0,m.index[0]-1)/a.parsedOptions.rowHeight+(a.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||a.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact?m.record.vtable_gantt_showIndex:m.index[1]),{startDate:x,endDate:k,taskDays:y}=a.getTaskInfoByTaskListIndex(m.index[0],m.index[1]),{startDate:B,endDate:C,taskDays:O}=a.getTaskInfoByTaskListIndex(b.index[0],b.index[1]);const E=a.parsedOptions.taskBarStyle.width;H=i.attribute.y+E/2-(v+.5)*a.parsedOptions.rowHeight}else{if(v=a.getTaskShowIndexByRecordIndex(b.index),w=a.getTaskShowIndexByRecordIndex(m.index),v===-1||w===-1)continue;({startDate:x,endDate:k,taskDays:y}=a.getTaskInfoByTaskListIndex(w)),{startDate:B,endDate:C,taskDays:O}=a.getTaskInfoByTaskListIndex(v)}if(!(B&&C&&x&&k&&c&&p))return;const{linePoints:P,arrowPoints:G}=Ht(f,B,C,v,O,b.record.type==="milestone",i,H??0,x,k,w,y,m.record.type==="milestone",null,0,this._gantt);c.setAttribute("points",P),p.setAttribute("points",G)}}}const an=n=>{switch(Object.prototype.toString.call(n)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}},rn=(n,e)=>an(n)===e,ln=n=>rn(n,"object");function Rt(n,e,t){let i,s,a,r,l,o,h=0,d=!1,c=!1,p=!0;const u=!e&&e!==0&&typeof requestAnimationFrame=="function";if(typeof n!="function")throw new TypeError("Expected a function");function g(m){const b=i,x=s;return s=void 0,i=void 0,h=m,r=n.apply(x,b),r}function f(m,b){return u?requestAnimationFrame(m):setTimeout(m,b)}function _(m){const b=m-o;return o===void 0||b>=e||b<0||d&&m-h>=a}function T(){const m=Date.now();if(_(m))return function(b){return l=void 0,p&&i?g(b):(s=void 0,i=void 0,r)}(m);l=f(T,function(b){const x=b-h,k=e&&-(b-o);return d?Math.min(k,a-x):k}(m))}return e=+e||0,ln(t)&&(c=!!t.leading,d="maxWait"in t,d&&(a=Math.max(+t.maxWait||0,e)),p="trailing"in t?!!t.trailing:p),function(...m){const b=Date.now(),x=_(b);if(i=m,s=this,o=b,x){if(l===void 0)return function(k){return h=k,l=f(T,e),c?g(k):r}(o);if(d)return l=f(T,e),g(o)}return l===void 0&&(l=f(T,e)),r}}let on=1;class dn{constructor(e,t,i){var s;if(this.resizeTime=100,this.lastSize={width:0,height:0},this.mutationResize=()=>{this.onResize()},this.callBack=()=>{const a=this.getSize();let r=!1;a.width===this.lastSize.width&&a.height===this.lastSize.height&&(r=!0),this.lastSize=a,this.cb&&this.cb(Object.assign(Object.assign({},this.lastSize),{windowSizeNotChange:r}))},this.onResize=()=>{this.callBackDebounce()},this.element=e,this.cb=t,this.lastSize=this.getSize(),i&&(this.resizeTime=Math.max(i,16)),this.callBackDebounce=Rt(this.callBack,this.resizeTime),window==null||window.addEventListener("resize",this.onResize),"ResizeObserver"in window){const a=window.ResizeObserver;this.observer=new a(this.mutationResize),(s=this.observer)===null||s===void 0||s.observe(this.element)}else"MutationObserver"in window&&(this.observer=new MutationObserver(this.mutationResize),this.observer.observe(this.element,{attributes:!0,attributeFilter:["style"]}))}disConnect(){window.removeEventListener("resize",this.onResize),this.observer&&(this.observer.disconnect(),this.observer=void 0)}setSize(e){this.lastSize=e}checkSize(){const e=this.getSize();return e.width!==this.lastSize.width||e.height!==this.lastSize.height}getSize(){return this.element?{width:Math.floor(this.element.clientWidth),height:Math.floor(this.element.clientHeight)}:Object.assign({},this.lastSize)}}class hn{constructor(){this.listeners={},this.reseizeListeners={}}on(e,t,i,...s){if(F.mode==="node")return-1;const a=on++;if(e!=null&&e.addEventListener)if(t!=="resize"||e===window)e==null||e.addEventListener(t,i,...s);else{const l=new dn(e,i,this.resizeTime);this.reseizeListeners[a]=l}const r={target:e,type:t,listener:i,options:s};return this.listeners[a]=r,a}once(e,t,i,...s){if(F.mode==="node")return-1;const a=this.on(e,t,(...r)=>{this.off(a),i(...r)},...s);return a}off(e){var t;if(F.mode==="node"||e==null)return;const i=(t=this.listeners)===null||t===void 0?void 0:t[e];i&&(delete this.listeners[e],i.target.removeEventListener&&i.target.removeEventListener(i.type,i.listener,...i.options))}fire(e,t,...i){if(F.mode!=="node")for(const s in this.listeners){const a=this.listeners[s];a.target===e&&a.type===t&&a.listener.call(a.target,...i)}}hasListener(e,t){if(F.mode==="node")return!1;let i=!1;for(const s in this.listeners){const a=this.listeners[s];a.target===e&&a.type===t&&(i=!0)}return i}clear(){if(F.mode!=="node"){for(const e in this.listeners){const t=this.listeners[e];t.target.removeEventListener&&t.target.removeEventListener(t.type,t.listener,...t.options)}for(const e in this.reseizeListeners){const t=this.reseizeListeners[e];t==null||t.disConnect()}this.listeners={}}}release(){F.mode!=="node"&&(this.clear(),this.listeners={})}}let Ee=1;function Ft(){return Wi?Ee=1:(Ee=Math.ceil(window.devicePixelRatio||1),Ee>1&&Ee%2!=0&&(Ee+=1)),Ee}Ft();class cn{constructor(e){this.isDown=!1,this.isDraging=!1,this.globalEventListeners=[],this._gantt=e,this._eventHandler=new hn,this.bindEvent()}release(){this._eventHandler.release(),this.globalEventListeners.forEach(e=>{e.env==="document"?document.removeEventListener(e.name,e.callback):e.env==="body"?document.body.removeEventListener(e.name,e.callback):e.env==="window"&&window.removeEventListener(e.name,e.callback)}),this.globalEventListeners=[]}bindEvent(){un(this),pn(this)}}function un(n){const e=n._gantt.scenegraph,t=n._gantt,i=t.stateManager;e.ganttGroup.addEventListener("pointerdown",s=>{if(s.button!==0)return;let a,r,l;if(s.detailPath.find(o=>o.name==="task-bar"?(a=o,!0):o.name==="task-creation-button"?!0:o.name==="task-bar-link-point-left"?(r=o,!0):o.name==="task-bar-link-point-right"?(l=o,!0):!!o.attribute.vtable_link&&(o.attribute.vtable_link,!0)),a){if(s.target.name==="task-bar-hover-shadow-left-icon")i.startResizeTaskBar(a,s.nativeEvent.x,s.nativeEvent.y,s.offset.y,"left"),i.updateInteractionState(I.grabing);else if(s.target.name==="task-bar-hover-shadow-right-icon")i.startResizeTaskBar(a,s.nativeEvent.x,s.nativeEvent.y,s.offset.y,"right"),i.updateInteractionState(I.grabing);else if(t.parsedOptions.taskBarMoveable){let o=!0;if(typeof t.parsedOptions.taskBarMoveable=="function"){const{startDate:h,endDate:d,taskRecord:c}=e._gantt.getTaskInfoByTaskListIndex(a.task_index,a.sub_task_index),p={index:a.task_index,startDate:h,endDate:d,taskRecord:c,ganttInstance:e._gantt};o=t.parsedOptions.taskBarMoveable(p)}else o=t.parsedOptions.taskBarMoveable;o&&(i.startMoveTaskBar(a,s.nativeEvent.x,s.nativeEvent.y,s.offset.y),i.updateInteractionState(I.grabing))}}else r?(i.startCreateDependencyLine(r,s.nativeEvent.x,s.nativeEvent.y,s.offset.y,"left"),i.updateInteractionState(I.grabing)):l&&(i.startCreateDependencyLine(l,s.nativeEvent.x,s.nativeEvent.y,s.offset.y,"right"),i.updateInteractionState(I.grabing))}),e.ganttGroup.addEventListener("pointermove",s=>{var a,r,l,o;if(i.interactionState===I.default){const h=s.detailPath.find(d=>d.name==="task-bar");if(h){if(e._gantt.stateManager.hoverTaskBar.target!==h&&(e._gantt.stateManager.hoverTaskBar.target=h,i.showTaskBarHover(),e._gantt.hasListeners(z.MOUSEENTER_TASK_BAR))){const d=h.task_index,c=h.sub_task_index,p=e._gantt.getRecordByIndex(d,c);e._gantt.fireListeners(z.MOUSEENTER_TASK_BAR,{federatedEvent:s,event:s.nativeEvent,index:d,sub_task_index:c,record:p})}}else{if(e._gantt.stateManager.hoverTaskBar.target){if(e._gantt.hasListeners(z.MOUSELEAVE_TASK_BAR)){const d=e._gantt.stateManager.hoverTaskBar.target.task_index,c=e._gantt.stateManager.hoverTaskBar.target.sub_task_index,p=e._gantt.getRecordByIndex(d,c);e._gantt.fireListeners(z.MOUSELEAVE_TASK_BAR,{federatedEvent:s,event:s.nativeEvent,index:d,sub_task_index:c,record:p})}i.hideTaskBarHover(s)}if(t.parsedOptions.taskBarCreatable){const d=J(s.offset.y-t.headerHeight+t.stateManager.scrollTop,t),c=t.getTaskInfoByTaskListIndex(d.task_index,d.sub_task_index);let p=!0;if(typeof t.parsedOptions.taskBarCreatable=="function"){const{startDate:u,endDate:g,taskRecord:f}=c,_={index:d.task_index,sub_task_index:d.sub_task_index,startDate:u,endDate:g,taskRecord:f,ganttInstance:t};p=t.parsedOptions.taskBarCreatable(_)}else p=t.parsedOptions.taskBarCreatable;if(p){const u=Yi(s.offset.x,s.offset.y,t);if((t.parsedOptions.tasksShowMode===L.Sub_Tasks_Separate||t.parsedOptions.tasksShowMode===L.Tasks_Separate)&&!c.taskDays&&c.taskRecord&&!c.taskRecord.vtableMerge||(t.parsedOptions.tasksShowMode===L.Sub_Tasks_Inline||t.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||t.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact)&&!u){const g=Fe(s.offset.x,t),f=(g>=1?t.getDateColsWidth(0,g-1):0)-t.stateManager.scroll.horizontalBarPos,_=t.taskListTableInstance.getRowsHeight(t.taskListTableInstance.columnHeaderLevelCount,d.task_index+t.taskListTableInstance.columnHeaderLevelCount-1)+((a=d.sub_task_index)!==null&&a!==void 0?a:0)*t.parsedOptions.rowHeight-t.stateManager.scroll.verticalBarPos;return void t.scenegraph.showTaskCreationButton(f,_,g)}}}}t.scenegraph.hideTaskCreationButton()}else if(i.interactionState===I.grabing){let h,d,c;s.detailPath.find(p=>p.name==="task-bar"?(h=p,!0):p.name==="task-creation-button"?!0:p.name==="task-bar-link-point-left"?(d=p,!0):p.name==="task-bar-link-point-right"?(c=p,!0):!!p.attribute.vtable_link&&(p.attribute.vtable_link,!0)),h=(l=h??((r=d==null?void 0:d.parent)===null||r===void 0?void 0:r.attribute.attachedToTaskBarNode))!==null&&l!==void 0?l:(o=c==null?void 0:c.parent)===null||o===void 0?void 0:o.attribute.attachedToTaskBarNode,e._gantt.stateManager.isCreatingDependencyLine()&&!h?i.hideSecondTaskBarSelectedBorder():e._gantt.stateManager.isCreatingDependencyLine()&&d&&e._gantt.stateManager.selectedTaskBar.target!==h?(i.highlightLinkPointNode(d),i.creatingDenpendencyLink.lastHighLightLinkPoint=d,i.creatingDenpendencyLink.secondTaskBarPosition="left"):e._gantt.stateManager.isCreatingDependencyLine()&&c&&e._gantt.stateManager.selectedTaskBar.target!==h?(i.highlightLinkPointNode(c),i.creatingDenpendencyLink.lastHighLightLinkPoint=c,i.creatingDenpendencyLink.secondTaskBarPosition="right"):e._gantt.stateManager.isCreatingDependencyLine()&&h&&e._gantt.stateManager.selectedTaskBar.target!==h&&(i.unhighlightLinkPointNode(i.creatingDenpendencyLink.lastHighLightLinkPoint),i.creatingDenpendencyLink.secondTaskBarNode&&i.creatingDenpendencyLink.secondTaskBarNode===h||(i.creatingDenpendencyLink.secondTaskBarNode&&i.creatingDenpendencyLink.secondTaskBarNode!==h&&i.hideSecondTaskBarSelectedBorder(),i.creatingDenpendencyLink.secondTaskBarNode=h,i.showSecondTaskBarSelectedBorder()))}}),e.ganttGroup.addEventListener("pointerup",s=>{var a,r;if(s.button===0){let l,o=!1,h=!1,d=!1,c=!1,p=!1;const u=s.detailPath.find(g=>g.name==="task-bar"?(o=!0,!0):g.name==="task-creation-button"?(h=!0,!1):g.name==="task-bar-link-point-left"?(c=!0,!1):g.name==="task-bar-link-point-right"?(p=!0,!1):!!g.attribute.vtable_link&&(d=!0,l=g.attribute.vtable_link,!1));if(o&&e._gantt.parsedOptions.taskBarSelectable&&n.poniterState==="down"){if(i.hideDependencyLinkSelectedLine(),i.showTaskBarSelectedBorder(u),t.hasListeners(z.CLICK_TASK_BAR)){const g=u.task_index,f=u.sub_task_index,_=t.getRecordByIndex(g,f);t.fireListeners(z.CLICK_TASK_BAR,{federatedEvent:s,event:s.nativeEvent,index:g,sub_task_index:f,record:_})}}else if(h&&n.poniterState==="down"){i.hideDependencyLinkSelectedLine(),i.hideTaskBarSelectedBorder();const g=J(s.offset.y-t.headerHeight+t.stateManager.scrollTop,t);if(t.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||t.parsedOptions.tasksShowMode===L.Sub_Tasks_Inline||t.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact){if(t.hasListeners(z.CREATE_TASK_SCHEDULE)){const f=Fe(s.offset.x,t),_=t.getDateRangeByIndex(f),T=(a=t.parsedOptions.dateFormat)!==null&&a!==void 0?a:t.parsedOptions.timeScaleIncludeHour?"yyyy-mm-dd hh:mm:ss":"yyyy-mm-dd";t.fireListeners(z.CREATE_TASK_SCHEDULE,{federatedEvent:s,event:s.nativeEvent,index:g.task_index,sub_task_index:g.sub_task_index,startDate:ie(_.startDate,T),endDate:ie(_.endDate,T),record:void 0,parentRecord:t.getRecordByIndex(g.task_index)})}}else{const f=t.getTaskInfoByTaskListIndex(g.task_index,g.sub_task_index);if(f.taskRecord){const _=(r=t.parsedOptions.dateFormat)!==null&&r!==void 0?r:t.parsedOptions.timeScaleIncludeHour?"yyyy-mm-dd hh:mm:ss":"yyyy-mm-dd",T=Fe(s.offset.x,t),m=t.getDateRangeByIndex(T);f.taskRecord[t.parsedOptions.startDateField]=ie(m.startDate,_),f.taskRecord[t.parsedOptions.endDateField]=ie(m.endDate,_),t.scenegraph.hideTaskCreationButton(),t.updateTaskRecord(f.taskRecord,g.task_index,g.sub_task_index),t.hasListeners(z.CREATE_TASK_SCHEDULE)&&t.fireListeners(z.CREATE_TASK_SCHEDULE,{federatedEvent:s,event:s.nativeEvent,index:g.task_index,sub_task_index:g.sub_task_index,startDate:f.taskRecord[t.parsedOptions.startDateField],endDate:f.taskRecord[t.parsedOptions.endDateField],record:f.taskRecord})}}}else if(d&&e._gantt.parsedOptions.dependencyLinkSelectable&&n.poniterState==="down")i.hideDependencyLinkSelectedLine(),i.hideTaskBarSelectedBorder(),e._gantt.stateManager.selectedDenpendencyLink.link=l,i.showDependencyLinkSelectedLine();else if((c||p)&&n.poniterState==="down"){if(t.hasListeners(z.CLICK_DEPENDENCY_LINK_POINT)){const g=J(s.offset.y-t.headerHeight+t.stateManager.scrollTop,t),f=t.getRecordByIndex(g.task_index,g.sub_task_index);t.fireListeners(z.CLICK_DEPENDENCY_LINK_POINT,{event:s.nativeEvent,index:g.task_index,sub_task_index:g.sub_task_index,point:c?"start":"end",record:f})}i.hideTaskBarSelectedBorder()}else if(c&&n.poniterState==="draging"){if(i.isCreatingDependencyLine()){const g=i.endCreateDependencyLine(s.offset.y);t.hasListeners(z.CREATE_DEPENDENCY_LINK)&&t.fireListeners(z.CREATE_DEPENDENCY_LINK,{federatedEvent:s,event:s.nativeEvent,link:g})}}else if(p&&n.poniterState==="draging"){if(i.isCreatingDependencyLine()){const g=i.endCreateDependencyLine(s.offset.y);t.hasListeners(z.CREATE_DEPENDENCY_LINK)&&t.fireListeners(z.CREATE_DEPENDENCY_LINK,{federatedEvent:s,event:s.nativeEvent,link:g})}}else i.hideDependencyLinkSelectedLine(),i.hideTaskBarSelectedBorder()}}),e.ganttGroup.addEventListener("rightdown",s=>{let a,r=!1,l=!1;const o=s.detailPath.find(h=>h.name==="task-bar"?(r=!0,!0):!!h.attribute.vtable_link&&(l=!0,a=h.attribute.vtable_link,!1));if(r){if(t.hasListeners(z.CONTEXTMENU_TASK_BAR)){const h=o.task_index,d=o.sub_task_index,c=t.getRecordByIndex(h,d);t.fireListeners(z.CONTEXTMENU_TASK_BAR,{federatedEvent:s,event:s.nativeEvent,index:h,sub_task_index:d,record:c})}}else l&&t.hasListeners(z.CONTEXTMENU_DEPENDENCY_LINK)&&t.fireListeners(z.CONTEXTMENU_DEPENDENCY_LINK,{federatedEvent:s,event:s.nativeEvent,link:a})}),e.ganttGroup.addEventListener("pointerenter",s=>{(t.parsedOptions.scrollStyle.horizontalVisible&&t.parsedOptions.scrollStyle.horizontalVisible==="focus"||!t.parsedOptions.scrollStyle.horizontalVisible&&t.parsedOptions.scrollStyle.visible==="focus")&&e.scrollbarComponent.showHorizontalScrollBar(),(t.parsedOptions.scrollStyle.verticalVisible&&t.parsedOptions.scrollStyle.verticalVisible==="focus"||!t.parsedOptions.scrollStyle.verticalVisible&&t.parsedOptions.scrollStyle.visible==="focus")&&e.scrollbarComponent.showVerticalScrollBar()}),e.ganttGroup.addEventListener("pointerleave",s=>{if((t.parsedOptions.scrollStyle.horizontalVisible&&t.parsedOptions.scrollStyle.horizontalVisible==="focus"||!t.parsedOptions.scrollStyle.horizontalVisible&&t.parsedOptions.scrollStyle.visible==="focus")&&e.scrollbarComponent.hideHorizontalScrollBar(),(t.parsedOptions.scrollStyle.verticalVisible&&t.parsedOptions.scrollStyle.verticalVisible==="focus"||!t.parsedOptions.scrollStyle.verticalVisible&&t.parsedOptions.scrollStyle.visible==="focus")&&e.scrollbarComponent.hideVerticalScrollBar(),e._gantt.stateManager.hoverTaskBar.target){if(e._gantt.hasListeners(z.MOUSELEAVE_TASK_BAR)){const a=e._gantt.stateManager.hoverTaskBar.target.task_index,r=e._gantt.stateManager.hoverTaskBar.target.sub_task_index,l=e._gantt.getRecordByIndex(a,r);e._gantt.fireListeners(z.MOUSELEAVE_TASK_BAR,{federatedEvent:s,event:s.nativeEvent,index:a,sub_task_index:r,record:l})}i.hideTaskBarHover(s)}}),e.ganttGroup.addEventListener("wheel",s=>{xi(s,i,t)})}function pn(n){const e=n._gantt,t=(n._gantt.scenegraph,e.stateManager),i=n._eventHandler;i.on(e.getElement(),"contextmenu",o=>{var h;((h=e.parsedOptions.eventOptions)===null||h===void 0?void 0:h.preventDefaultContextMenu)!==!1&&o.preventDefault()}),i.on(e.getContainer(),"resize",o=>{o.width===0&&o.height===0||(N(e.options.pixelRatio)||e.setPixelRatio(Ft()),o.windowSizeNotChange||e._resize())}),e.taskListTableInstance&&e.parsedOptions.verticalSplitLineMoveable&&i.on(e.verticalSplitResizeLine,"mousedown",o=>{t.updateInteractionState(I.grabing),t.startResizeTableWidth(o)}),e.parsedOptions.verticalSplitLineHighlight&&(e.verticalSplitResizeLine&&i.on(e.verticalSplitResizeLine,"mouseover",o=>{e.verticalSplitResizeLine.childNodes[1].style.opacity="1"}),e.verticalSplitResizeLine&&i.on(e.verticalSplitResizeLine,"mouseout",o=>{e.verticalSplitResizeLine.childNodes[1].style.opacity="0"}));const s=o=>{e.eventManager.lastDragPointerXYOnWindow={x:o.x,y:o.y},e.eventManager.poniterState="down"};n.globalEventListeners.push({name:"mousedown",env:"document",callback:s}),Re.addEventListener("mousedown",s);const a=o=>{var h,d,c,p,u,g;if(e.eventManager.poniterState==="down"){const f=(h=e.eventManager.lastDragPointerXYOnWindow.x)!==null&&h!==void 0?h:o.x,_=o.x-f,T=(d=e.eventManager.lastDragPointerXYOnWindow.y)!==null&&d!==void 0?d:o.y,m=o.y-T;(Math.abs(_)>=1||Math.abs(m)>=1)&&(e.eventManager.poniterState="draging")}if(t.interactionState===I.grabing&&e.eventManager.poniterState==="draging"){const f=(p=(c=e.eventManager.lastDragPointerXYOnWindow)===null||c===void 0?void 0:c.x)!==null&&p!==void 0?p:o.x,_=(g=(u=e.eventManager.lastDragPointerXYOnWindow)===null||u===void 0?void 0:u.y)!==null&&g!==void 0?g:o.y;(Math.abs(f-o.x)>=1||Math.abs(_-o.y)>=1)&&(t.isResizingTableWidth()?(t.hideDependencyLinkSelectedLine(),t.hideTaskBarSelectedBorder(),t.dealResizeTableWidth(o)):t.isMoveingTaskBar()?(t.hideDependencyLinkSelectedLine(),t.hideTaskBarSelectedBorder(),t.dealTaskBarMove(o)):t.isResizingTaskBar()?(t.hideDependencyLinkSelectedLine(),t.hideTaskBarSelectedBorder(),t.dealTaskBarResize(o)):t.isCreatingDependencyLine()&&t.dealCreateDependencyLine(o),e.eventManager.lastDragPointerXYOnWindow={x:o.x,y:o.y})}};n.globalEventListeners.push({name:"mousemove",env:"document",callback:a}),Re.addEventListener("mousemove",a);const r=o=>{t.interactionState==="grabing"&&(t.updateInteractionState(I.default),t.isResizingTableWidth()?t.endResizeTableWidth():t.isMoveingTaskBar()?t.endMoveTaskBar():t.isResizingTaskBar()&&t.endResizeTaskBar(o.x)),e.eventManager.lastDragPointerXYOnWindow=void 0,e.eventManager.poniterState="up"};n.globalEventListeners.push({name:"mouseup",env:"document",callback:r}),Re.addEventListener("mouseup",r);const l=o=>{var h,d;if(e.parsedOptions.dependencyLinkDeletable&&(o.key==="Delete"&&(!((h=e.parsedOptions.keyboardOptions)===null||h===void 0)&&h.deleteLinkOnDel)||o.key==="Backspace"&&(!((d=e.parsedOptions.keyboardOptions)===null||d===void 0)&&d.deleteLinkOnBack))&&e.stateManager.selectedDenpendencyLink.link){const c=e.stateManager.selectedDenpendencyLink.link;e.deleteLink(e.stateManager.selectedDenpendencyLink.link),t.hideDependencyLinkSelectedLine(),t.hideTaskBarSelectedBorder(),e.hasListeners(z.DELETE_DEPENDENCY_LINK)&&e.fireListeners(z.DELETE_DEPENDENCY_LINK,{event:o,link:c})}};n.globalEventListeners.push({name:"keydown",env:"document",callback:l}),Re.addEventListener("keydown",l)}function At(n){const{scroll:e}=n.stateManager,{verticalBarPos:t}=e;n.taskListTableInstance.stateManager.setScrollTop(t,void 0,!1)}function gn(n){var e;n.taskListTableInstance&&((e=n.taskListTableInstance)===null||e===void 0||e.on("scroll",t=>{if(t.scrollDirection==="vertical"){const{scroll:i}=n.taskListTableInstance.stateManager,{verticalBarPos:s}=i;n.stateManager.setScrollTop(s,!1)}}))}function fn(n){var e;(e=n.taskListTableInstance)===null||e===void 0||e.on("change_cell_value",t=>{const{col:i,row:s,rawValue:a,changedValue:r}=t;n._refreshTaskBar(s-n.taskListTableInstance.columnHeaderLevelCount)})}function _n(n){var e;(e=n.taskListTableInstance)===null||e===void 0||e.on("tree_hierarchy_state_change",t=>{var i;n._syncPropsFromTable(),n.scenegraph.refreshTaskBarsAndGrid(),!n.taskListTableInstance.checkHasColumnAutoWidth()||((i=n.options.taskListTable)===null||i===void 0?void 0:i.tableWidth)!=="auto"&&n.taskTableWidth!==-1||Nt(n);const s=n.stateManager.scroll.horizontalBarPos,a=n.stateManager.scroll.verticalBarPos;n.scenegraph.setX(-s),n.scenegraph.setY(-a)})}function bn(n){var e;(e=n.taskListTableInstance)===null||e===void 0||e.on("after_sort",t=>{n.scenegraph.refreshTaskBars();const i=n.stateManager.scroll.horizontalBarPos,s=n.stateManager.scroll.verticalBarPos;n.scenegraph.setX(-i),n.scenegraph.setY(-s)})}function mn(n){var e,t,i,s;(e=n.taskListTableInstance)===null||e===void 0||e.on("change_header_position",a=>{n.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||n.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact||n.parsedOptions.tasksShowMode===L.Sub_Tasks_Separate?n.scenegraph.refreshTaskBarsAndGrid():n.scenegraph.refreshTaskBars(),n.scenegraph.dragOrderLine.hideDragLine();const r=n.stateManager.scroll.horizontalBarPos,l=n.stateManager.scroll.verticalBarPos;n.scenegraph.setX(-r),n.scenegraph.setY(-l)}),(t=n.taskListTableInstance)===null||t===void 0||t.on("change_header_position_start",a=>{const{col:r,row:l,x:o,y:h,backX:d,lineX:c,backY:p,lineY:u,event:g}=a;n.scenegraph.dragOrderLine.showDragLine(u),n.scenegraph.updateNextFrame()}),(i=n.taskListTableInstance)===null||i===void 0||i.on("changing_header_position",a=>{const{col:r,row:l,x:o,y:h,backX:d,lineX:c,backY:p,lineY:u,event:g}=a;n.scenegraph.dragOrderLine.showDragLine(u),n.scenegraph.updateNextFrame()}),(s=n.taskListTableInstance)===null||s===void 0||s.on("change_header_position_fail",a=>{n.scenegraph.dragOrderLine.hideDragLine(),n.scenegraph.updateNextFrame()})}function yn(n){var e;(e=n.taskListTableInstance)===null||e===void 0||e.on("resize_column",t=>{Nt(n)})}function Nt(n){var e,t,i,s,a,r,l,o;const h=n.taskTableWidth;n.taskTableWidth=n.taskListTableInstance.getAllColsWidth()+n.parsedOptions.outerFrameStyle.borderLineWidth,!((t=(e=n.options)===null||e===void 0?void 0:e.taskListTable)===null||t===void 0)&&t.maxTableWidth&&(n.taskTableWidth=Math.min((s=(i=n.options)===null||i===void 0?void 0:i.taskListTable)===null||s===void 0?void 0:s.maxTableWidth,n.taskTableWidth)),!((r=(a=n.options)===null||a===void 0?void 0:a.taskListTable)===null||r===void 0)&&r.minTableWidth&&(n.taskTableWidth=Math.max((o=(l=n.options)===null||l===void 0?void 0:l.taskListTable)===null||o===void 0?void 0:o.minTableWidth,n.taskTableWidth)),h!==n.taskTableWidth&&(n.element.style.left=n.taskTableWidth?`${n.taskTableWidth}px`:"0px",n.taskListTableInstance.setCanvasSize(n.taskTableWidth,n.tableNoFrameHeight+2*n.parsedOptions.outerFrameStyle.borderLineWidth),n._updateSize(),qe(n))}class kn{constructor(){}setScrollHandle(e){this.scrollHandle=e}startInertia(e,t,i){this.stopped=!1,this.lastTime=Date.now(),this.speedX=e,this.speedY=t,this.friction=i,this.runingId||(this.runingId=requestAnimationFrame(this.inertia.bind(this)))}inertia(){var e;if(this.stopped)return;const t=Date.now(),i=t-this.lastTime;let s=!0;const a=Math.pow(this.friction,i/16),r=a*this.speedX,l=a*this.speedY;let o=0,h=0;Math.abs(r)>.05&&(s=!1,o=(this.speedX+r)/2*i),Math.abs(l)>.05&&(s=!1,h=(this.speedY+l)/2*i),(e=this.scrollHandle)===null||e===void 0||e.call(this,o,h),s?this.runingId=null:(this.lastTime=t,this.speedX=r,this.speedY=l,this.runingId=requestAnimationFrame(this.inertia.bind(this)))}endInertia(){cancelAnimationFrame(this.runingId),this.runingId=null,this.stopped=!0}isInertiaScrolling(){return!!this.runingId}}class Sn{constructor(e){var t;this.interactionState=I.default,this.resetInteractionState=Rt(()=>{this.updateInteractionState(I.default)},100),this._gantt=e,this.scroll={horizontalBarPos:0,verticalBarPos:0},this.moveTaskBar={targetStartX:null,targetStartY:null,deltaX:0,deltaY:0,startOffsetY:null,startX:null,startY:null,moving:!1,target:null,moveTaskBarXSpeed:0,moveTaskBarXInertia:new kn},this.hoverTaskBar={targetStartX:null,startX:null,target:null},this.selectedTaskBar={target:null},this.resizeTaskBar={startOffsetY:null,targetStartX:null,targetEndX:null,startX:null,startY:null,target:null,resizing:!1,onIconName:""},this.resizeTableWidth={lastX:null,resizing:!1},this.selectedDenpendencyLink={link:null},this.creatingDenpendencyLink={startClickedPoint:null,startX:null,startY:null,startOffsetY:null,targetStartX:null,creating:!1,secondTaskBarNode:null},this.updateVerticalScrollBar=this.updateVerticalScrollBar.bind(this),this.updateHorizontalScrollBar=this.updateHorizontalScrollBar.bind(this),gn(this._gantt),fn(this._gantt),mn(this._gantt),_n(this._gantt),bn(this._gantt),((t=this._gantt.options.taskListTable)===null||t===void 0?void 0:t.tableWidth)!=="auto"&&this._gantt.taskTableWidth!==-1||yn(this._gantt)}setScrollTop(e,t=!0){const i=this._gantt.getAllRowsHeight();e=Math.max(0,Math.min(e,i-this._gantt.scenegraph.height)),e=Math.ceil(e);const s=this.scroll.verticalBarPos;this.scroll.verticalBarPos=e,N(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this._gantt.scenegraph.setY(-e);const a=e/(i-this._gantt.scenegraph.height);this._gantt.scenegraph.scrollbarComponent.updateVerticalScrollBarPos(a),s!==e&&t&&(At(this._gantt),this._gantt.fireListeners(z.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"vertical",scrollRatioY:a}))}get scrollLeft(){return this.scroll.horizontalBarPos}get scrollTop(){return this.scroll.verticalBarPos}setScrollLeft(e,t=!0){const i=this._gantt.getAllDateColsWidth();e=Math.max(0,Math.min(e,i-this._gantt.scenegraph.width)),e=Math.ceil(e);const s=this.scroll.horizontalBarPos;this.scroll.horizontalBarPos=e,N(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this._gantt.scenegraph.setX(-e);const a=e/(i-this._gantt.scenegraph.width);this._gantt.scenegraph.scrollbarComponent.updateHorizontalScrollBarPos(a),s!==e&&t&&this._gantt.fireListeners(z.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"horizontal",scrollRatioX:a})}updateInteractionState(e){if(this.interactionState===e)return;const t=this.interactionState;this.interactionState=e,t===I.scrolling&&I.default}updateVerticalScrollBar(e){const t=this._gantt.getAllRowsHeight();this.scroll.verticalBarPos,this.scroll.verticalBarPos=Math.ceil(e*(t-this._gantt.scenegraph.height)),N(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this._gantt.scenegraph.setY(-this.scroll.verticalBarPos,e===1),At(this._gantt),this._gantt.fireListeners(z.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"vertical",scrollRatioY:e})}updateHorizontalScrollBar(e){const t=this._gantt.getAllDateColsWidth();this.scroll.horizontalBarPos,this.scroll.horizontalBarPos=Math.ceil(e*(t-this._gantt.scenegraph.width)),N(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this._gantt.scenegraph.setX(-this.scroll.horizontalBarPos,e===1),this._gantt.fireListeners(z.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"horizontal",scrollRatioY:e})}startMoveTaskBar(e,t,i,s){e.name==="task-bar-hover-shadow"&&(e=e.parent),this.moveTaskBar.moving=!0,this.moveTaskBar.target=e,this.moveTaskBar.targetStartX=e.attribute.x,this.moveTaskBar.targetStartY=e.attribute.y,this.moveTaskBar.startX=t,this.moveTaskBar.startY=i,this.moveTaskBar.startOffsetY=s,e.setAttribute("zIndex",1e4)}isMoveingTaskBar(){return this.moveTaskBar.moving}endMoveTaskBar(){this.moveTaskBar.moveTaskBarXInertia.isInertiaScrolling()&&this.moveTaskBar.moveTaskBarXInertia.endInertia();const e=this.moveTaskBar.deltaX,t=this.moveTaskBar.deltaY,i=this.moveTaskBar.target;if(Math.abs(e)>=1||Math.abs(t)>=1){const s=i.task_index,a=i.sub_task_index,{startDate:r,endDate:l}=this._gantt.getTaskInfoByTaskListIndex(s,a),o=this.moveTaskBar.targetStartY+this._gantt.parsedOptions.rowHeight*Math.round(t/this._gantt.parsedOptions.rowHeight),h=this._gantt.parsedOptions.taskBarMilestoneStyle.width,d=this.moveTaskBar.target.attribute.x+(i.record.type==="milestone"?h/2:0),c=Fe(d-this._gantt.stateManager.scroll.horizontalBarPos,this._gantt),p=this._gantt.parsedOptions.reverseSortedTimelineScales[0].timelineDates[c].startDate,u=new Date(p.getTime()+(j(l).getTime()-j(r).getTime()));let g;if(j(r).getTime()!==p.getTime()){g=j(r).getTime()>p.getTime()?"left":"right",this._gantt._updateStartEndDateToTaskRecord(p,u,s,a);const f=this._gantt.getRecordByIndex(s,a);this._gantt.hasListeners(z.CHANGE_DATE_RANGE)&&this._gantt.fireListeners(z.CHANGE_DATE_RANGE,{startDate:f[this._gantt.parsedOptions.startDateField],endDate:f[this._gantt.parsedOptions.endDateField],oldStartDate:r,oldEndDate:l,index:s,record:f})}if(this._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||this._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact){const f=J(o,this._gantt);this._gantt._dragOrderTaskRecord(i.task_index,i.sub_task_index,f.task_index,f.sub_task_index),zt(this._gantt.records),this._gantt.taskListTableInstance.renderWithRecreateCells(),this._gantt._syncPropsFromTable(),this._gantt.scenegraph.refreshTaskBarsAndGrid()}else if(this._gantt.parsedOptions.tasksShowMode!==L.Tasks_Separate&&Math.abs(Math.round(t/this._gantt.parsedOptions.rowHeight))>=1){const f=J(o,this._gantt);this._gantt._dragOrderTaskRecord(i.task_index,i.sub_task_index,f.task_index,f.sub_task_index),this._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Separate?(this._gantt.taskListTableInstance.renderWithRecreateCells(),this._gantt.scenegraph.refreshTaskBarsAndGrid()):(this._gantt.scenegraph.taskBar.refresh(),this._gantt.scenegraph.dependencyLink.refresh())}else{let f=c>=1?this._gantt.getDateColsWidth(0,c-1):0;if(i.record.type==="milestone"&&(f-=this._gantt.parsedOptions.taskBarMilestoneStyle.width/2),$e(i,f-i.attribute.x,o-i.attribute.y,this),g==="right"){let _=i;for(;_.nextSibling&&_.nextSibling.attribute.y===i.attribute.y&&_.nextSibling.record[this._gantt.parsedOptions.startDateField]<=i.record[this._gantt.parsedOptions.startDateField];)_=_.nextSibling;_!==i&&_.parent.insertAfter(i,_)}else if(g==="left"){let _=i;for(;_.previousSibling&&_.previousSibling.attribute.y===i.attribute.y&&_.previousSibling.record[this._gantt.parsedOptions.startDateField]>=i.record[this._gantt.parsedOptions.startDateField];)_=_.previousSibling;_!==i&&_.parent.insertBefore(i,_)}}this._gantt.scenegraph.updateNextFrame()}this.moveTaskBar.moving=!1,this.selectedTaskBar.target!==i&&i.setAttribute("zIndex",0),this.moveTaskBar.target=null,this.moveTaskBar.deltaX=0,this.moveTaskBar.deltaY=0,this.moveTaskBar.moveTaskBarXSpeed=0}dealTaskBarMove(e){var t,i,s,a;const r=this._gantt;let l=this.moveTaskBar.target;l.setAttribute("zIndex",1e4);const o=r.eventManager.lastDragPointerXYOnWindow.x,h=e.x-o,d=r.eventManager.lastDragPointerXYOnWindow.y,c=e.y-d;if(this.moveTaskBar.deltaX+=h,this.moveTaskBar.deltaY+=c,$e(l,h,c,this),l.attribute.x<=r.stateManager.scrollLeft&&h<0)if(r.parsedOptions.moveTaskBarToExtendDateRange&&r.stateManager.scrollLeft===0){(t=this.moveTaskBar.moveTaskBarXInertia)===null||t===void 0||t.endInertia();const p=r.parsedOptions.reverseSortedTimelineScales[0].timelineDates[1].startDate.getTime()-r.parsedOptions.reverseSortedTimelineScales[0].timelineDates[0].startDate.getTime(),{unit:u,startOfWeek:g}=r.parsedOptions.reverseSortedTimelineScales[0];r.parsedOptions.minDate=ze(new Date(r.parsedOptions.reverseSortedTimelineScales[0].timelineDates[0].startDate.getTime()-p/2),u,g),r.parsedOptions._minDateTime=(i=r.parsedOptions.minDate)===null||i===void 0?void 0:i.getTime(),r._generateTimeLineDateMap(),r._updateSize(),r.scenegraph.refreshAll(),l=this.moveTaskBar.target=r.scenegraph.taskBar.getTaskBarNodeByIndex(this.moveTaskBar.target.task_index,this.moveTaskBar.target.sub_task_index),r.scrollLeft=r.parsedOptions.timelineColWidth-1,r.eventManager.lastDragPointerXYOnWindow.x=e.x,l.setAttribute("x",r.scrollLeft)}else this.moveTaskBar.moveTaskBarXSpeed=-r.parsedOptions.timelineColWidth/100,this.moveTaskBar.moveTaskBarXInertia.startInertia(this.moveTaskBar.moveTaskBarXSpeed,0,1),this.moveTaskBar.moveTaskBarXInertia.setScrollHandle((p,u)=>{this.moveTaskBar.deltaX+=p,this.moveTaskBar.deltaY+=u,$e(l,p,u,this),r.stateManager.setScrollLeft(l.attribute.x),r.stateManager.scrollLeft===0&&this.moveTaskBar.moveTaskBarXInertia.endInertia()});else if(l.attribute.x+l.attribute.width>=r.stateManager.scrollLeft+r.tableNoFrameWidth&&h>0)if(r.parsedOptions.moveTaskBarToExtendDateRange&&r.stateManager.scrollLeft+r.tableNoFrameWidth===r.getAllDateColsWidth()){(s=this.moveTaskBar.moveTaskBarXInertia)===null||s===void 0||s.endInertia();const p=r.parsedOptions.reverseSortedTimelineScales[0].timelineDates,u=p[1].startDate.getTime()-p[0].startDate.getTime(),{unit:g,startOfWeek:f,step:_}=r.parsedOptions.reverseSortedTimelineScales[0];r.parsedOptions.maxDate=Ke(r.parsedOptions.minDate,new Date(p[p.length-1].endDate.getTime()+u/2),g,_),r.parsedOptions._maxDateTime=(a=r.parsedOptions.maxDate)===null||a===void 0?void 0:a.getTime(),r._generateTimeLineDateMap(),r._updateSize(),r.scenegraph.refreshAll(),l=this.moveTaskBar.target=r.scenegraph.taskBar.getTaskBarNodeByIndex(this.moveTaskBar.target.task_index,this.moveTaskBar.target.sub_task_index),r.scrollLeft+=1,r.eventManager.lastDragPointerXYOnWindow.x=e.x,l.setAttribute("x",r.scrollLeft+r.tableNoFrameWidth-l.attribute.width)}else this.moveTaskBar.moveTaskBarXSpeed=r.parsedOptions.timelineColWidth/100,this.moveTaskBar.moveTaskBarXInertia.startInertia(this.moveTaskBar.moveTaskBarXSpeed,0,1),this.moveTaskBar.moveTaskBarXInertia.setScrollHandle((p,u)=>{this.moveTaskBar.deltaX+=p,this.moveTaskBar.deltaY+=u,$e(l,p,u,this),r.stateManager.setScrollLeft(l.attribute.x+l.attribute.width-r.tableNoFrameWidth),r.stateManager.scrollLeft===r.getAllDateColsWidth()-r.tableNoFrameWidth&&this.moveTaskBar.moveTaskBarXInertia.endInertia()});else this.moveTaskBar.moveTaskBarXInertia.isInertiaScrolling()?this.moveTaskBar.moveTaskBarXInertia.endInertia():this.moveTaskBar.moveTaskBarXSpeed=0;r.scenegraph.updateNextFrame()}startResizeTaskBar(e,t,i,s,a){this.resizeTaskBar.onIconName=a,this.resizeTaskBar.resizing=!0,this.resizeTaskBar.target=e,this.resizeTaskBar.targetStartX=e.attribute.x,this.resizeTaskBar.targetEndX=e.attribute.x+e.attribute.width,this.resizeTaskBar.startX=t,this.resizeTaskBar.startY=i,this.resizeTaskBar.startOffsetY=s}isResizingTaskBar(){return this.resizeTaskBar.resizing}endResizeTaskBar(e){const t=this._gantt.stateManager.resizeTaskBar.onIconName,i=e-this.resizeTaskBar.startX;if(Math.abs(i)>=1){const s=Fe((t==="left"?this.resizeTaskBar.target.attribute.x:this.resizeTaskBar.target.attribute.x+this.resizeTaskBar.target.attribute.width)-this._gantt.stateManager.scroll.horizontalBarPos,this._gantt),a=this._gantt.parsedOptions.reverseSortedTimelineScales[0].timelineDates[s],r=t==="left"?a.startDate:a.endDate,l=this.resizeTaskBar.target,o=l.clipGroupBox,h=l.barRect,d=l.progressRect,c=l.textLabel,p=l.task_index,u=l.sub_task_index,{taskDays:g,progress:f,startDate:_,endDate:T}=this._gantt.getTaskInfoByTaskListIndex(p,u);let m=!1;if(t==="left"?(this._gantt._updateStartDateToTaskRecord(r,p,u),r.getTime()!==new Date(_).getTime()&&(m=!0)):(this._gantt._updateEndDateToTaskRecord(r,p,u),r.getTime()!==new Date(T).getTime()&&(m=!0)),this._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||this._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact)this._gantt.taskListTableInstance.renderWithRecreateCells(),this._gantt._syncPropsFromTable(),this._gantt.scenegraph.refreshTaskBarsAndGrid();else{if(t==="left"){const b=s>=1?this._gantt.getDateColsWidth(0,s-1):0;l.setAttribute("x",b),l.setAttribute("width",this.resizeTaskBar.targetEndX-b)}else if(t==="right"){const b=this._gantt.getDateColsWidth(0,s);l.setAttribute("width",b-this.resizeTaskBar.targetStartX)}if(o.setAttribute("width",l.attribute.width),h==null||h.setAttribute("width",l.attribute.width),d==null||d.setAttribute("width",f/100*l.attribute.width),c){const{textAlign:b,textBaseline:x,padding:k}=this._gantt.parsedOptions.taskBarLabelStyle,y=et(Je(k),b,x,l.attribute.width,l.attribute.height);c.setAttribute("maxLineWidth",l.attribute.width-2*Et),c.setAttribute("x",y.x)}this._gantt.scenegraph.refreshRecordLinkNodes(p,u,l,0),this.showTaskBarHover(),Gt(this._gantt,l,p,u),l.setAttribute("zIndex",0)}if(this.resizeTaskBar.resizing=!1,this.resizeTaskBar.target=null,m&&this._gantt.hasListeners(z.CHANGE_DATE_RANGE)){const b=this._gantt.getRecordByIndex(p,u);this._gantt.fireListeners(z.CHANGE_DATE_RANGE,{startDate:b[this._gantt.parsedOptions.startDateField],endDate:b[this._gantt.parsedOptions.endDateField],oldStartDate:_,oldEndDate:T,index:p,record:b})}this._gantt.scenegraph.updateNextFrame()}}dealTaskBarResize(e){const t=this._gantt.eventManager.lastDragPointerXYOnWindow.x,i=e.x-t,s=this._gantt.stateManager.resizeTaskBar.target;let a=this._gantt.stateManager.resizeTaskBar.onIconName==="left"?-i:i;const r=Math.max(1,s.attribute.width+a);a=r-s.attribute.width,Ln(s,this._gantt.stateManager.resizeTaskBar.onIconName==="left"?-a:0,r,this),this._gantt.scenegraph.updateNextFrame()}startCreateDependencyLine(e,t,i,s,a){this.creatingDenpendencyLink.creating=!0,this.creatingDenpendencyLink.startClickedPoint=e,this.creatingDenpendencyLink.startX=t,this.creatingDenpendencyLink.startY=i,this.creatingDenpendencyLink.startOffsetY=s,this.creatingDenpendencyLink.firstTaskBarPosition=a,this.highlightLinkPointNode(e)}isCreatingDependencyLine(){return this.creatingDenpendencyLink.creating}endCreateDependencyLine(e){const t=this._gantt.parsedOptions.taskKeyField,i=this.selectedTaskBar.target.task_index,s=this.selectedTaskBar.target.sub_task_index,a=this.creatingDenpendencyLink.secondTaskBarNode.task_index,r=this.creatingDenpendencyLink.secondTaskBarNode.sub_task_index,l={linkedFromTaskKey:this._gantt.getRecordByIndex(i,s)[t],linkedToTaskKey:this._gantt.getRecordByIndex(a,r)[t],type:this.creatingDenpendencyLink.firstTaskBarPosition==="left"&&this.creatingDenpendencyLink.secondTaskBarPosition==="left"?Y.StartToStart:this.creatingDenpendencyLink.firstTaskBarPosition==="right"&&this.creatingDenpendencyLink.secondTaskBarPosition==="left"?Y.FinishToStart:this.creatingDenpendencyLink.firstTaskBarPosition==="right"&&this.creatingDenpendencyLink.secondTaskBarPosition==="right"?Y.FinishToFinish:Y.StartToFinish};return this._gantt.addLink(l),this.hideTaskBarSelectedBorder(),this._gantt.scenegraph.updateNextFrame(),this.creatingDenpendencyLink.creating=!1,l}dealCreateDependencyLine(e){const t=this.creatingDenpendencyLink.startX,i=this.creatingDenpendencyLink.startY,s=e.x-t,a=e.y-i,r=this.creatingDenpendencyLink.startClickedPoint,l=r.attribute.x+r.attribute.width/2,o=r.attribute.y+r.attribute.height/2;this._gantt.scenegraph.taskBar.updateCreatingDependencyLine(l,o,l+s,o+a),this._gantt.scenegraph.updateNextFrame()}startResizeTableWidth(e){this.resizeTableWidth.resizing=!0,this.resizeTableWidth.lastX=e.pageX}isResizingTableWidth(){return this.resizeTableWidth.resizing}endResizeTableWidth(){this.resizeTableWidth.resizing=!1}dealResizeTableWidth(e){var t,i;if(!this.resizeTableWidth.resizing)return;const s=e.pageX-this.resizeTableWidth.lastX;if(Math.abs(s)>=1){let a=this._gantt.taskTableWidth+s;const r=Math.min(this._gantt.taskListTableInstance.getAllColsWidth()+this._gantt.parsedOptions.outerFrameStyle.borderLineWidth,(t=this._gantt.options.taskListTable.maxTableWidth)!==null&&t!==void 0?t:1e5),l=Math.max(this._gantt.parsedOptions.outerFrameStyle.borderLineWidth,(i=this._gantt.options.taskListTable.minTableWidth)!==null&&i!==void 0?i:0);s>0&&a>r&&(a=r),s<0&&a<l&&(a=l),this._gantt.taskTableWidth=a,this._gantt.element.style.left=this._gantt.taskTableWidth?`${this._gantt.taskTableWidth}px`:"0px",this._gantt.verticalSplitResizeLine.style.left=this._gantt.taskTableWidth?this._gantt.taskTableWidth-7+"px":"0px",this._gantt._resize(),this.resizeTableWidth.lastX=e.pageX}}showTaskBarHover(){const e=this._gantt.stateManager.hoverTaskBar.target;if(e){const t=e.attribute.x,i=e.attribute.y,s=e.attribute.width,a=e.attribute.height;this._gantt.scenegraph.taskBar.showHoverBar(t,i,s,a,e),this._gantt.scenegraph.updateNextFrame()}}hideTaskBarHover(e){this._gantt.stateManager.hoverTaskBar.target=null,this._gantt.scenegraph.taskBar.hideHoverBar(),this._gantt.scenegraph.updateNextFrame()}showTaskBarSelectedBorder(e){var t;(t=this._gantt.stateManager.selectedTaskBar.target)===null||t===void 0||t.setAttribute("zIndex",0),this._gantt.stateManager.selectedTaskBar.target=e;const i=this._gantt.parsedOptions.dependencyLinkCreatable;e.setAttribute("zIndex",1e4);const s=e.attribute.x,a=e.attribute.y,r=e.attribute.width,l=e.attribute.height;this._gantt.scenegraph.taskBar.createSelectedBorder(s,a,r,l,e,i),this._gantt.scenegraph.updateNextFrame()}hideTaskBarSelectedBorder(){var e;(e=this._gantt.stateManager.selectedTaskBar.target)===null||e===void 0||e.setAttribute("zIndex",0),this._gantt.stateManager.selectedTaskBar.target=null,this._gantt.scenegraph.taskBar.removeSelectedBorder(),this._gantt.scenegraph.updateNextFrame()}showSecondTaskBarSelectedBorder(){const e=this._gantt.stateManager.creatingDenpendencyLink.secondTaskBarNode,t=e.attribute.x,i=e.attribute.y,s=e.attribute.width,a=e.attribute.height;this._gantt.scenegraph.taskBar.createSelectedBorder(t,i,s,a,e,!0),this._gantt.scenegraph.updateNextFrame()}hideSecondTaskBarSelectedBorder(){this._gantt.stateManager.creatingDenpendencyLink.secondTaskBarNode=null,this._gantt.scenegraph.taskBar.removeSecondSelectedBorder(),this._gantt.scenegraph.updateNextFrame()}showDependencyLinkSelectedLine(){const e=this._gantt.stateManager.selectedDenpendencyLink.link;this._gantt.scenegraph.dependencyLink.createSelectedLinkLine(e);const{taskKeyField:t,dependencyLinks:i}=this._gantt.parsedOptions,{linkedToTaskKey:s,linkedFromTaskKey:a,type:r}=e;let l,o,h,d;const c=ne(this._gantt.records,t,s),p=ne(this._gantt.records,t,a);this._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Inline||this._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Separate||this._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||this._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact?(l=p.index[0],o=p.index[1],h=c.index[0],d=c.index[1]):(l=this._gantt.getTaskShowIndexByRecordIndex(p.index),h=this._gantt.getTaskShowIndexByRecordIndex(c.index));const u=this._gantt.scenegraph.taskBar.getTaskBarNodeByIndex(l,o);this._gantt.scenegraph.taskBar.createSelectedBorder(u.attribute.x,u.attribute.y,u.attribute.width,u.attribute.height,u,!1);const g=this._gantt.scenegraph.taskBar.getTaskBarNodeByIndex(h,d);this._gantt.scenegraph.taskBar.createSelectedBorder(g.attribute.x,g.attribute.y,g.attribute.width,g.attribute.height,g,!1),this._gantt.scenegraph.updateNextFrame()}hideDependencyLinkSelectedLine(){this._gantt.stateManager.selectedDenpendencyLink.link=null,this._gantt.scenegraph.dependencyLink.removeSelectedLinkLine(),this._gantt.scenegraph.taskBar.removeSelectedBorder(),this._gantt.scenegraph.updateNextFrame()}highlightLinkPointNode(e){if((e==null?void 0:e.children.length)>0){const t=e.children[0];t.setAttribute("fill",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.fillColor),t.setAttribute("stroke",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.strokeColor),t.setAttribute("radius",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.radius),t.setAttribute("lineWidth",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.strokeWidth),this._gantt.scenegraph.updateNextFrame()}}unhighlightLinkPointNode(e){if((e==null?void 0:e.children.length)>0){const t=e.children[0];t.setAttribute("fill",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.fillColor),t.setAttribute("stroke",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeColor),t.setAttribute("radius",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.radius),t.setAttribute("lineWidth",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeWidth),this._gantt.scenegraph.updateNextFrame()}}}function Gt(n,e,t,i){const s=n.parsedOptions.taskBarCustomLayout;if(s){let a;if(typeof s=="function"){const{startDate:r,endDate:l,taskDays:o,progress:h,taskRecord:d}=n.getTaskInfoByTaskListIndex(t,i);a=s({width:e.attribute.width,height:e.attribute.height,index:t,startDate:r,endDate:l,taskDays:o,progress:h,taskRecord:d,ganttInstance:n})}else a=s;if(a){const r=a.rootContainer;r.name="task-bar-custom-render";const l=e.children.find(o=>o.name==="task-bar-group");if(l){const o=l.children.findIndex(d=>d.name==="task-bar-custom-render"),h=l.children[o];h&&(l.removeChild(h),l.insertInto(r,o))}}}}function $e(n,e,t,i){const s=n.task_index,a=n.sub_task_index,r=n.record.type==="milestone";e&&n.setAttribute("x",Math.max(0,n.attribute.x+e)),i._gantt.parsedOptions.tasksShowMode!==L.Tasks_Separate?t&&n.setAttribute("y",n.attribute.y+t):t=0,r&&n.setAttribute("anchor",[n.attribute.x+n.attribute.width/2,n.attribute.y+n.attribute.height/2]),i._gantt.scenegraph.refreshRecordLinkNodes(s,a,n,t)}function Ln(n,e,t,i){const s=i._gantt.parsedOptions.progressField,a=n.clipGroupBox,r=n.barRect,l=n.progressRect,o=n.textLabel,h=n.task_index,d=n.sub_task_index,c=n.record,p=c[s],u=c.type==="milestone";if(n.setAttribute("zIndex",1e4),e&&n.setAttribute("x",n.attribute.x+e),u&&n.setAttribute("anchor",[n.attribute.x+n.attribute.width/2,n.attribute.y+n.attribute.height/2]),t&&n.setAttribute("width",t),a.setAttribute("width",n.attribute.width),r==null||r.setAttribute("width",n.attribute.width),l==null||l.setAttribute("width",p/100*n.attribute.width),o){const{textAlign:g,textBaseline:f,padding:_}=i._gantt.parsedOptions.taskBarLabelStyle,T=et(Je(_),g,f,t,n.attribute.height);o.setAttribute("maxLineWidth",t-2*Et),o.setAttribute("x",T.x)}i.showTaskBarHover(),Gt(i._gantt,n,h,d),i._gantt.scenegraph.refreshRecordLinkNodes(h,d,n,0)}let vn=1;class Tn{constructor(){this.listenersData={listeners:{},listenerData:{}}}on(e,t){const i=this.listenersData.listeners[e]||(this.listenersData.listeners[e]=[]);i.push(t);const s=vn++;return this.listenersData.listenerData[s]={type:e,listener:t,remove:()=>{delete this.listenersData.listenerData[s];const a=i.indexOf(t);i.splice(a,1),this.listenersData.listeners[e].length||delete this.listenersData.listeners[e]}},s}off(e,t){var i;if(t){const s=e;this.removeEventListener(s,t)}else{const s=e;if(!this.listenersData)return;(i=this.listenersData.listenerData[s])===null||i===void 0||i.remove()}}addEventListener(e,t,i){this.on(e,t)}removeEventListener(e,t){if(this.listenersData)for(const i in this.listenersData.listenerData){const s=this.listenersData.listenerData[i];s.type===e&&s.listener===t&&this.off(i)}}hasListeners(e){return!!this.listenersData&&!!this.listenersData.listeners[e]}fireListeners(e,t){if(!this.listenersData)return[];const i=this.listenersData.listeners[e];return i?i.map(s=>s.call(this,t)).filter(s=>N(s)):[]}release(){delete this.listenersData}}class xn{constructor(e){this._gantt=e,this.records=e.records,this.processRecords()}processRecords(){const e=!this._gantt.options.minDate,t=!this._gantt.options.maxDate;let i=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;if((e||t||this._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Inline||this._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact)&&this.records.length){for(let o=0;o<this.records.length;o++){const h=this.records[o];if(e&&h[this._gantt.parsedOptions.startDateField]){const d=j(h[this._gantt.parsedOptions.startDateField]);i=Math.min(i,d.getTime())}if(t&&h[this._gantt.parsedOptions.endDateField]){const d=j(h[this._gantt.parsedOptions.endDateField]);s=Math.max(s,d.getTime())}this._gantt.parsedOptions.tasksShowMode!==L.Sub_Tasks_Inline&&this._gantt.parsedOptions.tasksShowMode!==L.Sub_Tasks_Compact||h.children&&h.children.sort((d,c)=>j(d[this._gantt.parsedOptions.startDateField]).getTime()-j(c[this._gantt.parsedOptions.startDateField]).getTime())}const{unit:a,startOfWeek:r,step:l}=this._gantt.parsedOptions.reverseSortedTimelineScales[0];e&&(this._gantt.parsedOptions.minDate=ze(new Date(i),a,r),this._gantt.parsedOptions._minDateTime=this._gantt.parsedOptions.minDate.getTime()),t&&(this._gantt.parsedOptions.maxDate=Ke(this._gantt.parsedOptions.minDate,new Date(s),a,l),this._gantt.parsedOptions._maxDateTime=this._gantt.parsedOptions.maxDate.getTime())}}adjustOrder(e,t,i,s){var a,r;if(this._gantt.parsedOptions.tasksShowMode!==L.Sub_Tasks_Arrange&&this._gantt.parsedOptions.tasksShowMode!==L.Sub_Tasks_Compact||e!==i){if(this._gantt.parsedOptions.tasksShowMode===L.Sub_Tasks_Inline){if(N(t)&&N(s)&&N(e)&&N(i)){const l=this.records[e].children[t];this.records[e].children.splice(t,1),this.records[i].children||(this.records[i].children=[]),this.records[i].children.splice(s,0,l)}(r=(a=this.records[i])===null||a===void 0?void 0:a.children)===null||r===void 0||r.sort((l,o)=>j(l[this._gantt.parsedOptions.startDateField]).getTime()-j(o[this._gantt.parsedOptions.startDateField]).getTime())}else if(N(t)&&N(s)&&N(e)&&N(i)){const l=this.records[e].children[t];this.records[e].children.splice(t,1),this.records[i].children||(this.records[i].children=[]),this.records[i].children.splice(s,0,l)}}}setRecords(e){this.records=e,this.processRecords()}}function Bn(n,e="vtable-gantt"){var t,i;const s=document.createElement("div");s.setAttribute("tabindex","0"),s.classList.add(e),s.style.outline="none",s.style.margin=`${n.top}px ${n.right}px ${n.bottom}px ${n.left}px`;const a=(s.offsetWidth||((t=s.parentElement)===null||t===void 0?void 0:t.offsetWidth)||1)-1,r=(s.offsetHeight||((i=s.parentElement)===null||i===void 0?void 0:i.offsetHeight)||1)-1;return s.style.width=a&&a-n.left-n.right+"px"||"0px",s.style.height=r&&r-n.top-n.bottom+"px"||"0px",s}class Lt extends Tn{constructor(e,t){var i,s,a,r,l;super(),this.parsedOptions={},this.container=e,this.options=t,this.taskTableWidth=typeof((i=t==null?void 0:t.taskListTable)===null||i===void 0?void 0:i.tableWidth)=="number"?(s=t==null?void 0:t.taskListTable)===null||s===void 0?void 0:s.tableWidth:-1,this.taskTableColumns=(r=(a=t==null?void 0:t.taskListTable)===null||a===void 0?void 0:a.columns)!==null&&r!==void 0?r:[],this.records=(l=t==null?void 0:t.records)!==null&&l!==void 0?l:[],this._sortScales(),Ct(this),this.data=new xn(this),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this.element=Bn({top:0,right:0,left:0,bottom:0},"vtable-gantt"),this.element.style.left=this.taskTableWidth?`${this.taskTableWidth}px`:"0px",this.canvas=document.createElement("canvas"),this.element.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),e?(e.appendChild(this.element),this._updateSize()):this._updateSize(),this._generateListTable(),this._syncPropsFromTable(),Fi(this),this.scenegraph=new sn(this),this.stateManager=new Sn(this),this.eventManager=new cn(this),this.scenegraph.afterCreateSceneGraph(),this._scrollToMarkLine()}renderTaskBarsTable(){this.scenegraph.updateNextFrame()}_updateSize(){var e,t,i,s,a,r,l,o;let h=0,d=0;if(F.mode==="browser"){const u=this.getElement();let g=0,f=0;if(u.parentElement){const b=u.parentElement.style||window.getComputedStyle(u.parentElement);g=u.parentElement.offsetWidth-parseInt(b.paddingLeft||"0px",10)-parseInt(b.paddingRight||"0px",10),f=u.parentElement.offsetHeight-parseInt(b.paddingTop||"0px",10)-parseInt(b.paddingBottom||"0px",20)}const _=(g??1)-1-this.taskTableWidth,T=(f??1)-1;u.style.width=_&&`${_}px`||"0px",u.style.height=T&&`${T}px`||"0px";const{canvas:m}=this;h=(t=(e=m.parentElement)===null||e===void 0?void 0:e.offsetWidth)!==null&&t!==void 0?t:1,d=(s=(i=m.parentElement)===null||i===void 0?void 0:i.offsetHeight)!==null&&s!==void 0?s:1,!((a=this==null?void 0:this.scenegraph)===null||a===void 0)&&a.stage?this.scenegraph.stage.resize(h,d):(m.style.width="",m.style.height="",m.width=h,m.height=d,m.style.width=`${h}px`,m.style.height=`${d}px`)}else F.mode;const c=Math.floor(h-Ii(this.parsedOptions.scrollStyle)),p=Math.floor(d-zi(this.parsedOptions.scrollStyle));if(this.tableNoFrameWidth=h,this.tableNoFrameHeight=Math.floor(d),this.parsedOptions.outerFrameStyle){const u=(r=this.parsedOptions.outerFrameStyle)===null||r===void 0?void 0:r.borderLineWidth;this.tableX=this.taskTableColumns.length>=1||!((l=this.options)===null||l===void 0)&&l.rowSeriesNumber?(o=this.parsedOptions.verticalSplitLine.lineWidth)!==null&&o!==void 0?o:0:u,this.tableY=u,this.tableNoFrameWidth=Math.min(c-u-this.tableX,this.getAllDateColsWidth()),this.tableNoFrameHeight=p-2*u}}_updateListTableSize(e){var t,i,s,a,r,l,o,h,d,c;if(e&&(((i=(t=this.options)===null||t===void 0?void 0:t.taskListTable)===null||i===void 0?void 0:i.tableWidth)!=="auto"&&this.taskTableWidth!==-1||(this.taskTableWidth=e.getAllColsWidth()+this.parsedOptions.outerFrameStyle.borderLineWidth,!((a=(s=this.options)===null||s===void 0?void 0:s.taskListTable)===null||a===void 0)&&a.maxTableWidth&&(this.taskTableWidth=Math.min((l=(r=this.options)===null||r===void 0?void 0:r.taskListTable)===null||l===void 0?void 0:l.maxTableWidth,this.taskTableWidth)),!((h=(o=this.options)===null||o===void 0?void 0:o.taskListTable)===null||h===void 0)&&h.minTableWidth&&(this.taskTableWidth=Math.max((c=(d=this.options)===null||d===void 0?void 0:d.taskListTable)===null||c===void 0?void 0:c.minTableWidth,this.taskTableWidth)),this.element.style.left=this.taskTableWidth?`${this.taskTableWidth}px`:"0px",e.setCanvasSize(this.taskTableWidth,this.tableNoFrameHeight+2*this.parsedOptions.outerFrameStyle.borderLineWidth),this._updateSize()),e.columnHeaderLevelCount>1))if(e.columnHeaderLevelCount===this.parsedOptions.timeLineHeaderRowHeights.length)for(let p=0;p<e.columnHeaderLevelCount;p++)e.setRowHeight(p,this.parsedOptions.timeLineHeaderRowHeights[p]);else{const p=this.getAllHeaderRowsHeight()/e.columnHeaderLevelCount;for(let u=0;u<e.columnHeaderLevelCount;u++)e.setRowHeight(u,p)}}_generateListTable(){var e;if(this.taskTableColumns.length>=1||!((e=this.options)===null||e===void 0)&&e.rowSeriesNumber){const t=this._generateListTableOptions();this.taskListTableInstance=new ii(this.container,t),this._updateListTableSize(this.taskListTableInstance)}}_generateListTableOptions(){var e,t,i,s,a,r,l,o,h,d,c,p,u,g,f,_,T,m,b,x,k,y,B,C,O,w,v,H,P,G,W,E,U,K,X,q,se,ae,re,le,ee,Z,ce,ue,pe,ge,fe,_e,be,me,ye,ke,Se,Le,ve,Te,xe,Be,we,Oe,Ce,De,He,Ae,Me,We;const D={},Ne=["container","records","rowSeriesNumber","overscrollBehavior","pixelRatio","eventOptions"];for(const A in this.options)Ne.indexOf(A)>=0&&(D[A]=this.options[A]);for(const A in this.options.taskListTable){if(D[A]=this.options.taskListTable[A],A==="columns"&&(D[A][D[A].length-1].disableColumnResize=!0,this.parsedOptions.tasksShowMode===L.Sub_Tasks_Inline||this.parsedOptions.tasksShowMode===L.Sub_Tasks_Separate||this.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange||this.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact))for(let V=0;V<D.columns.length;V++)D.columns[V].tree&&(D.columns[V].tree=!1);A!=="hierarchyExpandLevel"||this.parsedOptions.tasksShowMode!==L.Sub_Tasks_Inline&&this.parsedOptions.tasksShowMode!==L.Sub_Tasks_Separate&&this.parsedOptions.tasksShowMode!==L.Sub_Tasks_Arrange&&this.parsedOptions.tasksShowMode!==L.Sub_Tasks_Compact||delete D[A]}if(!((e=this.options.taskListTable)===null||e===void 0)&&e.theme)if(D.theme=(t=this.options.taskListTable)===null||t===void 0?void 0:t.theme,D.theme.bodyStyle&&!Li(D.theme,"bodyStyle")){D.theme=((i=this.options.taskListTable)===null||i===void 0?void 0:i.theme).extends(((s=this.options.taskListTable)===null||s===void 0?void 0:s.theme).getExtendTheme());const A=D.theme.getExtendTheme();D.theme.clearBodyStyleCache(),!((a=D.theme.headerStyle)===null||a===void 0)&&a.bgColor||(A.headerStyle?A.headerStyle.bgColor||(A.headerStyle.bgColor=this.parsedOptions.timelineHeaderBackgroundColor):A.headerStyle={bgColor:this.parsedOptions.timelineHeaderBackgroundColor}),A.bodyStyle?A.bodyStyle.frameStyle={borderLineWidth:[(l=(r=this.parsedOptions.horizontalSplitLine)===null||r===void 0?void 0:r.lineWidth)!==null&&l!==void 0?l:0,0,0,0],borderColor:(o=this.parsedOptions.horizontalSplitLine)===null||o===void 0?void 0:o.lineColor}:A.bodyStyle={frameStyle:{borderLineWidth:[(d=(h=this.parsedOptions.horizontalSplitLine)===null||h===void 0?void 0:h.lineWidth)!==null&&d!==void 0?d:0,0,0,0],borderColor:(c=this.parsedOptions.horizontalSplitLine)===null||c===void 0?void 0:c.lineColor}},A.cellInnerBorder=!1,A.frameStyle=Object.assign({},this.parsedOptions.outerFrameStyle,{shadowBlur:0,cornerRadius:[(u=(p=this.parsedOptions.outerFrameStyle)===null||p===void 0?void 0:p.cornerRadius)!==null&&u!==void 0?u:0,0,0,(f=(g=this.parsedOptions.outerFrameStyle)===null||g===void 0?void 0:g.cornerRadius)!==null&&f!==void 0?f:0],borderLineWidth:[(T=(_=this.parsedOptions.outerFrameStyle)===null||_===void 0?void 0:_.borderLineWidth)!==null&&T!==void 0?T:0,0,(b=(m=this.parsedOptions.outerFrameStyle)===null||m===void 0?void 0:m.borderLineWidth)!==null&&b!==void 0?b:0,(k=(x=this.parsedOptions.outerFrameStyle)===null||x===void 0?void 0:x.borderLineWidth)!==null&&k!==void 0?k:0]}),A.scrollStyle=Object.assign({},(B=(y=this.options.taskListTable)===null||y===void 0?void 0:y.theme)===null||B===void 0?void 0:B.scrollStyle,this.parsedOptions.scrollStyle,{verticalVisible:"none"}),A.columnResize=Object.assign({labelColor:"rgba(0,0,0,0)",labelBackgroundFill:"rgba(0,0,0,0)"},A==null?void 0:A.columnResize),A.underlayBackgroundColor||(A.underlayBackgroundColor=this.parsedOptions.underlayBackgroundColor)}else D.theme.headerStyle?D.theme.headerStyle.bgColor||(D.theme.headerStyle.bgColor=this.parsedOptions.timelineHeaderBackgroundColor):D.theme.headerStyle={bgColor:this.parsedOptions.timelineHeaderBackgroundColor},D.theme.headerStyle=Object.assign({},Xe.headerStyle,{bgColor:this.parsedOptions.timelineHeaderBackgroundColor},(O=(C=this.options.taskListTable)===null||C===void 0?void 0:C.theme)===null||O===void 0?void 0:O.headerStyle),D.theme.bodyStyle=Object.assign({},Xe.bodyStyle,(v=(w=this.options.taskListTable)===null||w===void 0?void 0:w.theme)===null||v===void 0?void 0:v.bodyStyle,{frameStyle:{borderLineWidth:[(P=(H=this.parsedOptions.horizontalSplitLine)===null||H===void 0?void 0:H.lineWidth)!==null&&P!==void 0?P:0,0,0,0],borderColor:(G=this.parsedOptions.horizontalSplitLine)===null||G===void 0?void 0:G.lineColor}}),D.theme.cellInnerBorder=!1,D.theme.frameStyle=Object.assign({},this.parsedOptions.outerFrameStyle,{cornerRadius:[(E=(W=this.parsedOptions.outerFrameStyle)===null||W===void 0?void 0:W.cornerRadius)!==null&&E!==void 0?E:0,0,0,(K=(U=this.parsedOptions.outerFrameStyle)===null||U===void 0?void 0:U.cornerRadius)!==null&&K!==void 0?K:0],borderLineWidth:[(q=(X=this.parsedOptions.outerFrameStyle)===null||X===void 0?void 0:X.borderLineWidth)!==null&&q!==void 0?q:0,0,(ae=(se=this.parsedOptions.outerFrameStyle)===null||se===void 0?void 0:se.borderLineWidth)!==null&&ae!==void 0?ae:0,(le=(re=this.parsedOptions.outerFrameStyle)===null||re===void 0?void 0:re.borderLineWidth)!==null&&le!==void 0?le:0]}),D.theme.scrollStyle=Object.assign({},(Z=(ee=this.options.taskListTable)===null||ee===void 0?void 0:ee.theme)===null||Z===void 0?void 0:Z.scrollStyle,this.parsedOptions.scrollStyle,{verticalVisible:"none"}),D.theme.columnResize=Object.assign({labelColor:"rgba(0,0,0,0)",labelBackgroundFill:"rgba(0,0,0,0)"},(ue=(ce=this.options.taskListTable)===null||ce===void 0?void 0:ce.theme)===null||ue===void 0?void 0:ue.columnResize),D.theme.underlayBackgroundColor||(D.theme.underlayBackgroundColor=this.parsedOptions.underlayBackgroundColor);else D.theme={scrollStyle:Object.assign({},(ge=(pe=this.options.taskListTable)===null||pe===void 0?void 0:pe.theme)===null||ge===void 0?void 0:ge.scrollStyle,this.parsedOptions.scrollStyle,{verticalVisible:"none"}),headerStyle:Object.assign({},Xe.headerStyle,{bgColor:this.parsedOptions.timelineHeaderBackgroundColor},(_e=(fe=this.options.taskListTable)===null||fe===void 0?void 0:fe.theme)===null||_e===void 0?void 0:_e.headerStyle),bodyStyle:Object.assign({},Xe.bodyStyle,(me=(be=this.options.taskListTable)===null||be===void 0?void 0:be.theme)===null||me===void 0?void 0:me.bodyStyle,{frameStyle:{borderLineWidth:[(ke=(ye=this.parsedOptions.horizontalSplitLine)===null||ye===void 0?void 0:ye.lineWidth)!==null&&ke!==void 0?ke:0,0,0,0],borderColor:(Se=this.parsedOptions.horizontalSplitLine)===null||Se===void 0?void 0:Se.lineColor}}),cellInnerBorder:!1,frameStyle:Object.assign({},this.parsedOptions.outerFrameStyle,{cornerRadius:[(ve=(Le=this.parsedOptions.outerFrameStyle)===null||Le===void 0?void 0:Le.cornerRadius)!==null&&ve!==void 0?ve:0,0,0,(xe=(Te=this.parsedOptions.outerFrameStyle)===null||Te===void 0?void 0:Te.cornerRadius)!==null&&xe!==void 0?xe:0],borderLineWidth:[(we=(Be=this.parsedOptions.outerFrameStyle)===null||Be===void 0?void 0:Be.borderLineWidth)!==null&&we!==void 0?we:0,0,(Ce=(Oe=this.parsedOptions.outerFrameStyle)===null||Oe===void 0?void 0:Oe.borderLineWidth)!==null&&Ce!==void 0?Ce:0,(He=(De=this.parsedOptions.outerFrameStyle)===null||De===void 0?void 0:De.borderLineWidth)!==null&&He!==void 0?He:0]}),columnResize:Object.assign({labelColor:"rgba(0,0,0,0)",labelBackgroundFill:"rgba(0,0,0,0)"},(Me=(Ae=this.options.taskListTable)===null||Ae===void 0?void 0:Ae.theme)===null||Me===void 0?void 0:Me.columnResize),underlayBackgroundColor:this.parsedOptions.underlayBackgroundColor};return D.canvasWidth=this.taskTableWidth,D.canvasHeight=this.canvas.height,D.defaultHeaderRowHeight=this.getAllHeaderRowsHeight(),this.parsedOptions.tasksShowMode===L.Sub_Tasks_Separate?(D.customComputeRowHeight=A=>{var V;const{row:oe,table:Q}=A,Ie=Q.getRecordByRowCol(0,oe);if(Ie)return(((V=Ie.children)===null||V===void 0?void 0:V.length)||1)*this.parsedOptions.rowHeight},D.defaultRowHeight="auto"):this.parsedOptions.tasksShowMode===L.Sub_Tasks_Compact?(D.customComputeRowHeight=A=>{const{row:V,table:oe}=A,Q=oe.getRecordByRowCol(0,V);if(Q)return It(this,Q)*this.parsedOptions.rowHeight},D.defaultRowHeight="auto"):this.parsedOptions.tasksShowMode===L.Sub_Tasks_Arrange?(D.customComputeRowHeight=A=>{const{row:V,table:oe}=A,Q=oe.getRecordByRowCol(0,V);if(Q)return Pt(this,Q)*this.parsedOptions.rowHeight},D.defaultRowHeight="auto"):D.defaultRowHeight=(We=this.options.rowHeight)!==null&&We!==void 0?We:40,D.clearDOM=!1,D}getElement(){return this.element}getContainer(){return this.element.parentElement}_sortScales(){const{timelineHeader:e}=this.options;if(e){const t=e.scales,i=["year","quarter","month","week","day","hour","minute","second"];t.length===1&&(t[0].unit!=="hour"&&t[0].unit!=="minute"&&t[0].unit!=="second"||(this.parsedOptions.timeScaleIncludeHour=!0));const s=t.slice().sort((r,l)=>{r.unit!=="hour"&&r.unit!=="minute"&&r.unit!=="second"||(this.parsedOptions.timeScaleIncludeHour=!0);const o=i.indexOf(r.unit),h=i.indexOf(l.unit);return o===-1?1:h===-1?-1:o-h}),a=t.slice().sort((r,l)=>{const o=i.indexOf(r.unit),h=i.indexOf(l.unit);return o===-1?1:h===-1?-1:h-o});this.parsedOptions.sortedTimelineScales=s,this.parsedOptions.reverseSortedTimelineScales=a}}_generateTimeLineDateMap(){if(this.parsedOptions.minDate&&this.parsedOptions.maxDate)for(const e of this.parsedOptions.reverseSortedTimelineScales)e.timelineDates=Ei(new Date(this.parsedOptions.minDate),this.parsedOptions.maxDate,e)}getRowHeightByIndex(e){return this.taskListTableInstance?this.taskListTableInstance.getRowHeight(e+this.taskListTableInstance.columnHeaderLevelCount):this.parsedOptions.rowHeight}getRowsHeightByIndex(e,t){return this.taskListTableInstance?this.taskListTableInstance.getRowsHeight(e+this.taskListTableInstance.columnHeaderLevelCount,t+this.taskListTableInstance.columnHeaderLevelCount):this.parsedOptions.rowHeight*(t-e+1)}getAllRowsHeight(){return this.taskListTableInstance?this.taskListTableInstance.getAllRowsHeight():this.getAllHeaderRowsHeight()+this.itemCount*this.parsedOptions.rowHeight}getAllHeaderRowsHeight(){return this.parsedOptions.timeLineHeaderRowHeights.reduce((e,t,i)=>e+t,0)}getAllDateColsWidth(){var e,t;return this.parsedOptions.timelineColWidth*((t=(e=this.parsedOptions.reverseSortedTimelineScales[0].timelineDates)===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0)}getAllTaskBarsHeight(){return this.taskListTableInstance?this.taskListTableInstance.getRowsHeight(this.taskListTableInstance.columnHeaderLevelCount,this.taskListTableInstance.rowCount-1):this.itemCount*this.parsedOptions.rowHeight}getTaskShowIndexByRecordIndex(e){return this.taskListTableInstance.getBodyRowIndexByRecordIndex(e)}getRecordByIndex(e,t){var i,s;return N(t)?(s=(i=this.records[e])===null||i===void 0?void 0:i.children)===null||s===void 0?void 0:s[t]:this.taskListTableInstance?this.taskListTableInstance.getRecordByRowCol(0,e+this.taskListTableInstance.columnHeaderLevelCount):this.records[e]}_refreshTaskBar(e,t){this.scenegraph.taskBar.updateTaskBarNode(e,t),this.scenegraph.refreshRecordLinkNodes(e,void 0,this.scenegraph.taskBar.getTaskBarNodeByIndex(e,t)),this.scenegraph.updateNextFrame()}_updateRecordToListTable(e,t){this.taskListTableInstance.updateRecords([e],[t])}getTaskInfoByTaskListIndex(e,t){const i=this.getRecordByIndex(e,t),s=i==null?void 0:i.type,a=this.parsedOptions.startDateField,r=this.parsedOptions.endDateField,l=this.parsedOptions.progressField,o=j(i==null?void 0:i[a]).getTime(),h=j(i==null?void 0:i[r]).getTime();if(s&&!(i!=null&&i[a])||!s&&(h<this.parsedOptions._minDateTime||o>this.parsedOptions._maxDateTime||!(i!=null&&i[a])||!(i!=null&&i[r])))return{taskDays:0,progress:0,startDate:null,endDate:null,taskRecord:i};const d=Ri(i[l]);let c,p;return this.parsedOptions.timeScaleIncludeHour?(c=j(Math.min(Math.max(this.parsedOptions._minDateTime,o),this.parsedOptions._maxDateTime)),p=Mt(Math.max(Math.min(this.parsedOptions._maxDateTime,h),this.parsedOptions._minDateTime),!0)):(c=j(Math.min(Math.max(this.parsedOptions._minDateTime,o),this.parsedOptions._maxDateTime),!0),p=he(Math.max(Math.min(this.parsedOptions._maxDateTime,h),this.parsedOptions._minDateTime),!0)),{taskRecord:i,taskDays:(p.getTime()-c.getTime()+1)/864e5,startDate:c,endDate:p,progress:d}}_updateStartDateToTaskRecord(e,t,i){var s;const a=this.getRecordByIndex(t,i),r=this.parsedOptions.startDateField,l=(s=this.parsedOptions.dateFormat)!==null&&s!==void 0?s:Ue(a[r]),o=ie(e,l);a[r]=o,N(i)||this._updateRecordToListTable(a,t)}_updateEndDateToTaskRecord(e,t,i){var s;const a=this.getRecordByIndex(t,i),r=this.parsedOptions.endDateField,l=(s=this.parsedOptions.dateFormat)!==null&&s!==void 0?s:Ue(a[r]),o=ie(e,l);a[r]=o,N(i)||this._updateRecordToListTable(a,t)}_updateStartEndDateToTaskRecord(e,t,i,s){var a;const r=this.getRecordByIndex(i,s),l=this.parsedOptions.startDateField,o=this.parsedOptions.endDateField,h=(a=this.parsedOptions.dateFormat)!==null&&a!==void 0?a:Ue(r[l]),d=ie(e,h);r[l]=d;const c=ie(t,h);r[o]=c,N(s)||this._updateRecordToListTable(r,i)}_dragOrderTaskRecord(e,t,i,s){this.data.adjustOrder(e,t,i,s)}updateTaskRecord(e,t,i){if(N(i)){const a=typeof t=="number"?t:t[0];return this._updateRecordToListTable(e,[a,i]),void this._refreshTaskBar(a,i)}if(Array.isArray(t)){const a=t[0],r=t[1];return this._updateRecordToListTable(e,N(r)?[a,r]:a),void this._refreshTaskBar(a,r)}const s=t;this._updateRecordToListTable(e,s),this._refreshTaskBar(s,void 0)}setPixelRatio(e){var t;(t=this.taskListTableInstance)===null||t===void 0||t.setPixelRatio(e),this.parsedOptions.pixelRatio=e,this.scenegraph.setPixelRatio(e)}_resize(){var e;this._updateSize(),(e=this.taskListTableInstance)===null||e===void 0||e.setCanvasSize(this.taskTableWidth,this.tableNoFrameHeight+2*this.parsedOptions.outerFrameStyle.borderLineWidth),this._syncPropsFromTable(),this.scenegraph.resize(),qe(this)}_syncPropsFromTable(){this.itemCount=this.taskListTableInstance?this.taskListTableInstance.rowCount-this.taskListTableInstance.columnHeaderLevelCount:this.records.length,this.headerHeight=this.getAllHeaderRowsHeight(),this.drawHeight=Math.min(this.getAllRowsHeight(),this.tableNoFrameHeight),this.gridHeight=this.drawHeight-this.headerHeight}getContext(){return this.context}release(){var e,t;(e=super.release)===null||e===void 0||e.call(this),this.eventManager.release(),(t=this.taskListTableInstance)===null||t===void 0||t.release();const{parentElement:i}=this.element;i&&(i.removeChild(this.element),this.verticalSplitResizeLine&&i.removeChild(this.verticalSplitResizeLine),this.horizontalSplitLine&&i.removeChild(this.horizontalSplitLine)),this.scenegraph=null}updateOption(e){var t,i,s,a,r;if(this.parsedOptions={},this.options=e,this.taskTableWidth=typeof((t=e==null?void 0:e.taskListTable)===null||t===void 0?void 0:t.tableWidth)=="number"?(i=e==null?void 0:e.taskListTable)===null||i===void 0?void 0:i.tableWidth:-1,this.taskTableColumns=(a=(s=e==null?void 0:e.taskListTable)===null||s===void 0?void 0:s.columns)!==null&&a!==void 0?a:[],this.records=(r=e==null?void 0:e.records)!==null&&r!==void 0?r:[],this._sortScales(),Ct(this),this.data.setRecords(this.records),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this._updateSize(),this.taskListTableInstance){const l=this._generateListTableOptions();this.taskListTableInstance.updateOption(l),this._updateListTableSize(this.taskListTableInstance)}this._syncPropsFromTable(),this.scenegraph.updateStageBackground(),this.element.style.left=this.taskTableWidth?`${this.taskTableWidth}px`:"0px",qe(this),this.scenegraph.updateSceneGraph(),this.scenegraph.afterCreateSceneGraph(),this._scrollToMarkLine()}setRecords(e){this.records=e,this.data.setRecords(e),Gi(this),this.taskListTableInstance.setRecords(e),this._syncPropsFromTable(),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this._updateSize(),this.scenegraph.refreshAll(),this.verticalSplitResizeLine.style.height=this.drawHeight+"px";const t=this.stateManager.scroll.horizontalBarPos,i=this.stateManager.scroll.verticalBarPos;this.scenegraph.setX(-t),this.scenegraph.setY(-i)}updateScales(e){if(this.options.timelineHeader.scales=e,this._sortScales(),Pi(this),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this.scenegraph.refreshAll(),qe(this),this.taskListTableInstance)if(this.taskListTableInstance.columnHeaderLevelCount===this.parsedOptions.timeLineHeaderRowHeights.length)for(let t=0;t<this.taskListTableInstance.columnHeaderLevelCount;t++)this.taskListTableInstance.setRowHeight(t,this.parsedOptions.timeLineHeaderRowHeights[t]);else{const t=this.getAllHeaderRowsHeight()/this.taskListTableInstance.columnHeaderLevelCount;for(let i=0;i<this.taskListTableInstance.columnHeaderLevelCount;i++)this.taskListTableInstance.setRowHeight(i,t)}}updateDateRange(e,t){this.options.minDate=e,this.options.maxDate=t,ji(this),this._generateTimeLineDateMap(),this._updateSize(),this.scenegraph.refreshAll(),this._scrollToMarkLine()}updateMarkLine(e){this.options.markLine=e,Xi(this),this.scenegraph.markLine.refresh(),this.scenegraph.renderSceneGraph()}_scrollToMarkLine(){if(this.parsedOptions.scrollToMarkLineDate&&this.parsedOptions.minDate){const e=this.parsedOptions.minDate,{unit:t,step:i}=this.parsedOptions.reverseSortedTimelineScales[0],s=R(this.parsedOptions.scrollToMarkLineDate,e,t,i)*this.parsedOptions.timelineColWidth-this.tableNoFrameWidth/2;this.stateManager.setScrollLeft(s)}}addLink(e){this.parsedOptions.dependencyLinks.push(e),this.scenegraph.dependencyLink.initLinkLine(this.parsedOptions.dependencyLinks.length-1),this.scenegraph.updateNextFrame()}deleteLink(e){if(this.parsedOptions.dependencyLinkDeletable){const t=this.parsedOptions.dependencyLinks.findIndex(i=>i.type===e.type&&i.linkedFromTaskKey===e.linkedFromTaskKey&&i.linkedToTaskKey===e.linkedToTaskKey);if(t!==-1){const i=this.parsedOptions.dependencyLinks[t];this.parsedOptions.dependencyLinks.splice(t,1),this.scenegraph.dependencyLink.deleteLink(i),this.scenegraph.updateNextFrame()}}}get scrollTop(){return this.stateManager.scrollTop}set scrollTop(e){this.stateManager.setScrollTop(e)}get scrollLeft(){return this.stateManager.scrollLeft}set scrollLeft(e){this.stateManager.setScrollLeft(e)}getTaskBarRelativeRect(e){const t=this.scenegraph.taskBar.getTaskBarNodeByIndex(e);return{left:t.attribute.x+this.taskListTableInstance.tableNoFrameWidth+this.taskListTableInstance.tableX+this.tableX-this.scrollLeft,top:t.attribute.y+this.tableY+this.headerHeight-this.scrollTop,width:t.attribute.width,height:t.attribute.height}}getDateColWidth(e){return this.parsedOptions.timelineColWidth}getDateColsWidth(e,t){return(t-e+1)*this.parsedOptions.timelineColWidth}getDateRangeByIndex(e){const t=this.parsedOptions.reverseSortedTimelineScales[0];return{startDate:t.timelineDates[e].startDate,endDate:t.timelineDates[e].endDate}}parseTimeFormat(e){return Ue(e)}}class jt{constructor(e){this.editorType="Input",this.editorConfig=e}createElement(){var e;const t=document.createElement("input");t.setAttribute("type","text"),!((e=this.editorConfig)===null||e===void 0)&&e.readonly&&t.setAttribute("readonly",`${this.editorConfig.readonly}`),t.style.position="absolute",t.style.padding="4px",t.style.width="100%",t.style.boxSizing="border-box",t.style.backgroundColor="#FFFFFF",this.element=t,this.container.appendChild(t),t.addEventListener("keydown",i=>{i.key==="a"&&(i.ctrlKey||i.metaKey)&&i.stopPropagation()})}setValue(e){this.element.value=e!==void 0?e:""}getValue(){return this.element.value}onStart({value:e,referencePosition:t,container:i,endEdit:s}){this.container=i,this.successCallback=s,this.element||(this.createElement(),e!=null&&this.setValue(e),t!=null&&t.rect&&this.adjustPosition(t.rect)),this.element.focus()}adjustPosition(e){this.element.style.top=e.top+"px",this.element.style.left=e.left+"px",this.element.style.width=e.width+"px",this.element.style.height=e.height+"px"}endEditing(){}onEnd(){var e;!((e=this.container)===null||e===void 0)&&e.contains(this.element)&&this.container.removeChild(this.element),this.element=void 0}isEditorElement(e){return e===this.element}validateValue(e,t,i,s){return!0}}class wn extends jt{constructor(e){super(e),this.editorType="DateInput",this.editorConfig=e}createElement(){const e=document.createElement("input");e.setAttribute("type","date"),e.style.padding="4px",e.style.width="100%",e.style.boxSizing="border-box",e.style.position="absolute",e.style.backgroundColor="#FFFFFF",this.element=e,this.container.appendChild(e),e.addEventListener("keydown",t=>{t.key==="a"&&(t.ctrlKey||t.metaKey)&&t.stopPropagation()})}}const On=[{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-15",progress:31,priority:"P0",children:[{id:2,title:"Project Feature Review",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-07-24",progress:60,priority:"P0"},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-25",end:"2024-07-26",progress:100,priority:"P1"},{id:3,title:"Project Create",developer:"liufangfang.jane@bytedance.com",start:"2024-07-27",end:"2024-07-26",progress:100,priority:"P1"},{id:3,title:"Develop feature 1",developer:"liufangfang.jane@bytedance.com",start:"2024-08-01",end:"2024-08-15",progress:0,priority:"P1"}]},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-01",progress:60,priority:"P0"},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:100,priority:"P1",children:[{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-08-01",end:"2024-08-01",progress:90,priority:"P0"},{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-30",end:"2024-08-04",progress:31,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024.07.26",end:"2024.07.08",progress:60,priority:"P0"},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-29",end:"2024-07-31",progress:100,priority:"P1"},{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"07.24.2024",end:"08.04.2024",progress:31,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-16",end:"2024-07-18",progress:60,priority:"P0"},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-08-09",end:"2024-09-11",progress:100,priority:"P1"}]},{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:31,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-26",end:"2024-07-28",progress:60,priority:"P0",children:[{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-29",end:"2024-07-31",progress:100,priority:"P1",children:[{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:31,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-26",end:"2024-07-28",progress:60,priority:"P0"},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-29",end:"2024-07-31",progress:100,priority:"P1"}]},{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:31,priority:"P0",children:[{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:31,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-06",end:"2024-07-08",progress:60,priority:"P0"},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-29",end:"2024-07-31",progress:100,priority:"P1"}]},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-26",end:"2024-07-28",progress:60,priority:"P0"},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-29",end:"2024-07-31",progress:100,priority:"P1",children:[{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:31,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-06",end:"2024-07-08",progress:60,priority:"P0"}]},{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:31,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-26",end:"2024-07-28",progress:60,priority:"P0"},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-29",end:"2024-07-31",progress:100,priority:"P1"}]},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-29",end:"2024-07-31",progress:100,priority:"P1",children:[{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:31,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-23",end:"2024-07-28",progress:60,priority:"P0"},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-29",end:"2024-07-31",progress:100,priority:"P1"},{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-30",end:"2024-08-14",progress:31,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:60,priority:"P0"}]},{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:31,priority:"P0",children:[{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:100,priority:"P1"},{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-08-04",end:"2024-08-04",progress:90,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"07/24/2024",end:"08/04/2024",progress:60,priority:"P0"}]},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-27",end:"2024-07-28",progress:60,priority:"P0"},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-29",end:"2024-07-31",progress:100,priority:"P1",children:[{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"07.24.2024",end:"08.04.2024",progress:31,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-26",end:"2024-07-28",progress:60,priority:"P0"},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-08-09",end:"2024-09-11",progress:100,priority:"P1"},{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:31,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-26",end:"2024-07-28",progress:60,priority:"P0"},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-29",end:"2024-07-31",progress:100,priority:"P1"},{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:31,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-26",end:"2024-07-28",progress:60,priority:"P0"},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-29",end:"2024-07-31",progress:100,priority:"P1"}]},{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:31,priority:"P0",children:[{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:100,priority:"P1"},{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:31,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024.07.06",end:"2024.07.08",progress:60,priority:"P0"},{id:3,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-29",end:"2024-07-31",progress:100,priority:"P1"}]}],Cn=[{id:1,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-15",end:"2024-07-16",progress:31,priority:"P0"},{id:2,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-16",end:"2024-07-17",progress:60,priority:"P0"},{id:3,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-18",end:"2024-07-19",progress:90,priority:"P0"},{id:4,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024/07/17",end:"2024/07/18",progress:100,priority:"P1"},{id:5,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"07/19/2024",end:"07/20/2024",progress:60,priority:"P0"},{id:6,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:100,priority:"P1"},{id:7,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:31,priority:"P0"},{id:8,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024.07.06",end:"2024.07.08",progress:60,priority:"P0"},{id:9,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024/07/09",end:"2024/07/11",progress:100,priority:"P1"},{id:10,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"07.24.2024",end:"08.04.2024",progress:31,priority:"P0"},{id:11,title:"Software Development",developer:"liufangfang.jane@bytedance.com",start:"2024-07-24",end:"2024-08-04",progress:31,priority:"P0"},{id:12,title:"Scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-06",end:"2024-07-08",progress:60,priority:"P0"},{id:13,title:"Determine project scope",developer:"liufangfang.jane@bytedance.com",start:"2024-07-09",end:"2024-07-11",progress:100,priority:"P1"}],Dn=[{id:1,title:"Project Task 1",developer:"bear.xiong",avatar:"https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/custom-render/bear.jpg",start:"2024-07-24",end:"2024-07-26",progress:31,priority:"P0"},{id:2,title:"Project Task 2",developer:"wolf.lang",avatar:"https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/custom-render/wolf.jpg",start:"07/25/2024",end:"07/28/2024",progress:60,priority:"P0"},{id:3,title:"Project Task 3",developer:"rabbit.tu",avatar:"https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/custom-render/rabbit.jpg",start:"2024-07-28",end:"2024-08-01",progress:100,priority:"P1"},{id:1,title:"Project Task 4",developer:"cat.mao",avatar:"https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/custom-render/cat.jpg",start:"2024-07-31",end:"2024-08-03",progress:31,priority:"P0"},{id:2,title:"Project Task 5",developer:"bird.niao",avatar:"https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/custom-render/bird.jpeg",start:"2024-08-02",end:"2024-08-04",progress:60,priority:"P0"},{id:3,title:"Project Task 6",developer:"flower.hua",avatar:"https://lf9-dp-fe-cms-tos.byteorg.com/obj/bit-cloud/VTable/custom-render/flower.jpg",start:"2024-08-03",end:"2024-08-10",progress:100,priority:"P1"}],Fn=si({name:"plugin_gantt_vtable",__name:"index",setup(n){const e=ai(),t=new jt,i=new wn;wt("input",t),wt("date-input",i);const s=Pe(),a=Pe(),r=Pe(),l=Pe(),o=Pe(),h=Pe(),c={overscrollBehavior:"none",records:On,taskListTable:{columns:[{field:"title",title:"title",width:"auto",sort:!0,tree:!0,editor:"input"},{field:"start",title:"start",width:"auto",sort:!0,editor:"date-input"},{field:"end",title:"end",width:"auto",sort:!0,editor:"date-input"},{field:"priority",title:"priority",width:"auto",sort:!0,editor:"input"},{field:"progress",title:"progress",width:"auto",sort:!0,headerStyle:{borderColor:"#e1e4e8"},style:{borderColor:"#e1e4e8",color:"green"},editor:"input"}],tableWidth:250,minTableWidth:100,maxTableWidth:600},frame:{outerFrameStyle:{borderLineWidth:2,borderColor:"#e1e4e8",cornerRadius:8},verticalSplitLine:{lineColor:"#e1e4e8",lineWidth:3},horizontalSplitLine:{lineColor:"#e1e4e8",lineWidth:3},verticalSplitLineMoveable:!0,verticalSplitLineHighlight:{lineColor:"green",lineWidth:3}},grid:{verticalLine:{lineWidth:1,lineColor:"#e1e4e8"},horizontalLine:{lineWidth:1,lineColor:"#e1e4e8"}},headerRowHeight:40,rowHeight:40,taskBar:{startDateField:"start",endDateField:"end",progressField:"progress",moveable:!0,hoverBarStyle:{barOverlayColor:"rgba(99, 144, 0, 0.4)"},labelText:"{title} {progress}%",labelTextStyle:{fontFamily:"Arial",fontSize:16,textAlign:"left",textOverflow:"ellipsis"},barStyle:{width:20,barColor:"#ee8800",completedBarColor:"#91e8e0",cornerRadius:8}},timelineHeader:{colWidth:100,backgroundColor:"#EEF1F5",horizontalLine:{lineWidth:1,lineColor:"#e1e4e8"},verticalLine:{lineWidth:1,lineColor:"#e1e4e8"},scales:[{unit:"week",step:1,startOfWeek:"sunday",format(k){return`Week ${k.dateIndex}`},style:{fontSize:20,fontWeight:"bold",color:"white",strokeColor:"black",textAlign:"right",textBaseline:"bottom",textStick:!0}},{unit:"day",step:1,format(k){return k.dateIndex.toString()},style:{fontSize:20,fontWeight:"bold",color:"white",strokeColor:"black",textAlign:"right",textBaseline:"bottom"}}]},markLine:[{date:"2024-07-28",style:{lineWidth:1,lineColor:"blue",lineDash:[8,4]}},{date:"2024-08-17",style:{lineWidth:2,lineColor:"red",lineDash:[8,4]}}],rowSeriesNumber:{title:"行号",dragOrder:!0},scrollStyle:{scrollRailColor:"RGBA(246,246,246,0.5)",visible:"scrolling",width:6,scrollSliderCornerRadius:2,scrollSliderColor:"#5cb85c"}},u={records:Cn,taskListTable:{columns:[{field:"title",title:"title",width:"auto",tree:!0},{field:"start",title:"start",width:"auto",editor:"date-input"},{field:"end",title:"end",width:"auto",editor:"date-input"},{field:"priority",title:"priority",width:"auto",editor:"input"},{field:"progress",title:"progress",width:"auto",headerStyle:{borderColor:"#e1e4e8"},style:{borderColor:"#e1e4e8",color:"green"},editor:"input"}],tableWidth:400,minTableWidth:100,maxTableWidth:600},dependency:{links:[{type:Y.FinishToStart,linkedFromTaskKey:1,linkedToTaskKey:2},{type:Y.StartToFinish,linkedFromTaskKey:2,linkedToTaskKey:3},{type:Y.StartToStart,linkedFromTaskKey:3,linkedToTaskKey:4},{type:Y.FinishToFinish,linkedFromTaskKey:4,linkedToTaskKey:5}],linkSelectedLineStyle:{shadowBlur:5,shadowColor:"red",lineColor:"red",lineWidth:1}},frame:{verticalSplitLineMoveable:!0,outerFrameStyle:{borderLineWidth:2,cornerRadius:8},verticalSplitLine:{lineWidth:3,lineColor:"#e1e4e8"},verticalSplitLineHighlight:{lineColor:"green",lineWidth:3}},grid:{verticalLine:{lineWidth:1,lineColor:"#e1e4e8"},horizontalLine:{lineWidth:1,lineColor:"#e1e4e8"}},headerRowHeight:60,rowHeight:40,taskBar:{startDateField:"start",endDateField:"end",progressField:"progress",labelText:"{title} {progress}%",labelTextStyle:{fontFamily:"Arial",fontSize:16,textAlign:"left"},barStyle:{width:20,barColor:"#ee8800",completedBarColor:"#91e8e0",cornerRadius:10},selectedBarStyle:{shadowBlur:5,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black",borderColor:"red",borderLineWidth:1}},timelineHeader:{verticalLine:{lineWidth:1,lineColor:"#e1e4e8"},horizontalLine:{lineWidth:1,lineColor:"#e1e4e8"},backgroundColor:"#EEF1F5",colWidth:60,scales:[{unit:"week",step:1,startOfWeek:"sunday",format(k){return`Week ${k.dateIndex}`},style:{fontSize:20,fontWeight:"bold",color:"red"}},{unit:"day",step:1,format(k){return k.dateIndex.toString()},style:{fontSize:20,fontWeight:"bold",color:"red"}}]},minDate:"2024-07-14",maxDate:"2024-10-15",rowSeriesNumber:{title:"行号",dragOrder:!0},scrollStyle:{visible:"scrolling"},overscrollBehavior:"none"},g=["#aecde6","#c6a49a","#ffb582","#eec1de","#b3d9b3","#cccccc","#e59a9c","#d9d1a5","#c9bede"],f=["#1f77b4","#8c564b","#ff7f0e","#e377c2","#2ca02c","#7f7f7f","#d62728","#bcbd22","#9467bd"],T={records:Dn,taskListTable:{columns:[{field:"title",title:"TASK",width:"200",headerStyle:{textAlign:"center",fontSize:20,fontWeight:"bold"},style:{},customLayout:k=>{const{table:y,row:B,col:C,rect:O}=k,w=y.getCellOriginRecord(C,B),{height:v,width:H}=O??y.getCellRect(C,B),P=new M({y:10,x:20,height:v-20,width:H-40,fill:"#ddd",display:"flex",flexDirection:"column",cornerRadius:30}),G=new de({text:w.developer,fontSize:16,fontFamily:"sans-serif",fill:f[k.row],fontWeight:"bold",maxLineWidth:H-120,boundsPadding:[10,0,0,0],alignSelf:"center"});P.add(G);const W=new de({text:`${ie(new Date(w.start),"mm/dd")}-${ie(new Date(w.end),"mm/dd")}`,fontSize:12,fontFamily:"sans-serif",fontWeight:"bold",fill:"black",boundsPadding:[10,0,0,0],alignSelf:"center"});return P.add(W),{rootContainer:P,expectedWidth:160}}}],tableWidth:"auto"},frame:{outerFrameStyle:{borderLineWidth:2,borderColor:"#E1E4E8",cornerRadius:8}},grid:{horizontalLine:{lineWidth:2,lineColor:"#d5d9ee"}},headerRowHeight:60,rowHeight:80,taskBar:{startDateField:"start",endDateField:"end",progressField:"progress",barStyle:{width:60},customLayout:k=>{const y=f.length,{width:B,height:C,index:O,taskDays:w,progress:v,taskRecord:H}=k,P=new M({width:B,height:C,cornerRadius:30,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{offset:0,color:g[O%y]},{offset:.5,color:f[O%y]},{offset:1,color:g[O%y]}]},display:"flex",flexDirection:"row",flexWrap:"nowrap"}),G=new M({height:C,width:60,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around"});P.add(G);const W=new Ze({width:50,height:50,image:H.avatar,cornerRadius:25});G.add(W);const E=new M({height:C,width:B-120,display:"flex",flexDirection:"column"});P.add(E);const U=new de({text:H.developer,fontSize:16,fontFamily:"sans-serif",fill:"white",fontWeight:"bold",maxLineWidth:B-120,boundsPadding:[10,0,0,0]});E.add(U);const K=new de({text:`${w}天`,fontSize:13,fontFamily:"sans-serif",fill:"white",boundsPadding:[10,0,0,0]});if(E.add(K),B>=120){const X=new M({cornerRadius:20,fill:"white",height:40,width:40,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",boundsPadding:[10,0,0,0]});P.add(X);const q=new de({text:`${v}%`,fontSize:12,fontFamily:"sans-serif",fill:"black",alignSelf:"center",fontWeight:"bold",maxLineWidth:(B-60)/2,boundsPadding:[0,0,0,0]});X.add(q)}return{rootContainer:P}},hoverBarStyle:{cornerRadius:30}},timelineHeader:{backgroundColor:"#f0f0fb",colWidth:80,scales:[{unit:"day",step:1,format(k){return k.dateIndex.toString()},customLayout:k=>{const{width:y,height:B,startDate:C,dateIndex:O}=k,w=new M({width:y,height:B,display:"flex",flexDirection:"row",flexWrap:"nowrap"}),v=new M({height:B,width:30,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-around"});w.add(v);const H=new Ze({width:20,height:30,image:'<svg t="1724675965803" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4299" width="200" height="200"><path d="M53.085678 141.319468C23.790257 141.319468 0 165.035326 0 194.34775L0 918.084273C0 947.295126 23.796789 971.112572 53.085678 971.112572L970.914322 971.112572C1000.209743 971.112572 1024 947.396696 1024 918.084273L1024 194.34775C1024 165.136896 1000.203211 141.319468 970.914322 141.319468L776.827586 141.319468 812.137931 176.629813 812.137931 88.275862C812.137931 68.774506 796.328942 52.965517 776.827586 52.965517 757.32623 52.965517 741.517241 68.774506 741.517241 88.275862L741.517241 176.629813 741.517241 211.940158 776.827586 211.940158 970.914322 211.940158C961.186763 211.940158 953.37931 204.125926 953.37931 194.34775L953.37931 918.084273C953.37931 908.344373 961.25643 900.491882 970.914322 900.491882L53.085678 900.491882C62.813237 900.491882 70.62069 908.306097 70.62069 918.084273L70.62069 194.34775C70.62069 204.087649 62.74357 211.940158 53.085678 211.940158L247.172414 211.940158C266.67377 211.940158 282.482759 196.131169 282.482759 176.629813 282.482759 157.128439 266.67377 141.319468 247.172414 141.319468L53.085678 141.319468ZM211.862069 176.629813C211.862069 196.131169 227.671058 211.940158 247.172414 211.940158 266.67377 211.940158 282.482759 196.131169 282.482759 176.629813L282.482759 88.275862C282.482759 68.774506 266.67377 52.965517 247.172414 52.965517 227.671058 52.965517 211.862069 68.774506 211.862069 88.275862L211.862069 176.629813ZM1024 353.181537 1024 317.871192 988.689655 317.871192 35.310345 317.871192 0 317.871192 0 353.181537 0 441.457399C0 460.958755 15.808989 476.767744 35.310345 476.767744 54.811701 476.767744 70.62069 460.958755 70.62069 441.457399L70.62069 353.181537 35.310345 388.491882 988.689655 388.491882 953.37931 353.181537 953.37931 441.457399C953.37931 460.958755 969.188299 476.767744 988.689655 476.767744 1008.191011 476.767744 1024 460.958755 1024 441.457399L1024 353.181537ZM776.937913 582.62069C796.439287 582.62069 812.248258 566.811701 812.248258 547.310345 812.248258 527.808989 796.439287 512 776.937913 512L247.172414 512C227.671058 512 211.862069 527.808989 211.862069 547.310345 211.862069 566.811701 227.671058 582.62069 247.172414 582.62069L776.937913 582.62069ZM247.172414 688.551724C227.671058 688.551724 211.862069 704.360713 211.862069 723.862069 211.862069 743.363425 227.671058 759.172414 247.172414 759.172414L600.386189 759.172414C619.887563 759.172414 635.696534 743.363425 635.696534 723.862069 635.696534 704.360713 619.887563 688.551724 600.386189 688.551724L247.172414 688.551724ZM776.827586 211.940158 741.517241 176.629813 741.517241 247.328574C741.517241 266.829948 757.32623 282.638919 776.827586 282.638919 796.328942 282.638919 812.137931 266.829948 812.137931 247.328574L812.137931 176.629813 812.137931 141.319468 776.827586 141.319468 247.172414 141.319468C227.671058 141.319468 211.862069 157.128439 211.862069 176.629813 211.862069 196.131169 227.671058 211.940158 247.172414 211.940158L776.827586 211.940158ZM282.482759 176.629813C282.482759 157.128439 266.67377 141.319468 247.172414 141.319468 227.671058 141.319468 211.862069 157.128439 211.862069 176.629813L211.862069 247.328574C211.862069 266.829948 227.671058 282.638919 247.172414 282.638919 266.67377 282.638919 282.482759 266.829948 282.482759 247.328574L282.482759 176.629813Z" fill="#389BFF" p-id="4300"></path></svg>'});v.add(H);const P=new M({height:B,width:y-30,display:"flex",flexDirection:"column"});w.add(P);const G=new de({text:String(O).padStart(2,"0"),fontSize:20,fontWeight:"bold",fontFamily:"sans-serif",fill:"#777",textAlign:"right",maxLineWidth:y-30,boundsPadding:[15,0,0,0]});P.add(G);const W=new de({text:Si(C,"short").toLocaleUpperCase(),fontSize:12,fontFamily:"sans-serif",fill:"#777",boundsPadding:[0,0,0,0]});return P.add(W),{rootContainer:w}}}]},minDate:"2024-07-20",maxDate:"2024-08-15",markLine:[{date:"2024-07-29",style:{lineWidth:1,lineColor:"blue",lineDash:[8,4]}},{date:"2024-08-17",style:{lineWidth:2,lineColor:"red",lineDash:[8,4]}}],scrollStyle:{scrollRailColor:"RGBA(246,246,246,0.5)",visible:"focus",width:6,scrollSliderCornerRadius:2,scrollSliderColor:"#5cb85c"}};function m(){l.value=new Lt(s.value,b(c)),o.value=new Lt(a.value,b(u)),h.value=new Lt(r.value,b(T))}function b(k){return e.darkMode?(k.taskListTable.theme=ni,k.timelineHeader.backgroundColor="#212121",k.underlayBackgroundColor="#000"):(k.taskListTable.theme=Xe,k.timelineHeader.backgroundColor="#f0f0fb",k.underlayBackgroundColor="#fff"),k}const x=ri(()=>e.darkMode,k=>{var y,B,C;(y=l.value)==null||y.release(),(B=o.value)==null||B.release(),(C=h.value)==null||C.release(),m()});return li(()=>{m()}),oi(()=>{x()}),(k,y)=>{const B=Vt,C=ci,O=ui;return di(),hi(O,{vertical:"",size:16},{default:Ge(()=>[je(C,{bordered:!1,title:"VTableGantt",class:"h-full card-wrapper"},{default:Ge(()=>[je(B,{label:"More Demos: ",link:"https://www.visactor.com/vtable/example"})]),_:1}),je(C,{bordered:!1,class:"h-full card-wrapper"},{default:Ge(()=>[kt("div",{ref_key:"basicGanttDomRef",ref:s,class:"relative h-400px"},null,512)]),_:1}),je(C,{bordered:!1,class:"h-full card-wrapper"},{default:Ge(()=>[kt("div",{ref_key:"linkGanttDomRef",ref:a,class:"relative h-400px"},null,512)]),_:1}),je(C,{bordered:!1,class:"h-full card-wrapper"},{default:Ge(()=>[kt("div",{ref_key:"customGanttDomRef",ref:r,class:"relative h-400px"},null,512)]),_:1})]),_:1})}}});export{Fn as default};
