import{_ as be,a as he,b as we,c as ke,d as Ne,N as xe,e as Te}from"./round-refresh-B7VpfLgK.js";import{u as Ce,a as Be,b as re,w as Se,_ as Ue}from"./table-Gm6yRvUm.js";import{d as pe,M as ue,N as fe,a as z,r as Q,O as Le,o as v,c as b,w as t,f as e,g as w,t as oe,h as o,$ as k,P as T,s as _e,B as K,Q as ve,R as De,S as $e,J as ge,z as Ie,b as Ae,U as le,V as Re,W as Ee}from"./index-D6W6_zXP.js";import{c as Oe,e as ce,f as Pe,g as ze}from"./club-9izwOJFE.js";import{u as de}from"./auth-DdtuPNda.js";import{u as Fe,_ as Me,b as ye}from"./form-a8uLA4Rd.js";import{d as Ve,s as We,_ as je}from"./file-CILs5gq_.js";import{_ as me}from"./Space-zKntJrGG.js";import{_ as He}from"./Grid-Cxuy6_wU.js";import{_ as Ke}from"./DataTable-BesTDHU0.js";import"./get-slot-Bk_rJcZu.js";import"./Pagination-BQ2WJ-Rm.js";const Ge=pe({name:"RoleOperateDrawer",__name:"role-operate-drawer",props:ue({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:ue(["submitted"],["update:visible"]),setup(C,{emit:L}){const N=C,E=L,d=fe(C,"visible"),{formRef:O,validate:F,restoreValidation:M}=Fe(),G=z(()=>({add:"新增社团",edit:"编辑社团"})[N.operateType]),r=Q(B());function B(){return{name:"",description:"",approvalStatus:null,approveReason:""}}const g=z(()=>{var u;return((u=N.rowData)==null?void 0:u.id)||-1}),_=z(()=>N.operateType==="edit");function X(){r.value=B(),N.operateType==="edit"&&N.rowData&&Object.assign(r.value,N.rowData)}function P(){d.value=!1}async function q(){var u,a;if(await F(),delete r.value.index,r.value.name===""||r.value.description===""){(u=window.$message)==null||u.error("社团名称和社团描述不能为空！");return}await Oe(r.value),(a=window.$message)==null||a.success(k("common.updateSuccess")),P(),E("submitted")}const D=`${String(localStorage.getItem("SOY_token")).trim().replace(/"/g,"")}`,h=localStorage.getItem("baseUri"),$=`${h}/upload`,I=Q([]),A=Q([]),R=Q([]),y=Q([]),Y=z(()=>({targetId:g.value,targetType:1,fileCategory:1})),Z=z(()=>({targetId:g.value,targetType:1,fileCategory:2})),ne=z(()=>({targetId:g.value,targetType:1,fileCategory:3})),se=z(()=>({targetId:g.value,targetType:1,fileCategory:4})),n=async u=>{var U,ee,j,te,H,ae;const a=await Ve(u.file.id),{code:p,data:f,msg:x}=a.response.data;return p===200?((ee=(U=window.$message)==null?void 0:U.success)==null||ee.call(U,x),!0):p!==200?((te=(j=window.$message)==null?void 0:j.error)==null||te.call(j,x),!1):((ae=(H=window.$message)==null?void 0:H.error)==null||ae.call(H,"前端删除文件错误，请联系管理员！"),!1)},l=()=>{I.value=[],A.value=[],R.value=[],y.value=[]},s=()=>{We({targetId:g.value}).then(u=>{(Array.isArray(u.data)?u.data:[]).forEach(p=>{const f={id:p.id,name:p.fileName,status:"finished",url:`${h}/${p.fileUri}`};switch(p.fileCategory){case 1:I.value.push(f);break;case 2:A.value.push(f);break;case 3:R.value.push(f);break;case 4:y.value.push(f);break;default:console.warn(`Unknown file category: ${p.fileCategory}`)}})})},c=({file:u})=>(setTimeout(()=>{l(),s()},500),u);function J(u,a){const p=document.createElement("a");p.href=u,p.target="_blank",p.download=a,document.body.appendChild(p),p.click(),document.body.removeChild(p)}const S=u=>(J(u.url,u.name),!1);Le(d,()=>{d.value&&(X(),M(),setTimeout(()=>{l(),s()},500))});const V=[{label:"待审批",value:0},{label:"审批通过",value:1},{label:"审批拒绝",value:2}],i=()=>{window.open("https://uutool.cn/tinymce/","_blank")},{hasAuth:W}=de();return(u,a)=>{const p=_e,f=Me,x=K,U=je,ee=ve,j=ye,te=me,H=De,ae=$e;return v(),b(ae,{show:d.value,"onUpdate:show":a[8]||(a[8]=m=>d.value=m),"display-directive":"show",width:360},{default:t(()=>[e(H,{title:G.value,"native-scrollbar":!1,closable:""},{footer:t(()=>[e(te,{size:16},{default:t(()=>[e(x,{onClick:P},{default:t(()=>[w(oe(o(k)("common.cancel")),1)]),_:1}),e(x,{type:"primary",onClick:q},{default:t(()=>[w(oe(o(k)("common.confirm")),1)]),_:1})]),_:1})]),default:t(()=>[e(j,{ref_key:"formRef",ref:O,model:r.value},{default:t(()=>[e(f,{label:"社团名称"},{default:t(()=>[e(p,{value:r.value.name,"onUpdate:value":a[0]||(a[0]=m=>r.value.name=m)},null,8,["value"])]),_:1}),e(f,{label:"社团描述"},{default:t(()=>[e(p,{value:r.value.description,"onUpdate:value":a[1]||(a[1]=m=>r.value.description=m),type:"textarea"},null,8,["value"])]),_:1}),_.value?(v(),b(f,{key:0,label:"图片"},{default:t(()=>[e(U,{"file-list":I.value,"onUpdate:fileList":a[2]||(a[2]=m=>I.value=m),action:$,data:Y.value,"list-type":"image-card","show-download-button":!0,max:9,name:"file",multiple:!0,accept:".jpg,.jpeg,.png",headers:{Authorization:`Bearer ${D}`},"on-finish":c,"on-remove":n,"on-download":S},{default:t(()=>[e(x,null,{default:t(()=>a[9]||(a[9]=[w("点击上传")])),_:1})]),_:1},8,["file-list","data","headers"])]),_:1})):T("",!0),_.value?(v(),b(f,{key:1,label:"附件"},{default:t(()=>[e(U,{"file-list":A.value,"onUpdate:fileList":a[3]||(a[3]=m=>A.value=m),action:$,data:Z.value,"show-download-button":!0,max:9,name:"file",multiple:!0,accept:".et,.wps,.dps,.txt,.pdf,.docx,.doc,.xlsx,.xls,.csv,.pptx,.ppt,.rar,.zip,.7z,.tar,.gz",headers:{Authorization:`Bearer ${D}`},"on-finish":c,"on-remove":n,"on-download":S},{default:t(()=>[e(x,null,{default:t(()=>a[10]||(a[10]=[w("点击上传")])),_:1})]),_:1},8,["file-list","data","headers"])]),_:1})):T("",!0),_.value?(v(),b(f,{key:2,label:"新闻稿编写工具"},{default:t(()=>[e(x,{type:"primary",dashed:"",onClick:i},{default:t(()=>a[11]||(a[11]=[w("点击访问")])),_:1})]),_:1})):T("",!0),_.value?(v(),b(f,{key:3,label:"新闻稿"},{default:t(()=>[e(U,{"file-list":R.value,"onUpdate:fileList":a[4]||(a[4]=m=>R.value=m),action:$,data:ne.value,"show-download-button":!0,max:9,name:"file",multiple:!0,accept:".html,.htm",headers:{Authorization:`Bearer ${D}`},"on-remove":n,"on-finish":c,"on-download":S},{default:t(()=>[e(x,null,{default:t(()=>a[12]||(a[12]=[w("点击上传")])),_:1})]),_:1},8,["file-list","data","headers"])]),_:1})):T("",!0),_.value?(v(),b(f,{key:4,label:"展示新闻稿"},{default:t(()=>[e(U,{"file-list":y.value,"onUpdate:fileList":a[5]||(a[5]=m=>y.value=m),action:$,data:se.value,"show-download-button":!0,max:1,name:"file",multiple:!0,accept:".html,.htm",headers:{Authorization:`Bearer ${D}`},"on-remove":n,"on-finish":c,"on-download":S},{default:t(()=>[e(x,null,{default:t(()=>a[13]||(a[13]=[w("点击上传")])),_:1})]),_:1},8,["file-list","data","headers"])]),_:1})):T("",!0),_.value&&o(W)("BUTTON_APPROVE_CLUB")?(v(),b(f,{key:5,label:"审批状态"},{default:t(()=>[e(ee,{value:r.value.approvalStatus,"onUpdate:value":a[6]||(a[6]=m=>r.value.approvalStatus=m),options:V,clearable:""},null,8,["value"])]),_:1})):T("",!0),_.value&&o(W)("BUTTON_APPROVE_CLUB")?(v(),b(f,{key:6,label:"审批原因"},{default:t(()=>[e(p,{value:r.value.approveReason,"onUpdate:value":a[7]||(a[7]=m=>r.value.approveReason=m),type:"textarea"},null,8,["value"])]),_:1})):T("",!0)]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}}),Xe=pe({name:"RoleSearch",__name:"role-search",props:{model:{required:!0},modelModifiers:{}},emits:ue(["reset","search"],["update:model"]),setup(C,{emit:L}){const{hasAuth:N}=de(),E=L,d=fe(C,"model");function O(){E("reset")}function F(){E("search")}const M=[{label:"待审批",value:"0"},{label:"审批通过",value:"1"},{label:"审批拒绝",value:"2"}];return(G,r)=>{const B=_e,g=be,_=ve,X=he,P=K,q=we,D=me,h=He,$=ye,I=ke,A=Ne,R=ge;return v(),b(R,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[e(A,{"default-expanded-names":["role-search"]},{default:t(()=>[e(I,{title:o(k)("common.search"),name:"role-search"},{default:t(()=>[e($,{model:d.value,"label-placement":"left","label-width":80},{default:t(()=>[e(h,{responsive:"screen","item-responsive":""},{default:t(()=>[e(g,{span:"24 s:12 m:6",label:"姓名",path:"realName",class:"pr-24px"},{default:t(()=>[e(B,{value:d.value.name,"onUpdate:value":r[0]||(r[0]=y=>d.value.name=y)},null,8,["value"])]),_:1}),e(g,{span:"24 s:12 m:6",label:"审批人",path:"realName",class:"pr-24px"},{default:t(()=>[e(B,{value:d.value.approverName,"onUpdate:value":r[1]||(r[1]=y=>d.value.approverName=y)},null,8,["value"])]),_:1}),e(g,{span:"24 s:12 m:6",label:"审批状态",path:"enabled",class:"pr-24px"},{default:t(()=>[e(_,{value:d.value.approvalStatus,"onUpdate:value":r[2]||(r[2]=y=>d.value.approvalStatus=y),options:M,clearable:""},null,8,["value"])]),_:1}),e(g,{span:"24 s:12 m:6"},{default:t(()=>[e(D,{class:"w-full",justify:"end"},{default:t(()=>[e(P,{onClick:O},{icon:t(()=>[e(X,{class:"text-icon"})]),default:t(()=>[w(" "+oe(o(k)("common.reset")),1)]),_:1}),o(N)("BUTTON_SEARCH_CLUB")?(v(),b(P,{key:0,type:"primary",ghost:"",onClick:F},{icon:t(()=>[e(q,{class:"text-icon"})]),default:t(()=>[w(" "+oe(o(k)("common.search")),1)]),_:1})):T("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),qe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function ie(C){return typeof C=="function"||Object.prototype.toString.call(C)==="[object Object]"&&!Ee(C)}const it=pe({name:"club_club",__name:"index",setup(C){const{hasAuth:L}=de(),N=Ie(),{columns:E,columnChecks:d,data:O,loading:F,getData:M,getDataByPage:G,mobilePagination:r,searchParams:B,resetSearchParams:g}=Ce({apiFn:ce,apiParams:{current:1,size:10,approvalStatus:null,approveReason:null,approverId:null,approverName:null,approveTime:null,createTime:null,updateTime:null,founderId:null,founderName:null,id:null,name:null,description:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:k("common.index"),width:64,align:"center"},{key:"founderId",title:"创建者ID",width:100,align:"center"},{key:"name",title:"社团名",align:"center",minWidth:120},{key:"description",title:"描述",align:"center",minWidth:120},{key:"founderName",title:"创建者",align:"center",minWidth:120},{key:"createTime",title:"创建时间",align:"center",minWidth:120},{key:"approvalStatus",title:"审批状态",align:"center",minWidth:120,render:n=>{if(n.approvalStatus===null)return null;const l={1:"success",0:"warning",2:"error"};let s;return n.approvalStatus===0&&(s="待审批"),n.approvalStatus===1&&(s="审批通过"),n.approvalStatus===2&&(s="审批拒绝"),e(Re,{type:l[n.approvalStatus]},ie(s)?s:{default:()=>[s]})}},{key:"approverName",title:"审批人",align:"center",minWidth:120},{key:"approveTime",title:"审批时间",align:"center",minWidth:120},{key:"approveReason",title:"审批原因",align:"center",minWidth:120},{key:"operate",title:k("common.operate"),align:"center",width:130,render:n=>{let l;return e("div",{class:"flex-center gap-8px"},[L("BUTTON_EDIT_CLUB")?e(K,{type:"primary",ghost:!0,size:"small",onClick:()=>y(n.id)},ie(l=k("common.edit"))?l:{default:()=>[l]}):null,L("BUTTON_DELETE_CLUB")&&e(xe,{onPositiveClick:()=>R(n.id)},{default:()=>k("common.confirmDelete"),trigger:()=>{let s;return e(K,{type:"error",ghost:!0,size:"small"},ie(s=k("common.delete"))?s:{default:()=>[s]})}})])}}]}),{drawerVisible:_,operateType:X,editingData:P,handleAdd:q,handleEdit:D,checkedRowKeys:h,onBatchDeleted:$,onDeleted:I}=Be(O,M);async function A(){console.log(h.value),await Pe(h.value),$()}async function R(n){console.log(n),await ze(n),I()}function y(n){D(n)}async function Y(n,l){const s=E.value.slice(2);let c=[];n?c=(await ce({size:999999})).data.records.map(W=>s.map(u=>Z(u,W))):c=O.value.map(i=>s.map(W=>Z(W,i)));const J=s.map(i=>se(i)&&i.title||null);c.unshift(J);const S=re.book_new(),V=re.aoa_to_sheet(c);V["!cols"]=s.map(i=>({width:Math.round(Number(i.width)/10||20)})),re.book_append_sheet(S,V,"社团列表"),Se(S,"社团数据.xlsx")}function Z(n,l){if(!ne(n))return null;const{key:s}=n;if(s==="operate")return null;if(s==="approvalStatus"){let c;return l.approvalStatus===0&&(c="待审批"),l.approvalStatus===1&&(c="审批通过"),l.approvalStatus===2&&(c="审批拒绝"),c}return l[s]}function ne(n){return!!n.key}function se(n){return!!n.title}return(n,l)=>{const s=Ue,c=Te,J=me,S=Ke,V=ge;return v(),Ae("div",qe,[e(Xe,{model:o(B),"onUpdate:model":l[0]||(l[0]=i=>le(B)?B.value=i:null),onReset:o(g),onSearch:o(G)},null,8,["model","onReset","onSearch"]),e(V,{title:"社团列表",bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[e(J,{align:"end",wrap:"",justify:"end",class:"lt-sm:w-200px"},{default:t(()=>[o(L)("BUTTON_EXCEL_CLUB")?(v(),b(o(K),{key:0,size:"small",ghost:"",type:"primary",onClick:l[1]||(l[1]=i=>Y(!1))},{icon:t(()=>[e(s,{class:"text-icon"})]),default:t(()=>[l[6]||(l[6]=w(" 导出excel "))]),_:1})):T("",!0),o(L)("BUTTON_EXCEL_CLUB_ALL")?(v(),b(o(K),{key:1,size:"small",ghost:"",type:"primary",onClick:l[2]||(l[2]=i=>Y(!0))},{icon:t(()=>[e(s,{class:"text-icon"})]),default:t(()=>[l[7]||(l[7]=w(" 导出全部 "))]),_:1})):T("",!0),e(c,{columns:o(d),"onUpdate:columns":l[3]||(l[3]=i=>le(d)?d.value=i:null),"disabled-delete":o(h).length===0,loading:o(F),"show-add-button-str":"BUTTON_ADD_CLUB","show-batch-delete-button-str":"BUTTON_BATCH_DELETE_CLUB",onAdd:o(q),onDelete:A,onRefresh:o(M)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),_:1})]),default:t(()=>[e(S,{"checked-row-keys":o(h),"onUpdate:checkedRowKeys":l[4]||(l[4]=i=>le(h)?h.value=i:null),columns:o(E),data:o(O),size:"small","flex-height":!o(N).isMobile,"scroll-x":702,loading:o(F),remote:"","row-key":i=>i.id,pagination:o(r),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),e(Ge,{visible:o(_),"onUpdate:visible":l[5]||(l[5]=i=>le(_)?_.value=i:null),"operate-type":o(X),"row-data":o(P),onSubmitted:o(G)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1})])}}});export{it as default};
